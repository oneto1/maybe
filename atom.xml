<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>oneto1</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-08-02T09:56:36.280Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>oneto1</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ğŸ’ğŸ»â€â™‚ï¸</title>
    <link href="http://yoursite.com/2020/08/02/%F0%9F%92%81%F0%9F%8F%BB%E2%80%8D%E2%99%82%EF%B8%8F/"/>
    <id>http://yoursite.com/2020/08/02/%F0%9F%92%81%F0%9F%8F%BB%E2%80%8D%E2%99%82%EF%B8%8F/</id>
    <published>2020-08-02T09:49:03.000Z</published>
    <updated>2020-08-02T09:56:36.280Z</updated>
    
    <content type="html"><![CDATA[<p>æ—¶é—´è¿‡å¾—çœŸå¿«å•Š,ä¸€ä¸‹å­å°±å¿«å®ä¹ äº†ä¸¤ä¸ªæœˆäº†,è™½ç„¶è¿™ä¹Ÿä¸æ˜¯ä»€ä¹ˆæ–­æ›´çš„ç†ç”±</p><p>é‚£ä¹ˆå°±æ¥ä¸‹æ¥ç»§ç»­åŠªåŠ›å§</p><p><img src="/images/990672b3e82963502a597c34e55546b5.gif" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ—¶é—´è¿‡å¾—çœŸå¿«å•Š,ä¸€ä¸‹å­å°±å¿«å®ä¹ äº†ä¸¤ä¸ªæœˆäº†,è™½ç„¶è¿™ä¹Ÿä¸æ˜¯ä»€ä¹ˆæ–­æ›´çš„ç†ç”±&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå°±æ¥ä¸‹æ¥ç»§ç»­åŠªåŠ›å§&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/990672b3e82963502a597c34e55546b5.gif&quot; alt&gt;&lt;/p&gt;

      
    
    </summary>
    
    
    
      <category term="ä¹±ä¸ƒå…«ç³Ÿ" scheme="http://yoursite.com/tags/%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F/"/>
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘: ansible-tutoï¼ˆ12-13ï¼‰</title>
    <link href="http://yoursite.com/2020/05/18/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8812-13%EF%BC%89/"/>
    <id>http://yoursite.com/2020/05/18/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8812-13%EF%BC%89/</id>
    <published>2020-05-18T02:26:33.000Z</published>
    <updated>2020-05-18T02:49:23.578Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="step-12-è¿ç§»åˆ°-role"><a href="#step-12-è¿ç§»åˆ°-role" class="headerlink" title="step-12 è¿ç§»åˆ° role"></a>step-12 è¿ç§»åˆ° role</h1><p>ç°åœ¨æˆ‘ä»¬çš„å‰§æœ¬å®Œæˆäº†ï¼Œè®©æˆ‘ä»¬é‡æ„ä¸€åˆ‡ï¼ æˆ‘ä»¬å°†ç”¨ <code>role</code> æ¥å–ä»£æˆ‘ä»¬çš„æˆå‰§ã€‚  <code>role</code>åªæ˜¯ä¸€ç§ç»„ç»‡æ–‡ä»¶çš„æ–°æ–¹å¼ï¼Œä½†æ˜¯å¸¦æ¥äº†æœ‰è¶£çš„ç‰¹æ€§ã€‚ åœ¨è¿™é‡Œæˆ‘ä¸ä¼šè¯¦ç»†è®¨è®ºï¼Œå› ä¸ºå®ƒä»¬å·²ç»åˆ—å‡ºåœ¨ Ansible çš„æ–‡æ¡£ä¸­ï¼Œä½†æˆ‘æœ€å–œæ¬¢çš„å¯èƒ½æ˜¯ <code>role</code>ä¾èµ–æ€§:  <code>role</code> b å¯ä»¥ä¾èµ–äºå¦ä¸€ä¸ª <code>role</code> aï¼Œå› æ­¤ï¼Œå½“åº”ç”¨ <code>role</code> b æ—¶ï¼Œ <code>role</code> a ä¹Ÿä¼šè‡ªåŠ¨åº”ç”¨ã€‚ æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯ç°åœ¨ï¼Œè®©æˆ‘ä»¬é‡æ„ä¸€ä¸‹æˆ‘ä»¬çš„å‰§æœ¬ï¼Œä½¿ç”¨ <code>role</code>ã€‚</p><h3 id="role-çš„ç»“æ„"><a href="#role-çš„ç»“æ„" class="headerlink" title="role çš„ç»“æ„"></a>role çš„ç»“æ„</h3><p>role ä¸º Ansible æ·»åŠ äº†ä¸€ç‚¹â€œé­”åŠ›â€ : å®ƒä»¬å‡å®šä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶ç»„ç»‡ã€‚ è™½ç„¶æœ‰ä¸€ä¸ªå…³äºè§’è‰²çš„å»ºè®®å¸ƒå±€ï¼Œä½†æ˜¯æ‚¨å¯ä»¥æŒ‰ç…§æ‚¨æƒ³è¦çš„æ–¹å¼æ¥ç»„ç»‡åŒ…å«å†…å®¹ã€‚ ç„¶è€Œï¼Œrole  çš„çº¦å®šæœ‰åŠ©äºæ„å»ºæ¨¡å—åŒ–çš„å‰§æœ¬ï¼Œå¹¶ä¸”å†…åŠ¡ç®¡ç†å°†ç®€å•å¾—å¤šã€‚ Rubyists ä¼šç§°ä¹‹ä¸ºâ€œçº¦å®šä¼˜äºé…ç½®â€ã€‚</p><p>role çš„æ–‡ä»¶å¸ƒå±€å¦‚ä¸‹:<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">roles</span><br><span class="line">  |</span><br><span class="line"><span class="string">  </span>|_some_role</span><br><span class="line">       |</span><br><span class="line"><span class="string">       </span>|_defaults</span><br><span class="line">       |<span class="string">   </span>|</span><br><span class="line">       |<span class="string">   </span>|<span class="string">_main.yml</span></span><br><span class="line"><span class="string">       </span>|<span class="string">   </span>|<span class="string">_...</span></span><br><span class="line"><span class="string">       </span>|</span><br><span class="line">       |<span class="string">_files</span></span><br><span class="line"><span class="string">       </span>|<span class="string">   </span>|</span><br><span class="line">       |<span class="string">   </span>|_file1</span><br><span class="line">       |<span class="string">   </span>|<span class="string">_...</span></span><br><span class="line"><span class="string">       </span>|</span><br><span class="line">       |<span class="string">_handlers</span></span><br><span class="line"><span class="string">       </span>|<span class="string">   </span>|</span><br><span class="line">       |<span class="string">   </span>|<span class="string">_main.yml</span></span><br><span class="line"><span class="string">       </span>|<span class="string">   </span>|<span class="string">_some_other_file.yml</span></span><br><span class="line"><span class="string">       </span>|<span class="string">   </span>|<span class="string">_ ...</span></span><br><span class="line"><span class="string">       </span>|</span><br><span class="line">       |<span class="string">_meta</span></span><br><span class="line"><span class="string">       </span>|<span class="string">   </span>|</span><br><span class="line">       |<span class="string">   </span>|<span class="string">_main.yml</span></span><br><span class="line"><span class="string">       </span>|<span class="string">   </span>|<span class="string">_some_other_file.yml</span></span><br><span class="line"><span class="string">       </span>|<span class="string">   </span>|<span class="string">_ ...</span></span><br><span class="line"><span class="string">       </span>|</span><br><span class="line">       |<span class="string">_tasks</span></span><br><span class="line"><span class="string">       </span>|<span class="string">   </span>|</span><br><span class="line">       |<span class="string">   </span>|<span class="string">_main.yml</span></span><br><span class="line"><span class="string">       </span>|<span class="string">   </span>|<span class="string">_some_other_file.yml</span></span><br><span class="line"><span class="string">       </span>|<span class="string">   </span>|<span class="string">_ ...</span></span><br><span class="line"><span class="string">       </span>|</span><br><span class="line">       |<span class="string">_templates</span></span><br><span class="line"><span class="string">       </span>|<span class="string">   </span>|</span><br><span class="line">       |<span class="string">   </span>|<span class="string">_template1.j2</span></span><br><span class="line"><span class="string">       </span>|<span class="string">   </span>|<span class="string">_...</span></span><br><span class="line"><span class="string">       </span>|</span><br><span class="line">       |<span class="string">_vars</span></span><br><span class="line"><span class="string">           </span>|</span><br><span class="line">           |<span class="string">_main.yml</span></span><br><span class="line"><span class="string">           </span>|<span class="string">_some_other_file.yml</span></span><br><span class="line"><span class="string">           </span>|<span class="string">_ ...</span></span><br></pre></td></tr></table></figure></p><p>åä¸º <code>main.yml</code> çš„æ–‡ä»¶ä¸æ˜¯å¼ºåˆ¶çš„ã€‚ ç„¶è€Œï¼Œå½“å®ƒä»¬å­˜åœ¨æ—¶ï¼Œrole ä¼šè‡ªåŠ¨å°†å®ƒä»¬æ·»åŠ åˆ°å‰§æœ¬ä¸­ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æ­¤æ–‡ä»¶è¿è¡ŒåŒ…å«å…¶ä»–ä»»åŠ¡ã€å¤„ç†ç¨‹åºâ€¦ ã€‚ æˆ‘ä»¬ä¸€ä¼šå„¿å°±çŸ¥é“äº†ã€‚</p><p>æ³¨æ„ï¼Œè¿˜æœ‰ä¸€ä¸ª <code>vars</code> å’Œä¸€ä¸ª <code>meta</code> ç›®å½•ã€‚ å½“ä½ æƒ³æŠŠä¸€å †å…³äº role çš„å˜é‡ã€‚ ç„¶è€Œï¼Œæˆ‘ä¸å–œæ¬¢ç›´æ¥åœ¨è§’è‰²ä¸­è®¾ç½® varsã€‚ æˆ‘è®¤ä¸ºå˜é‡å±äºé…ç½®ï¼Œè€Œå‰§æœ¬æ˜¯ç»“æ„ã€‚ æ¢å¥è¯è¯´ï¼Œæˆ‘å°†å‰§æœ¬å’Œè§’è‰²è§†ä¸ºå·¥å‚ï¼Œå°†æ•°æ®è§†ä¸ºå·¥å‚çš„è¾“å…¥ã€‚ æ‰€ä»¥æˆ‘çœŸçš„æ›´å–œæ¬¢æœ‰â€œæ•°æ®â€(ä¾‹å¦‚å˜é‡)ä»¥å¤–çš„è§’è‰²å’Œå‘æŒ¥ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘å¯ä»¥æ›´å®¹æ˜“åœ°åˆ†äº«æˆ‘çš„è§’è‰²ï¼Œè€Œä¸ç”¨æ‹…å¿ƒè¿‡å¤šåœ°æš´éœ²æˆ‘çš„æœåŠ¡å™¨ã€‚ ä½†è¿™åªæ˜¯ä¸ªäººåå¥½ã€‚ è®©ä½ æŒ‰ç…§è‡ªå·±æƒ³è¦çš„æ–¹å¼å»åšã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="ansible" scheme="http://yoursite.com/tags/ansible/"/>
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘: ansible-tutoï¼ˆ10-11) </title>
    <link href="http://yoursite.com/2020/05/17/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8810-11%EF%BC%89/"/>
    <id>http://yoursite.com/2020/05/17/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8810-11%EF%BC%89/</id>
    <published>2020-05-17T02:08:12.000Z</published>
    <updated>2020-05-17T04:33:46.958Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="step-10-æ¨¡æ¿"><a href="#step-10-æ¨¡æ¿" class="headerlink" title="step-10 æ¨¡æ¿"></a>step-10 æ¨¡æ¿</h1><p>æˆ‘ä»¬å°†ä½¿ç”¨ <code>haproxy</code> ä½œä¸ºè´Ÿè½½å¹³è¡¡å™¨ã€‚ å½“ç„¶ï¼Œå®‰è£…å°±åƒæˆ‘ä»¬å¯¹ apache æ‰€åšçš„ä¸€æ ·ã€‚ ä½†æ˜¯ç°åœ¨çš„é…ç½®æœ‰ç‚¹å¤æ‚ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨ haproxy çš„é…ç½®ä¸­åˆ—å‡ºæ‰€æœ‰çš„ web æœåŠ¡å™¨ã€‚ æˆ‘ä»¬æ€ä¹ˆæ‰èƒ½åšåˆ°å‘¢ï¼Ÿ</p><h3 id="HAProxy-é…ç½®templateï¼ˆæ¨¡æ¿"><a href="#HAProxy-é…ç½®templateï¼ˆæ¨¡æ¿" class="headerlink" title="HAProxy é…ç½®templateï¼ˆæ¨¡æ¿)"></a>HAProxy é…ç½®templateï¼ˆæ¨¡æ¿)</h3><p>Ansible ä½¿ç”¨äº† <a href="https://jinja.palletsprojects.com/en/2.11.x/" target="_blank" rel="noopener">Jinja2</a>, Python çš„ ä¸€ä¸ªæ¨¡æ¿å¼•æ“ã€‚ å½“æ‚¨ç¼–å†™ Jinja2æ¨¡æ¿æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Ansible å®šä¹‰çš„ä»»ä½•å˜é‡ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³è¾“å‡ºæ¨¡æ¿å½“å‰ç”Ÿæˆçš„ä¸»æœºçš„åº“å­˜åç§°ï¼Œåªéœ€åœ¨ <code>jinja</code> æ¨¡æ¿ä¸­å†™å…¥ `&#123; inventory hostname &#125; </p><p>æˆ–è€…å¦‚æœä½ éœ€è¦ç¬¬ä¸€ä¸ªä»¥å¤ªç½‘æ¥å£çš„ IP åœ°å€(å¤šäºäº† <code>setup</code> æ¨¡å—ï¼Œæ‰€ä»¥ansible æ‰çŸ¥é“) ï¼Œä½ åªéœ€è¦å†™:  &#123;&#123; ansible_default_ipv4.address &#125;&#125; (ç›¸å½“äº  &#123;&#123; ansible_default_ipv4[â€˜addressâ€™] &#125;&#125; )</p><p>Jinja2æ¨¡æ¿è¿˜æ”¯æŒæ¡ä»¶ã€ for-loop ç­‰ã€‚</p><p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>templates/</code> ç›®å½•å¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ª jinja æ¨¡æ¿ã€‚ æˆ‘ä»¬ç§°ä¹‹ä¸º<code>haproxy.cfg.j2</code>ã€‚ æˆ‘ä»¬ä½¿ç”¨ <code>.j2</code> æ‰©å±•åï¼Œä»¥æ˜¾ç¤ºè¿™æ˜¯ä¸€ä¸ª Jinja2æ¨¡æ¿ï¼Œä½†è¿™æ˜¯ä¸å¿…è¦çš„ã€‚</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">global</span><br><span class="line">    daemon</span><br><span class="line">    maxconn <span class="number">256</span></span><br><span class="line"></span><br><span class="line">defaults</span><br><span class="line">    mode http</span><br><span class="line">    timeout connect <span class="number">5000</span>ms</span><br><span class="line">    timeout client <span class="number">50000</span>ms</span><br><span class="line">    timeout server <span class="number">50000</span>ms</span><br><span class="line"></span><br><span class="line">listen cluster</span><br><span class="line">    bind  &amp;#<span class="number">123</span>; &amp;#<span class="number">123</span>; ansible_host &amp;#<span class="number">125</span>;&amp;#<span class="number">125</span>;<span class="number">80</span></span><br><span class="line">    mode http</span><br><span class="line">    stats enable</span><br><span class="line">    balance roundrobin</span><br><span class="line"></span><br><span class="line">&amp;#<span class="number">123</span>;% <span class="keyword">for</span> backend <span class="keyword">in</span> groups[<span class="string">'web'</span>] %&amp;#<span class="number">125</span>;    server  &amp;#<span class="number">123</span>;&amp;#<span class="number">123</span>; hostvars[backend][<span class="string">'ansible_hostname'</span>] &amp;#<span class="number">125</span>;&amp;#<span class="number">125</span>; &amp;#<span class="number">123</span>;&amp;#<span class="number">123</span>; hostvars[backend].ansible_host &amp;#<span class="number">125</span>;&amp;#<span class="number">125</span>;check port <span class="number">80</span></span><br><span class="line">&amp;#<span class="number">123</span>;% endfor %&amp;#<span class="number">125</span>;    option httpchk HEAD /index.php HTTP/<span class="number">1.0</span></span><br></pre></td></tr></table></figure><ul><li>PSï¼š ä»¥ä¸Šçš„<code>&amp;#123;</code>ä¸º<code>{</code>,<code>&amp;#125;</code>ä¸º<code>}</code>ï¼Œå‡ä¸ºmarkdownè¯­æ³•ï¼Œè¿™æ˜¯å› ä¸º â€œ&#123;&#123;  &#125;&#125;â€ ä¸ºå½“å‰åšå®¢æ¨¡æ¿æ‰€ä½¿ç”¨åˆ°çš„è¯­æ³•ï¼Œä¸è½¬ä¹‰ä¼šå‘ç”Ÿé”™è¯¯</li></ul><p>æˆ‘ä»¬è¿™é‡Œæœ‰å¾ˆå¤šæ–°å¥‡äº‹ç‰©</p><p>é¦–å…ˆï¼Œâ€ &#123;&#123; ansible host &#125;&#125;â€ å°†è¢«æœåŠ¡å™¨çš„ç¬¬äºŒä¸ª IP æ›¿æ¢ï¼Œè¿™ä¸ª IP æ°å¥½æ˜¯192.168.33.10ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ªç¯ã€‚ æ­¤å¾ªç¯ç”¨äºæ„å»ºåç«¯æœåŠ¡å™¨åˆ—è¡¨ã€‚ å®ƒå°†å¾ªç¯éå† <code>[web]ç»„</code> ä¸­åˆ—å‡ºçš„æ¯ä¸ªä¸»æœº(å¹¶å°†æ­¤ä¸»æœºæ”¾å…¥åç«¯å˜é‡ä¸­)ã€‚ å¯¹äºæ¯ä¸ªä¸»æœºï¼Œå®ƒå°†ä½¿ç”¨ä¸»æœºçš„<code>facts</code> å‘ˆç°ä¸€è¡Œã€‚ æ‰€æœ‰ä¸»æœºçš„ <code>facts</code> éƒ½åœ¨ <code>hostvars</code> å˜é‡ä¸­è¢«è®¾ç½®ï¼Œå› æ­¤å¾ˆå®¹æ˜“è®¿é—®å…¶ä»–ä¸»æœºå˜é‡(æ¯”å¦‚å®ƒçš„ä¸»æœºåæˆ–åœ¨æœ¬ä¾‹ä¸­çš„ IP)ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨æ‰‹å†™ä¸»æœºåˆ—è¡¨ï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰ä¸¤ä¸ªä¸»æœºã€‚ ä½†æ˜¯æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªæœåŠ¡å™¨é›†ç¾¤è§„æ¨¡èƒ½å¤Ÿéå¸¸å¤§ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç™¾ä¸ªè¿™æ ·çš„æœåŠ¡å™¨ã€‚ å› æ­¤ï¼Œå‘é…ç½®ä¸­æ·»åŠ æœåŠ¡å™¨æˆ–è€…äº¤æ¢ä¸€äº›æœåŠ¡å™¨å¯ä»¥å½’ç»“ä¸ºä» <code>[web]</code> ç»„ä¸­æ·»åŠ æˆ–åˆ é™¤ä¸»æœºã€‚</p><h3 id="Haproxy-çš„å‰§æœ¬"><a href="#Haproxy-çš„å‰§æœ¬" class="headerlink" title="Haproxy çš„å‰§æœ¬"></a>Haproxy çš„å‰§æœ¬</h3><p>æˆ‘ä»¬å·²ç»å®Œæˆäº†è¿™é¡¹å·¥ä½œä¸­æœ€å›°éš¾çš„éƒ¨åˆ†ï¼Œç¼–å†™ä¸€ä¸ªå®‰è£…å’Œé…ç½® HAproxy çš„å‰§æœ¬æ˜¯ä¸€ä»¶è½»è€Œæ˜“ä¸¾çš„äº‹æƒ…:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- hosts:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">  gather_facts:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">haproxy</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Installs</span> <span class="string">haproxy</span> <span class="string">load</span> <span class="string">balancer</span></span><br><span class="line"><span class="attr">      apt:</span></span><br><span class="line"><span class="attr">        pkg:</span> <span class="string">haproxy</span></span><br><span class="line"><span class="attr">        state:</span> <span class="string">present</span></span><br><span class="line"><span class="attr">        update_cache:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Pushes</span> <span class="string">configuration</span></span><br><span class="line"><span class="attr">      template:</span></span><br><span class="line"><span class="attr">        src:</span> <span class="string">templates/haproxy.cfg.j2</span></span><br><span class="line"><span class="attr">        dest:</span> <span class="string">/etc/haproxy/haproxy.cfg</span></span><br><span class="line"><span class="attr">        mode:</span> <span class="number">0640</span></span><br><span class="line"><span class="attr">        owner:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">        group:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">      notify:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">restart</span> <span class="string">haproxy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Sets</span> <span class="string">default</span> <span class="string">starting</span> <span class="string">flag</span> <span class="string">to</span> <span class="number">1</span></span><br><span class="line"><span class="attr">      lineinfile:</span></span><br><span class="line"><span class="attr">        dest:</span> <span class="string">/etc/default/haproxy</span></span><br><span class="line"><span class="attr">        regexp:</span> <span class="string">"^ENABLED"</span></span><br><span class="line"><span class="attr">        line:</span> <span class="string">"ENABLED=1"</span></span><br><span class="line"><span class="attr">      notify:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">restart</span> <span class="string">haproxy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  handlers:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">restart</span> <span class="string">haproxy</span></span><br><span class="line"><span class="attr">      service:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">haproxy</span></span><br><span class="line"><span class="attr">        state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥å¾ˆçœ¼ç†Ÿï¼Œæ˜¯å§ï¼Ÿ è¿™é‡Œå”¯ä¸€çš„æ–°æ¨¡å—æ˜¯ <code>template</code>ï¼Œå®ƒå…·æœ‰ä¸ <code>copy</code> ç›¸åŒçš„å‚æ•°ã€‚ æˆ‘ä»¬è¿˜å°†è¿™ä¸ªå‰§æœ¬é™åˆ¶åœ¨ <code>group haproxy</code></p><p>ç°åœ¨â€¦ è®©æˆ‘ä»¬è¯•è¯•è¿™ä¸ªã€‚ å› ä¸ºæˆ‘ä»¬çš„åº“å­˜åªåŒ…å«é›†ç¾¤æ‰€éœ€çš„ä¸»æœºï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦é™åˆ¶ä¸»æœºåˆ—è¡¨ï¼Œç”šè‡³å¯ä»¥åŒæ—¶è¿è¡Œä¸¤ä¸ªå‰§æœ¬ã€‚ å¥½å§ï¼Œè¯´å®è¯ï¼Œæˆ‘ä»¬å¿…é¡»åŒæ—¶è¿è¡Œè¿™ä¸¤ä¸ªæœåŠ¡å™¨ï¼Œå› ä¸º haproxy playbook éœ€è¦ä¸¤ä¸ª web æœåŠ¡å™¨æä¾› <code>facts</code> åœ¨æ­¥éª¤11ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•é¿å…è¿™ç§æƒ…å†µã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook -i step-10/hosts step-10/apache.yml step-10/haproxy.yml</span><br><span class="line"></span><br><span class="line">PLAY [web] *********************</span><br><span class="line"></span><br><span class="line">GATHERING FACTS *********************</span><br><span class="line">ok: [host1]</span><br><span class="line">ok: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Updates apt cache] *********************</span><br><span class="line">ok: [host1]</span><br><span class="line">ok: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Installs necessary packages] *********************</span><br><span class="line">ok: [host1] =&gt; (<span class="attribute">item</span>=apache2,libapache2-mod-php,git)</span><br><span class="line">ok: [host2] =&gt; (<span class="attribute">item</span>=apache2,libapache2-mod-php,git)</span><br><span class="line"></span><br><span class="line">TASK: [Push future<span class="built_in"> default </span>virtual host configuration] *********************</span><br><span class="line">ok: [host2]</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Activates our virtualhost] *********************</span><br><span class="line">changed: [host1]</span><br><span class="line">changed: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Check that our<span class="built_in"> config </span>is valid] *********************</span><br><span class="line">changed: [host1]</span><br><span class="line">changed: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Rolling back - Restoring old<span class="built_in"> default </span>virtualhost] *********************</span><br><span class="line">skipping: [host1]</span><br><span class="line">skipping: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Rolling back - Removing out virtualhost] *********************</span><br><span class="line">skipping: [host1]</span><br><span class="line">skipping: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Rolling back - Ending playbook] *********************</span><br><span class="line">skipping: [host1]</span><br><span class="line">skipping: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Deploy our awesome application] *********************</span><br><span class="line">ok: [host2]</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Deactivates the<span class="built_in"> default </span>virtualhost] *********************</span><br><span class="line">changed: [host1]</span><br><span class="line">changed: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Deactivates the<span class="built_in"> default </span>ssl virtualhost] *********************</span><br><span class="line">changed: [host2]</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">NOTIFIED: [restart apache] *********************</span><br><span class="line">changed: [host2]</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">PLAY RECAP *********************</span><br><span class="line">host1              : <span class="attribute">ok</span>=10   <span class="attribute">changed</span>=5    <span class="attribute">unreachable</span>=0    <span class="attribute">failed</span>=0</span><br><span class="line">host2              : <span class="attribute">ok</span>=10   <span class="attribute">changed</span>=5    <span class="attribute">unreachable</span>=0    <span class="attribute">failed</span>=0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PLAY [haproxy] *********************</span><br><span class="line"></span><br><span class="line">GATHERING FACTS *********************</span><br><span class="line">ok: [host0]</span><br><span class="line"></span><br><span class="line">TASK: [Installs haproxy load balancer] *********************</span><br><span class="line">changed: [host0]</span><br><span class="line"></span><br><span class="line">TASK: [Pushes configuration] *********************</span><br><span class="line">changed: [host0]</span><br><span class="line"></span><br><span class="line">TASK: [Sets<span class="built_in"> default </span>starting flag <span class="keyword">to</span> 1] *********************</span><br><span class="line">changed: [host0]</span><br><span class="line"></span><br><span class="line">NOTIFIED: [restart haproxy] *********************</span><br><span class="line">changed: [host0]</span><br><span class="line"></span><br><span class="line">PLAY RECAP *********************</span><br><span class="line">host0              : <span class="attribute">ok</span>=5    <span class="attribute">changed</span>=4    <span class="attribute">unreachable</span>=0    <span class="attribute">failed</span>=0</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥ä¸é”™ï¼Œç°åœ¨å» <a href="http://192.168.33.10/" target="_blank" rel="noopener">http://192.168.33.10/</a> çœ‹çœ‹ç»“æœï¼Œä½ çš„é›†ç¾¤å·²ç»éƒ¨ç½²å¥½äº†ï¼</p><p>ä½ ç”šè‡³å¯ä»¥åœ¨ <a href="http://192.168.33.10/HAProxy?stats" target="_blank" rel="noopener">http://192.168.33.10/HAProxy?stats</a> çœ‹åˆ° HAProxy çš„ç»Ÿè®¡æ•°æ®</p><p>ç°åœ¨è¿›å…¥ <code>step-11</code> ä¸­å…³äºâ€œå˜é‡â€çš„ä¸‹ä¸€ç« ã€‚</p><h1 id="step-11-å†æ¬¡æ¢ç´¢å˜é‡"><a href="#step-11-å†æ¬¡æ¢ç´¢å˜é‡" class="headerlink" title="step-11 å†æ¬¡æ¢ç´¢å˜é‡"></a>step-11 å†æ¬¡æ¢ç´¢å˜é‡</h1><p>å› æ­¤ï¼Œæˆ‘ä»¬å·²ç»è®¾ç½®äº†è´Ÿè½½å‡è¡¡å™¨ï¼Œå®ƒå·¥ä½œå¾—éå¸¸å¥½ã€‚ æˆ‘ä»¬ä» <code>facts</code> ä¸­è·å–å˜é‡å¹¶ä½¿ç”¨å®ƒä»¬æ¥æ„å»ºé…ç½®ã€‚ ä½†æ˜¯ Ansible ä¹Ÿæ”¯æŒå…¶ä»–ç±»å‹çš„å˜é‡ã€‚ æˆ‘ä»¬å·²ç»åœ¨åº“å­˜ä¸­è§è¿‡äº† <code>ansible_host</code> ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨å®šä¹‰åœ¨åœ¨ <code>host_vars</code> å’Œ <code>group_vars</code> æ–‡ä»¶ä¸­çš„å˜é‡ã€‚</p><h3 id="å¾®è°ƒæˆ‘ä»¬çš„-HAProxy-é…ç½®"><a href="#å¾®è°ƒæˆ‘ä»¬çš„-HAProxy-é…ç½®" class="headerlink" title="å¾®è°ƒæˆ‘ä»¬çš„ HAProxy é…ç½®"></a>å¾®è°ƒæˆ‘ä»¬çš„ HAProxy é…ç½®</h3><p>Haproxy é€šå¸¸æ£€æŸ¥åç«¯æ˜¯å¦æ˜¯æ´»åŠ¨çš„ã€‚ å½“ä¸€ä¸ªåç«¯çœ‹èµ·æ¥æ­»äº†ï¼Œå®ƒå°±ä¼šä»åç«¯æ± ä¸­åˆ é™¤ï¼Œä¸” HAproxy ä¸å†å‘å®ƒå‘é€è¯·æ±‚ã€‚</p><p>åç«¯è¿˜å¯ä»¥æœ‰ä¸åŒçš„æƒé‡(åœ¨0åˆ°256ä¹‹é—´)ã€‚ æƒé‡è¶Šé«˜ï¼Œä¸å…¶ä»–åç«¯ç›¸æ¯”ï¼Œåç«¯å°†æ¥æ”¶çš„è¿æ¥æ•°é‡è¶Šå¤šã€‚ å¦‚æœèŠ‚ç‚¹çš„èƒ½åŠ›ä¸å¤Ÿå¼ºå¤§ï¼Œé‚£ä¹ˆæ›´å¥½åœ°ä¼ æ’­æµé‡æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</p><p>æˆ‘ä»¬å°†ä½¿ç”¨å˜é‡æ¥é…ç½®æ‰€æœ‰è¿™äº›å‚æ•°ã€‚</p><h3 id="Group-vars"><a href="#Group-vars" class="headerlink" title="Group vars"></a>Group vars</h3><p>Check interval å°†åœ¨ haproxy çš„ <code>group_vars</code> æ–‡ä»¶ä¸­è®¾ç½®ã€‚ è¿™å°†ç¡®ä¿æ‰€æœ‰çš„ <code>haproxy</code> å°†ç»§æ‰¿å®ƒã€‚</p><p>æˆ‘ä»¬åªéœ€è¦åœ¨åº“å­˜ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ <code>groups_vars/haproxy.yml</code>ã€‚ æ–‡ä»¶å¿…é¡»è¦ä»¥ä¸ºå…¶å®šä¹‰å˜é‡çš„ç»„å‘½åã€‚ å¦‚æœæˆ‘ä»¬æƒ³ä¸º web ç»„å®šä¹‰å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶åº”è¯¥å‘½åä¸º <code>group _vars/web.xml</code></p><p><strong>è¯·æ³¨æ„</strong>ã€‚ <code>.yml</code> æ˜¯å¯é€‰çš„: æˆ‘ä»¬å¯ä»¥å°† haproxy çš„ç»„å˜é‡æ–‡ä»¶å‘½åä¸º <code>groups_vars/haproxy</code> ã€‚è¿™ä¸ªæ‰©å±•ååªæ˜¯å¸®åŠ©ç¼–è¾‘å™¨é€‰æ‹©æ­£ç¡®çš„è¯­æ³•ä½¿å…¶é«˜äº®ã€‚</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">haproxy_check_interval:</span> <span class="number">3000</span></span><br><span class="line"><span class="symbol">haproxy_stats_socket:</span> <span class="meta-keyword">/tmp/</span>sock</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåå­—æ˜¯éšæ„çš„ã€‚ å½“ç„¶ï¼Œå»ºè®®ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°ï¼Œè¿™é‡Œæ²¡æœ‰ä»€ä¹ˆå¿…è¦çš„è¯­æ³•ã€‚ ä½ ç”šè‡³å¯ä»¥åƒè¿™æ ·ä½¿ç”¨ <code>complex variables</code>(ä¹Ÿå°±æ˜¯ Python dict) :</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">haproxy:</span></span><br><span class="line"><span class="symbol">    check_interval:</span> <span class="number">3000</span></span><br><span class="line"><span class="symbol">    stats_socket:</span> <span class="meta-keyword">/tmp/</span>sock</span><br></pre></td></tr></table></figure><p>è¿™åªæ˜¯å“å‘³é—®é¢˜ã€‚ <code>complex variables</code> å¯ä»¥æ›´åŠ æœ‰é€»è¾‘åœ°åˆ†ç»„ä¸œè¥¿ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒä»¬è¿˜å¯ä»¥åˆå¹¶éšåå®šä¹‰çš„é”®(ä½†æ˜¯è¯·æ³¨æ„ï¼Œè¿™ä¸æ˜¯é»˜è®¤çš„å¯åˆå¹¶è¡Œä¸º)ã€‚ ç°åœ¨æˆ‘ä»¬åªä½¿ç”¨ç®€å•çš„å˜é‡ã€‚</p><h3 id="Hosts-vars"><a href="#Hosts-vars" class="headerlink" title="Hosts vars"></a>Hosts vars</h3><p><code>Hosts vars</code> éµå¾ªå®Œå…¨ç›¸åŒçš„è§„åˆ™ï¼Œä½†æ˜¯æ–‡ä»¶å­˜å‚¨åœ¨ <code>host_vars</code> ç›®å½•ä¸‹</p><p>è®©æˆ‘ä»¬åœ¨ <code>hosts_vars/host1.example.com</code> ä¸­å®šä¹‰åç«¯çš„æƒé‡:<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">haproxy_backend_weight: <span class="number">100</span></span><br></pre></td></tr></table></figure></p><p>ä»¥åŠ <code>host_vars/host2.example.com</code>:<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">haproxy_backend_weight: <span class="number">150</span></span><br></pre></td></tr></table></figure></p><p>å¦‚æœæˆ‘ä»¬åœ¨ <code>group_vars/web</code> ä¸­å®šä¹‰ haproxy åç«¯æƒé‡ï¼Œå®ƒå°†è¢«ç”¨ä½œâ€œç¼ºçœâ€ : åœ¨ <code>host_vars</code> æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡å°†è¦†ç›– <code>group_vars</code> ä¸­å®šä¹‰çš„å˜é‡ã€‚</p><h3 id="æ›´æ–°æ¨¡æ¿"><a href="#æ›´æ–°æ¨¡æ¿" class="headerlink" title="æ›´æ–°æ¨¡æ¿"></a>æ›´æ–°æ¨¡æ¿</h3><p>å¿…é¡»æ›´æ–°æ¨¡æ¿ä»¥ä½¿ç”¨è¿™äº›å˜é‡ã€‚<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">global</span><br><span class="line">    daemon</span><br><span class="line">    maxconn <span class="number">256</span></span><br><span class="line">&amp;#<span class="number">123</span>;% <span class="keyword">if</span> haproxy_stats_socket %&amp;#<span class="number">125</span>;    stats socket  &amp;#<span class="number">123</span>; &amp;#<span class="number">123</span>; haproxy_stats_socket &amp;#<span class="number">125</span>;&amp;#<span class="number">125</span>;&amp;#<span class="number">123</span>;% endif %&amp;#<span class="number">125</span>;</span><br><span class="line">defaults</span><br><span class="line">    mode http</span><br><span class="line">    timeout connect <span class="number">5000</span>ms</span><br><span class="line">    timeout client <span class="number">50000</span>ms</span><br><span class="line">    timeout server <span class="number">50000</span>ms</span><br><span class="line"></span><br><span class="line">listen cluster</span><br><span class="line">    bind  &amp;#<span class="number">123</span>; &amp;#<span class="number">123</span>; ansible_all_ipv4_addresses<span class="number">.1</span> &amp;#<span class="number">125</span>;&amp;#<span class="number">125</span>;<span class="number">80</span></span><br><span class="line">    mode http</span><br><span class="line">    stats enable</span><br><span class="line">    balance roundrobin</span><br><span class="line">&amp;#<span class="number">123</span>;% <span class="keyword">for</span> backend <span class="keyword">in</span> groups[<span class="string">'web'</span>] %&amp;#<span class="number">125</span>;    server  &amp;#<span class="number">123</span>; &amp;#<span class="number">123</span>; hostvars[backend][<span class="string">'ansible_hostname'</span>] &amp;#<span class="number">125</span>;&amp;#<span class="number">125</span>; &amp;#<span class="number">123</span>; &amp;#<span class="number">123</span>; hostvars[backend].ansible_all_ipv4_addresses<span class="number">.1</span> &amp;#<span class="number">125</span>;&amp;#<span class="number">125</span>;check port <span class="number">80</span></span><br><span class="line">&amp;#<span class="number">123</span>;% endfor %&amp;#<span class="number">125</span>;    option httpchk HEAD /index.php HTTP/<span class="number">1.0</span></span><br></pre></td></tr></table></figure></p><p><strong>æ³¨æ„</strong>ï¼Œæˆ‘ä»¬è¿˜å¼•å…¥äº†<code>&amp;#123;% if...</code> ã€‚ åªæœ‰åœ¨æµ‹è¯•ä¸ºçœŸæ—¶ï¼Œæ‰ä¼šä½¿ç”¨è¿™ä¸ªå°é—­çš„å—ã€‚ å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æŸä¸ªåœ°æ–¹ä¸ºè´Ÿè½½å‡è¡¡å™¨å®šä¹‰äº† <code>haproxy_stats_socket</code> (æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ <code>--extra-varsâ€œ haproxy_stats_sockets /tmp/sockâ€</code>) ï¼Œé‚£ä¹ˆå°é—­å…¶ä¸­çš„é…ç½®è¡Œå°†å‡ºç°åœ¨ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ä¸­(æ³¨æ„ï¼Œå»ºè®®çš„è®¾ç½®éå¸¸ä¸å®‰å…¨!) </p><p>è®©æˆ‘ä»¬è¯•è¯•çœ‹</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -i step<span class="number">-11</span>/hosts step<span class="number">-11</span>/haproxy.yml</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥ï¼Œä½†æ˜¯æ²¡æœ‰å¿…è¦è¿è¡Œ apache çš„å‰§æœ¬ï¼Œå› ä¸ºä»€ä¹ˆéƒ½æ²¡æœ‰æ”¹å˜ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å¾—ä¸ä¸ºæ­¤ä½œå¼Šã€‚ ä»¥ä¸‹æ˜¯æœ€æ–°çš„ haproxy å‰§æœ¬:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- hosts:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">  gather_facts:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">haproxy</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Installs</span> <span class="string">haproxy</span> <span class="string">load</span> <span class="string">balancer</span></span><br><span class="line"><span class="attr">      apt:</span></span><br><span class="line"><span class="attr">        pkg:</span> <span class="string">haproxy</span></span><br><span class="line"><span class="attr">        state:</span> <span class="string">present</span></span><br><span class="line"><span class="attr">        update_cache:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Pushes</span> <span class="string">configuration</span></span><br><span class="line"><span class="attr">      template:</span></span><br><span class="line"><span class="attr">        src:</span> <span class="string">templates/haproxy.cfg.j2</span></span><br><span class="line"><span class="attr">        dest:</span> <span class="string">/etc/haproxy/haproxy.cfg</span></span><br><span class="line"><span class="attr">        mode:</span> <span class="number">0640</span></span><br><span class="line"><span class="attr">        owner:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">        group:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">      notify:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">restart</span> <span class="string">haproxy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Sets</span> <span class="string">default</span> <span class="string">starting</span> <span class="string">flag</span> <span class="string">to</span> <span class="number">1</span></span><br><span class="line"><span class="attr">      lineinfile:</span></span><br><span class="line"><span class="attr">        dest:</span> <span class="string">/etc/default/haproxy</span></span><br><span class="line"><span class="attr">        regexp:</span> <span class="string">"^ENABLED"</span></span><br><span class="line"><span class="attr">        line:</span> <span class="string">"ENABLED=1"</span></span><br><span class="line"><span class="attr">      notify:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">restart</span> <span class="string">haproxy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  handlers:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">restart</span> <span class="string">haproxy</span></span><br><span class="line"><span class="attr">      service:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">haproxy</span></span><br><span class="line"><span class="attr">        state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure></p><p>çœ‹åˆ°äº†å—ï¼Ÿ æˆ‘ä»¬åœ¨é¡¶éƒ¨ä¸º web ä¸»æœºæ·»åŠ äº†ä¸€ä¸ªç©ºçš„å‰§æœ¬ã€‚ å®ƒé™¤äº†æ”¶é›† <code>facts</code> ä»¥å¤–ä»€ä¹ˆä¹Ÿä¸åšã€‚ ä½†æ˜¯å®ƒå¿…é¡»åœ¨è¿™é‡Œï¼Œå› ä¸ºå®ƒå°†è§¦å‘ <code>facts</code> æ”¶é›†åœ¨ä¸»æœºä¸Šçš„ç¾¤ç»„ç½‘ç»œã€‚ è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸º haproxy playbook éœ€è¦ä»è¿™ä¸ªç»„çš„ä¸»æœºä¸­é€‰æ‹© <code>facts</code> ã€‚ å¦‚æœæˆ‘ä»¬ä¸è¿™æ ·åšï¼Œansible å¯èƒ½ä¼šæŠ±æ€¨è¯´ <code>ansible_all_ipv4_addresses</code>éƒ½ä¸å­˜åœ¨</p><p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å·²ç»åœ¨å‰é¢çš„æ­¥éª¤ä¸­æåˆ°äº†è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰æåˆ°å®ƒã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="ansible" scheme="http://yoursite.com/tags/ansible/"/>
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘: ansible-tutoï¼ˆ08-09ï¼‰</title>
    <link href="http://yoursite.com/2020/05/16/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8808-09%EF%BC%89/"/>
    <id>http://yoursite.com/2020/05/16/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8808-09%EF%BC%89/</id>
    <published>2020-05-16T02:26:11.000Z</published>
    <updated>2020-05-16T09:33:52.590Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="step08-ä»-git-éƒ¨ç½²æˆ‘ä»¬çš„ç½‘ç«™"><a href="#step08-ä»-git-éƒ¨ç½²æˆ‘ä»¬çš„ç½‘ç«™" class="headerlink" title="step08 ä» git éƒ¨ç½²æˆ‘ä»¬çš„ç½‘ç«™"></a>step08 ä» git éƒ¨ç½²æˆ‘ä»¬çš„ç½‘ç«™</h1><p>æˆ‘ä»¬å·²ç»å®‰è£…äº† apacheï¼Œè®¾ç½®äº†è™šæ‹Ÿä¸»æœºï¼Œå¹¶å®‰å…¨åœ°é‡æ–°å¯åŠ¨äº†æœåŠ¡å™¨ã€‚ ç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨ git æ¨¡å—æ¥éƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚</p><h3 id="Git-æ¨¡å—"><a href="#Git-æ¨¡å—" class="headerlink" title="Git æ¨¡å—"></a>Git æ¨¡å—</h3><p>è¿™æ˜¯ä¸€ä¸ªå°æ”¾æ¾ï¼Œæ²¡æœ‰ä»€ä¹ˆæ–°çš„ä¸œè¥¿ã€‚<code>git</code> æ¨¡å—åªæ˜¯å¦ä¸€ä¸ªæ¨¡å—ã€‚ å°½ç®¡æˆ‘ä»¬åªæ˜¯ä¸ºäº†å¥½ç©è€Œå°è¯•ã€‚å½“å®ƒæ¶‰åŠ <code>ansible-pull</code>ä»¥åï¼Œæˆ‘ä»¬å°†æ›´åŠ ç†Ÿæ‚‰å®ƒï¼Œ</p><p>æˆ‘ä»¬çš„è™šæ‹Ÿæœºå·²ç»è®¾ç½®å¥½äº†ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ä¸€äº›æ›´æ”¹æ¥å®Œæˆéƒ¨ç½²ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬æ­£åœ¨éƒ¨ç½²ä¸€ä¸ª PHP åº”ç”¨ç¨‹åºã€‚ å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… <code>libapache2-mod-php</code> åŒ…ã€‚ å…¶æ¬¡ï¼Œæˆ‘ä»¬å¿…é¡»å®‰è£… gitï¼Œå› ä¸º <code>git</code> æ¨¡å—(ç”¨äºå…‹éš†æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„ git å­˜å‚¨åº“)å°†ä½¿ç”¨å®ƒã€‚</p><p>æˆ‘ä»¬å¯ä»¥è¿™æ ·åš:<br><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">- name: Installs apache web server</span><br><span class="line">  apt:</span><br><span class="line">    pkg: apache2</span><br><span class="line">    <span class="keyword">state</span>: present</span><br><span class="line">    update_cache: true</span><br><span class="line"></span><br><span class="line">- name: Installs php module</span><br><span class="line">  apt:</span><br><span class="line">    pkg: libapache2-mod-php</span><br><span class="line">    <span class="keyword">state</span>: present</span><br><span class="line"></span><br><span class="line">- name: Installs git</span><br><span class="line">  apt:</span><br><span class="line">    pkg: git</span><br><span class="line">    <span class="keyword">state</span>: present</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ ansible æä¾›äº†ä¸€ç§æ›´æ˜“è¯»çš„ç¼–å†™æ–¹å¼ã€‚ Ansible å¯ä»¥åœ¨ä¸€ç³»åˆ— <code>items</code> ä¸Šå¾ªç¯éå†ï¼Œå¹¶åœ¨ä¸€ä¸ªåŠ¨ä½œä¸­ä½¿ç”¨æ¯ä¸ª <code>item</code> :<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- hosts:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Installs</span> <span class="string">necessary</span> <span class="string">packages</span></span><br><span class="line"><span class="attr">      apt:</span></span><br><span class="line"><span class="attr">        pkg:</span> <span class="string">"<span class="template-variable">&#123;&#123; item &#125;&#125;</span>"</span></span><br><span class="line"><span class="attr">        state:</span> <span class="string">latest</span></span><br><span class="line"><span class="attr">        update_cache:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      with_items:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">apache2</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">libapache2-mod-php</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">git</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Push</span> <span class="string">future</span> <span class="string">default</span> <span class="string">virtual</span> <span class="string">host</span> <span class="string">configuration</span></span><br><span class="line"><span class="attr">      copy:</span></span><br><span class="line"><span class="attr">        src:</span> <span class="string">files/awesome-app</span></span><br><span class="line"><span class="attr">        dest:</span> <span class="string">/etc/apache2/sites-available/</span></span><br><span class="line"><span class="attr">        mode:</span> <span class="number">0640</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Activates</span> <span class="string">our</span> <span class="string">virtualhost</span></span><br><span class="line"><span class="attr">      command:</span> <span class="string">a2ensite</span> <span class="string">awesome-app</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Check</span> <span class="string">that</span> <span class="string">our</span> <span class="string">config</span> <span class="string">is</span> <span class="string">valid</span></span><br><span class="line"><span class="attr">      command:</span> <span class="string">apache2ctl</span> <span class="string">configtest</span></span><br><span class="line"><span class="attr">      register:</span> <span class="string">result</span></span><br><span class="line"><span class="attr">      ignore_errors:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Rolling</span> <span class="string">back</span> <span class="bullet">-</span> <span class="string">Restoring</span> <span class="string">old</span> <span class="string">default</span> <span class="string">virtualhost</span></span><br><span class="line"><span class="attr">      command:</span> <span class="string">a2ensite</span> <span class="string">default</span></span><br><span class="line"><span class="attr">      when:</span> <span class="string">result</span> <span class="string">is</span> <span class="string">failed</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Rolling</span> <span class="string">back</span> <span class="bullet">-</span> <span class="string">Removing</span> <span class="string">out</span> <span class="string">virtualhost</span></span><br><span class="line"><span class="attr">      command:</span> <span class="string">a2dissite</span> <span class="string">awesome-app</span></span><br><span class="line"><span class="attr">      when:</span> <span class="string">result</span> <span class="string">is</span> <span class="string">failed</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Rolling</span> <span class="string">back</span> <span class="bullet">-</span> <span class="string">Ending</span> <span class="string">playbook</span></span><br><span class="line"><span class="attr">      fail:</span></span><br><span class="line"><span class="attr">        msg:</span> <span class="string">"Configuration file is not valid. Please check that before re-running the playbook."</span></span><br><span class="line"><span class="attr">      when:</span> <span class="string">result</span> <span class="string">is</span> <span class="string">failed</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Deploy</span> <span class="string">our</span> <span class="string">awesome</span> <span class="string">application</span></span><br><span class="line"><span class="attr">      git:</span></span><br><span class="line"><span class="attr">        repo:</span> <span class="attr">https://github.com/leucos/ansible-tuto-demosite.git</span></span><br><span class="line"><span class="attr">        dest:</span> <span class="string">/var/www/awesome-app</span></span><br><span class="line"><span class="attr">      tags:</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Deactivates</span> <span class="string">the</span> <span class="string">default</span> <span class="string">virtualhost</span></span><br><span class="line"><span class="attr">      command:</span> <span class="string">a2dissite</span> <span class="string">default</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Deactivates</span> <span class="string">the</span> <span class="string">default</span> <span class="string">ssl</span> <span class="string">virtualhost</span></span><br><span class="line"><span class="attr">      command:</span> <span class="string">a2dissite</span> <span class="string">default-ssl</span></span><br><span class="line"><span class="attr">      notify:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">restart</span> <span class="string">apache</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  handlers:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">restart</span> <span class="string">apache</span></span><br><span class="line"><span class="attr">      service:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">apache2</span></span><br><span class="line"><span class="attr">        state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure></p><p>æ¥ä¸‹æ¥å¼€å§‹å§ï¼š<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook -i step-08/hosts -l host1 step-08/apache.yml</span><br><span class="line"></span><br><span class="line">PLAY [web] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line"></span><br><span class="line">GATHERING FACTS <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Updates apt cache] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Installs necessary packages] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1] =&gt; (item=apache2,libapache2-mod-php,git)</span><br><span class="line"></span><br><span class="line">TASK: [Push future default virtual host configuration] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Activates our virtualhost] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Check that our config is valid] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Rolling back - Restoring old default virtualhost] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">skipping: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Rolling back - Removing out virtualhost] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">skipping: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Rolling back - Ending playbook] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">skipping: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Deploy our awesome application] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Deactivates the default virtualhost] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Deactivates the default ssl virtualhost] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">NOTIFIED: [restart apache] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">PLAY RECAP <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">host1              : ok=10   changed=8    unreachable=0    failed=0</span><br></pre></td></tr></table></figure></p><p>ä½ ç°åœ¨å¯ä»¥æµè§ˆ <a href="http://192.168.33.11ï¼Œå®ƒåº”è¯¥ä¼šæ˜¾ç¤ºä¸€å¼ å›¾ç‰‡å’ŒæœåŠ¡å™¨çš„ä¸»æœºåã€‚" target="_blank" rel="noopener">http://192.168.33.11ï¼Œå®ƒåº”è¯¥ä¼šæ˜¾ç¤ºä¸€å¼ å›¾ç‰‡å’ŒæœåŠ¡å™¨çš„ä¸»æœºåã€‚</a></p><p><strong>æ³¨æ„</strong> <code>tags: deploy</code>  è¿™ä¸€è¡Œå…è®¸æ‚¨åªæ‰§è¡Œ playbook çš„ä¸€éƒ¨åˆ†ã€‚ æ¯”å¦‚è¯´ä½ ä¸ºä½ çš„ç½‘ç«™æ¨å‡ºäº†ä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚ æ‚¨å¸Œæœ›åŠ å¿«å¤„ç†é€Ÿåº¦ï¼Œåªæ‰§è¡Œå¤„ç† <code>deploy</code> çš„éƒ¨åˆ†ã€‚ æ ‡ç­¾å…è®¸ä½ è¿™æ ·åšã€‚ å½“ç„¶ï¼Œ<code>deploy</code> åªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒæ²¡æœ‰ä»»ä½•ç‰¹å®šçš„å«ä¹‰ï¼Œå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å®ƒ:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook -i step-08/hosts -l host1 step-08/apache.yml -t deploy</span><br><span class="line">X11 forwarding request failed on channel 0</span><br><span class="line"></span><br><span class="line">PLAY [web] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line"></span><br><span class="line">GATHERING FACTS <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Deploy our awesome application] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">PLAY RECAP <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">host1              : ok=2    changed=1    unreachable=0    failed=0</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬åœ¨ <code>step-09</code> ä¸­éƒ¨ç½²å¦ä¸€ä¸ª web æœåŠ¡å™¨ã€‚</p><h1 id="step-09-æ·»åŠ å¦å¤–ä¸€ä¸ª-webserver"><a href="#step-09-æ·»åŠ å¦å¤–ä¸€ä¸ª-webserver" class="headerlink" title="step-09 æ·»åŠ å¦å¤–ä¸€ä¸ª webserver"></a>step-09 æ·»åŠ å¦å¤–ä¸€ä¸ª webserver</h1><p>æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ª webserverï¼Œè®©æˆ‘ä»¬æ·»åŠ å¦å¤–ä¸€ä¸ª</p><h3 id="æ›´æ–°åº“å­˜æ–‡ä»¶"><a href="#æ›´æ–°åº“å­˜æ–‡ä»¶" class="headerlink" title="æ›´æ–°åº“å­˜æ–‡ä»¶"></a>æ›´æ–°åº“å­˜æ–‡ä»¶</h3><p>ç”±äºæˆ‘ä»¬å¯¹æ­¤æŠ±æœ‰æœ‰å¾ˆå¤§çš„æœŸæœ›ï¼Œæˆ‘ä»¬å°†æ·»åŠ å¦ä¸€ä¸ª web æœåŠ¡å™¨å’Œä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€æ­¥é…ç½®å®ƒã€‚è®©æˆ‘ä»¬å®Œæˆå®ƒã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[web]</span><br><span class="line">host1 <span class="attribute">ansible_host</span>=192.168.33.11 <span class="attribute">ansible_user</span>=root</span><br><span class="line">host2 <span class="attribute">ansible_host</span>=192.168.33.12 <span class="attribute">ansible_user</span>=root</span><br><span class="line"></span><br><span class="line">[haproxy]</span><br><span class="line">host0 <span class="attribute">ansible_host</span>=192.168.33.10 <span class="attribute">ansible_user</span>=root</span><br></pre></td></tr></table></figure><p>è¯·è®°ä½ï¼Œ<code>ansible_host</code> åœ¨è¿™é‡ŒæŒ‡å®šå¯æ¥å—çš„ä¸»æœºï¼Œå› ä¸ºä¸»æœºçš„ IP ä¸é¢„æœŸçš„ä¸åŒ(æˆ–è€…æ— æ³•è§£æ)ã€‚ æ‚¨å¯ä»¥å°†è¿™äº›ä¸»æœºæ·»åŠ åˆ°æ‚¨çš„ <code>/etc/hosts</code> ä¸­ï¼Œè€Œä¸å¿…æ‹…å¿ƒï¼Œæˆ–è€…ä½¿ç”¨çœŸæ­£çš„ä¸»æœºå(è¿™æ˜¯å…¸å‹æƒ…å†µä¸‹åº”è¯¥åšçš„)ã€‚</p><h3 id="éƒ¨ç½²å¦ä¸€ä¸ª-webserver"><a href="#éƒ¨ç½²å¦ä¸€ä¸ª-webserver" class="headerlink" title="éƒ¨ç½²å¦ä¸€ä¸ª webserver"></a>éƒ¨ç½²å¦ä¸€ä¸ª webserver</h3><p>éƒ¨ç½²å¦ä¸€ä¸ª webserver å¾ˆç®€å•</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook -i step-09/hosts step-09/apache.yml</span><br><span class="line"></span><br><span class="line">PLAY [web] *********************</span><br><span class="line"></span><br><span class="line">GATHERING FACTS *********************</span><br><span class="line">ok: [host2]</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Updates apt cache] *********************</span><br><span class="line">ok: [host1]</span><br><span class="line">ok: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Installs necessary packages] *********************</span><br><span class="line">ok: [host1] =&gt; (<span class="attribute">item</span>=apache2,libapache2-mod-php,git)</span><br><span class="line">changed: [host2] =&gt; (<span class="attribute">item</span>=apache2,libapache2-mod-php,git)</span><br><span class="line"></span><br><span class="line">TASK: [Push future<span class="built_in"> default </span>virtual host configuration] *********************</span><br><span class="line">ok: [host1]</span><br><span class="line">changed: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Activates our virtualhost] *********************</span><br><span class="line">changed: [host2]</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Check that our<span class="built_in"> config </span>is valid] *********************</span><br><span class="line">changed: [host2]</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Rolling back - Restoring old<span class="built_in"> default </span>virtualhost] *********************</span><br><span class="line">skipping: [host1]</span><br><span class="line">skipping: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Rolling back - Removing out virtualhost] *********************</span><br><span class="line">skipping: [host1]</span><br><span class="line">skipping: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Rolling back - Ending playbook] *********************</span><br><span class="line">skipping: [host1]</span><br><span class="line">skipping: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Deploy our awesome application] *********************</span><br><span class="line">ok: [host1]</span><br><span class="line">changed: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Deactivates the<span class="built_in"> default </span>virtualhost] *********************</span><br><span class="line">changed: [host1]</span><br><span class="line">changed: [host2]</span><br><span class="line"></span><br><span class="line">TASK: [Deactivates the<span class="built_in"> default </span>ssl virtualhost] *********************</span><br><span class="line">changed: [host2]</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">NOTIFIED: [restart apache] *********************</span><br><span class="line">changed: [host1]</span><br><span class="line">changed: [host2]</span><br><span class="line"></span><br><span class="line">PLAY RECAP *********************</span><br><span class="line">host1              : <span class="attribute">ok</span>=10   <span class="attribute">changed</span>=5    <span class="attribute">unreachable</span>=0    <span class="attribute">failed</span>=0</span><br><span class="line">host2              : <span class="attribute">ok</span>=10   <span class="attribute">changed</span>=8    <span class="attribute">unreachable</span>=0    <span class="attribute">failed</span>=0</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯ä»å‘½ä»¤è¡Œä¸­ç§»é™¤ <code>-l host1</code>ã€‚ è®°ä½ <code>-l</code> æ˜¯ä¸€ä¸ªå‚æ•°ï¼Œå®ƒé™åˆ¶äº† playbook åœ¨ç‰¹å®šä¸»æœºä¸Šè¿è¡Œã€‚ ç°åœ¨æˆ‘ä»¬ä¸å†é™åˆ¶ï¼Œå®ƒå°†è¿è¡Œåœ¨æ‰€æœ‰çš„ä¸»æœºä¸Šï¼Œåœ¨è¿™äº›ä¸»æœºä¸Šçš„å‰§æœ¬æ‰“ç®—è¿è¡Œ(å³ webç»„)ã€‚</p><p>å¦‚æœæˆ‘ä»¬åœ¨ group <code>web</code> ä¸­æœ‰å…¶ä»–æœåŠ¡å™¨ï¼Œä½†æ˜¯å¸Œæœ›å°† playbook é™åˆ¶ä¸ºä¸€ä¸ªå­é›†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ï¼Œä¾‹å¦‚:<code>-l firstthost: secondhost:...</code></p><p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†è¿™ä¸ªä¸é”™çš„ web æœåŠ¡å™¨ç»„ï¼Œè®©æˆ‘ä»¬é€šè¿‡åœ¨ <code>step-10</code> ä¸­åœ¨å®ƒä»¬å‰é¢æ”¾ç½®ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œå°†å®ƒå˜æˆä¸ºä¸€ä¸ªé›†ç¾¤ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="ansible" scheme="http://yoursite.com/tags/ansible/"/>
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘: ansible-tutoï¼ˆ06-07ï¼‰</title>
    <link href="http://yoursite.com/2020/05/15/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8806-07%EF%BC%89/"/>
    <id>http://yoursite.com/2020/05/15/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8806-07%EF%BC%89/</id>
    <published>2020-05-15T12:30:46.000Z</published>
    <updated>2020-05-15T13:32:49.731Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="step-06-å½“é…ç½®æ­£ç¡®æ—¶é‡æ–°å¯åŠ¨"><a href="#step-06-å½“é…ç½®æ­£ç¡®æ—¶é‡æ–°å¯åŠ¨" class="headerlink" title="step-06 å½“é…ç½®æ­£ç¡®æ—¶é‡æ–°å¯åŠ¨"></a>step-06 å½“é…ç½®æ­£ç¡®æ—¶é‡æ–°å¯åŠ¨</h1><p>æˆ‘ä»¬å·²ç»å®‰è£…äº† apacheï¼Œé…ç½®äº†è™šæ‹Ÿä¸»æœºï¼Œå¹¶é‡æ–°å¯åŠ¨äº†æœåŠ¡å™¨ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯å¸Œæœ›åœ¨é…ç½®æ­£ç¡®çš„æƒ…å†µä¸‹é‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼Œé‚£åˆä¼šæ€æ ·å‘¢ï¼Ÿ è®©æˆ‘ä»¬å¼€å§‹å§</p><h3 id="å½“å‡ºç°é—®é¢˜çš„æ—¶å€™åœæ­¢å·¥ä½œ"><a href="#å½“å‡ºç°é—®é¢˜çš„æ—¶å€™åœæ­¢å·¥ä½œ" class="headerlink" title="å½“å‡ºç°é—®é¢˜çš„æ—¶å€™åœæ­¢å·¥ä½œ"></a>å½“å‡ºç°é—®é¢˜çš„æ—¶å€™åœæ­¢å·¥ä½œ</h3><p>ansible æœ‰ä¸€ä¸ªä¿çš®çš„ç‰¹æ€§: å¦‚æœå‡ºç°é—®é¢˜ï¼Œå®ƒå°†åœæ­¢æ‰€æœ‰çš„å·¥ä½œã€‚ å¦‚æœé…ç½®æ–‡ä»¶æ— æ•ˆçš„è¯ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥åœæ­¢æˆ‘ä»¬çš„ playbookã€‚</p><p>è®©æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„ <code>awesome-app</code> è™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶:<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">  RocumentDoot /<span class="keyword">var</span>/www/awesome-<span class="keyword">app</span></span><br><span class="line"></span><br><span class="line">  Options -Indexes</span><br><span class="line"></span><br><span class="line">  ErrorLog /<span class="keyword">var</span>/<span class="keyword">log</span>/apache2/<span class="keyword">error</span>.<span class="built_in">log</span></span><br><span class="line">  TransferLog /<span class="keyword">var</span>/<span class="keyword">log</span>/apache2/access.<span class="built_in">log</span></span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure></p><p>å¦‚å‰æ‰€è¿°ï¼Œå½“ä»»åŠ¡å¤±è´¥æ—¶ï¼Œå¤„ç†è¿‡ç¨‹åœæ­¢ã€‚ å› æ­¤ï¼Œåœ¨é‡æ–°å¯åŠ¨æœåŠ¡å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬å°†ç¡®ä¿é…ç½®æœ‰æ•ˆã€‚ æˆ‘ä»¬è¿˜å¯ä»¥åœ¨åˆ é™¤ç¼ºçœçš„è™šæ‹Ÿä¸»æœºä¹‹å‰æ·»åŠ è™šæ‹Ÿä¸»æœºï¼Œè¿™æ ·éšåçš„é‡æ–°å¯åŠ¨(å¯èƒ½ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šå®Œæˆ)å°±ä¸ä¼šç ´å apacheã€‚</p><p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä¸€å¼€å§‹å°±åº”è¯¥è¿™æ ·åšã€‚ å› ä¸ºæˆ‘ä»¬å·²ç»è¿è¡Œäº†æˆ‘ä»¬çš„å‰§æœ¬ï¼Œé»˜è®¤çš„è™šæ‹Ÿä¸»æœºå·²ç»è¢«åœç”¨äº†ã€‚ å½“ç„¶ï¼Œå…¶ä»–æ— å…³çš„ä¸»æœºä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‰§æœ¬ï¼Œè®©æˆ‘ä»¬ä¿æŠ¤ä»–ä»¬ã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">- hosts: web</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Installs apache web server</span><br><span class="line">      apt:</span><br><span class="line">        pkg: apache2</span><br><span class="line">        state: present</span><br><span class="line">        update_cache: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    - name: Push future<span class="built_in"> default </span>virtual host configuration</span><br><span class="line">      copy:</span><br><span class="line">        src: files/awesome-app</span><br><span class="line">        dest: /etc/apache2/sites-available/</span><br><span class="line">        mode: 0640</span><br><span class="line"></span><br><span class="line">    - name: Activates our virtualhost</span><br><span class="line">      command: a2ensite awesome-app</span><br><span class="line"></span><br><span class="line">    - name: Check that our<span class="built_in"> config </span>is valid</span><br><span class="line">      command: apache2ctl configtest</span><br><span class="line"></span><br><span class="line">    - name: Deactivates the<span class="built_in"> default </span>virtualhost</span><br><span class="line">      command: a2dissite default</span><br><span class="line"></span><br><span class="line">    - name: Deactivates the<span class="built_in"> default </span>ssl virtualhost</span><br><span class="line">      command: a2dissite default-ssl</span><br><span class="line">      notify:</span><br><span class="line">        - restart apache</span><br><span class="line"></span><br><span class="line">  handlers:</span><br><span class="line">    - name: restart apache</span><br><span class="line">      service:</span><br><span class="line">        name: apache2</span><br><span class="line">        state: restarted</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¼€å§‹å§ï¼š<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PLAY [web] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line"></span><br><span class="line">GATHERING FACTS <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Installs apache web server] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Push future default virtual host configuration] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Activates our virtualhost] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Check that our config is valid] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">failed: [host1] =&gt; &#123;"changed": true, "cmd": ["apache2ctl", "configtest"], "delta": "0:00:00.045046", "end": "2013-03-08 16:09:32.002063", "rc": 1, "start": "2013-03-08 16:09:31.957017"&#125;</span><br><span class="line">stderr: Syntax error on line 2 of /etc/apache2/sites-enabled/awesome-app:</span><br><span class="line">Invalid command 'RocumentDoot', perhaps misspelled or defined by a module not included in the server configuration</span><br><span class="line">stdout: Action 'configtest' failed.</span><br><span class="line">The Apache error log may have more information.</span><br><span class="line"></span><br><span class="line">FATAL: all hosts have already failed -- aborting</span><br><span class="line"></span><br><span class="line">PLAY RECAP <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">host1              : ok=4    changed=2    unreachable=0    failed=1</span><br></pre></td></tr></table></figure></p><p>æ­£å¦‚æ‚¨å¯ä»¥çœ‹åˆ°çš„ï¼Œå› ä¸º apache2ctl åœ¨å¤±è´¥æ—¶è¿”å›é€€å‡ºä»£ç ä¸º1ï¼Œansible å‘ç°äº†è¿™ä¸€ç‚¹å¹¶åœæ­¢äº†å¤„ç†ã€‚ å¤ªå¥½äº†ï¼</p><p>å—¯ï¼Œå®é™…ä¸Šä¸æ˜¯å¾ˆå¥½â€¦ æˆ‘ä»¬çš„è™šæ‹Ÿä¸»æœºå·²ç»æ·»åŠ äº†ã€‚ ä»»ä½•åç»­çš„ apache é‡æ–°å¯åŠ¨éƒ½ä¼šæŠ±æ€¨æˆ‘ä»¬çš„é…ç½®ï¼Œç„¶åé€€å‡ºã€‚ å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥å‘ç°æ•…éšœå¹¶è¿”å›ã€‚</p><h1 id="step-07-ä½¿ç”¨æ¡ä»¶è¯­å¥"><a href="#step-07-ä½¿ç”¨æ¡ä»¶è¯­å¥" class="headerlink" title="step-07 ä½¿ç”¨æ¡ä»¶è¯­å¥"></a>step-07 ä½¿ç”¨æ¡ä»¶è¯­å¥</h1><p>æˆ‘ä»¬å·²ç»å®‰è£…äº† apacheï¼Œè®¾ç½®äº†è™šæ‹Ÿä¸»æœºï¼Œå¹¶é‡æ–°å¯åŠ¨äº†æœåŠ¡å™¨ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨å‡ºç°é—®é¢˜æ—¶ï¼Œèƒ½å¤Ÿå°†å…¶æ¢å¤åˆ°ç¨³å®šçŠ¶æ€ã€‚</p><h3 id="å½“å‡ºé”™æ—¶å›æ»š"><a href="#å½“å‡ºé”™æ—¶å›æ»š" class="headerlink" title="å½“å‡ºé”™æ—¶å›æ»š"></a>å½“å‡ºé”™æ—¶å›æ»š</h3><p>æé†’ä¸€å¥: è¿™é‡Œæ²¡æœ‰é­”æ³•ã€‚ ä¹‹å‰é…ç½®é”™è¯¯ä¸æ˜¯ <code>ansible</code> çš„é”™è¯¯ã€‚ å®ƒä¸æ˜¯ä¸€ä¸ªå¤‡ä»½ç³»ç»Ÿï¼Œå®ƒä¸èƒ½å›æ»šæ‰€æœ‰çš„ä¸œè¥¿ã€‚ ä½ çš„å·¥ä½œå°±æ˜¯ç¡®ä¿ä½ çš„å‰§æœ¬æ˜¯é…ç½®æ­£ç¡®çš„ã€‚ ansible ä¸çŸ¥é“å¦‚ä½•æ¢å¤ä¸€ä¸ª<code>2ensite awesome-app</code>ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å…³æ³¨é…ç½®é”™è¯¯æ—¶äºæ€ä¹ˆå›æ»šï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨å®ƒè¿›è¡Œå›æ»š</p><p>å¦‚å‰æ‰€è¿°ï¼Œå½“ä»»åŠ¡å¤±è´¥æ—¶ï¼Œå¤„ç†å°±ä¼šåœæ­¢â€¦ é™¤éæˆ‘ä»¬æ¥å—å¤±è´¥(æˆ‘ä»¬åº”è¯¥æ¥å—)ã€‚ è¿™å°±æ˜¯æˆ‘ä»¬è¦åšçš„: å¦‚æœå‡ºç°æ•…éšœï¼Œç»§ç»­å¤„ç†ï¼Œä½†æ˜¯åªæ¢å¤æˆ‘ä»¬å·²ç»å®Œæˆçš„æ“ä½œã€‚<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">- hosts: web</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Installs apache web server</span><br><span class="line">      apt:</span><br><span class="line">        pkg: apache2</span><br><span class="line">        state: present</span><br><span class="line">        update_cache: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    - name: Push future<span class="built_in"> default </span>virtual host configuration</span><br><span class="line">      copy:</span><br><span class="line">        src: files/awesome-app</span><br><span class="line">        dest: /etc/apache2/sites-available/</span><br><span class="line">        mode: 0640</span><br><span class="line"></span><br><span class="line">    - name: Activates our virtualhost</span><br><span class="line">      command: a2ensite awesome-app</span><br><span class="line"></span><br><span class="line">    - name: Check that our<span class="built_in"> config </span>is valid</span><br><span class="line">      command: apache2ctl configtest</span><br><span class="line">      register: result</span><br><span class="line">      ignore_errors: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    - name: Rolling back - Restoring old<span class="built_in"> default </span>virtualhost</span><br><span class="line">      command: a2ensite default</span><br><span class="line">      when: result is failed</span><br><span class="line"></span><br><span class="line">    - name: Rolling back - Removing our virtualhost</span><br><span class="line">      command: a2dissite awesome-app</span><br><span class="line">      when: result is failed</span><br><span class="line"></span><br><span class="line">    - name: Rolling back - Ending playbook</span><br><span class="line">      fail:</span><br><span class="line">        msg: <span class="string">"Configuration file is not valid. Please check that before re-running the playbook."</span></span><br><span class="line">      when: result is failed</span><br><span class="line"></span><br><span class="line">    - name: Deactivates the<span class="built_in"> default </span>virtualhost</span><br><span class="line">      command: a2dissite default</span><br><span class="line"></span><br><span class="line">    - name: Deactivates the<span class="built_in"> default </span>ssl virtualhost</span><br><span class="line">      command: a2dissite default-ssl</span><br><span class="line">      notify:</span><br><span class="line">        - restart apache</span><br><span class="line"></span><br><span class="line">  handlers:</span><br><span class="line">    - name: restart apache</span><br><span class="line">      service:</span><br><span class="line">        name: apache2</span><br><span class="line">        state: restarted</span><br></pre></td></tr></table></figure></p><p><code>register</code> å…³é”®å­—è®°å½• <code>apache2ctl configtest</code> å‘½ä»¤(exit statusã€ stdoutã€ stderrã€ â€¦)çš„è¾“å‡ºï¼Œä»¥åŠ <code>when: result is failed</code> æ£€æŸ¥æ³¨å†Œå˜é‡(<code>result</code>)æ˜¯å¦å¤±è´¥ã€‚</p><p>æ¥ä¸‹æ¥å¼€å§‹å§ï¼š<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook -i step-07/hosts -l host1 step-07/apache.yml</span><br><span class="line"></span><br><span class="line">PLAY [web] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line"></span><br><span class="line">GATHERING FACTS <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Installs apache web server] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Push future default virtual host configuration] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Activates our virtualhost] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Check that our config is valid] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">failed: [host1] =&gt; &#123;"changed": true, "cmd": ["apache2ctl", "configtest"], "delta": "0:00:00.051874", "end": "2013-03-10 10:50:17.714105", "rc": 1, "start": "2013-03-10 10:50:17.662231"&#125;</span><br><span class="line">stderr: Syntax error on line 2 of /etc/apache2/sites-enabled/awesome-app:</span><br><span class="line">Invalid command 'RocumentDoot', perhaps misspelled or defined by a module not included in the server configuration</span><br><span class="line">stdout: Action 'configtest' failed.</span><br><span class="line">The Apache error log may have more information.</span><br><span class="line">...ignoring</span><br><span class="line"></span><br><span class="line">TASK: [Rolling back - Restoring old default virtualhost] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Rolling back - Removing our virtualhost] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Rolling back - Ending playbook] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">failed: [host1] =&gt; &#123;"failed": true&#125;</span><br><span class="line">msg: Configuration file is not valid. Please check that before re-running the playbook.</span><br><span class="line"></span><br><span class="line">FATAL: all hosts have already failed -- aborting</span><br><span class="line"></span><br><span class="line">PLAY RECAP <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">host1              : ok=7    changed=4    unreachable=0    failed=1</span><br></pre></td></tr></table></figure></p><p>çœ‹èµ·æ¥æ­£å¸¸å·¥ä½œã€‚è®©æˆ‘ä»¬å°è¯•é‡æ–°å¯åŠ¨ apacheï¼Œçœ‹çœ‹å®ƒæ˜¯å¦çœŸçš„å·¥ä½œ:</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ansible -i step-<span class="number">07</span>/hosts -m service -a 'name=apache2 <span class="keyword">state</span>=restarted' host1</span><br><span class="line"></span><br><span class="line"><span class="keyword">state</span>=restarted' host1</span><br><span class="line">host1 | success &gt;&gt; &#123;</span><br><span class="line">    <span class="string">"changed"</span>: true,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"apache2"</span>,</span><br><span class="line">    <span class="string">"state"</span>: <span class="string">"started"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬çš„ apache å®‰å…¨äº†ï¼Œä¸ä¼šå‡ºç°é…ç½®é”™è¯¯ã€‚</p><p>è™½ç„¶è¿™çœ‹èµ·æ¥éœ€è¦åšå¾ˆå¤šå·¥ä½œï¼Œä½†å…¶å®ä¸ç„¶ã€‚ è¯·è®°ä½ï¼Œæ‚¨å‡ ä¹å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨å˜é‡ï¼Œå› æ­¤å¾ˆå®¹æ˜“å°†å…¶ä½œä¸º apache çš„é€šç”¨æ¨¡æ¿ï¼Œå¹¶åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒæ¥éƒ¨ç½²è™šæ‹Ÿä¸»æœºã€‚ åˆ›å»ºä¸€æ¬¡å‰§æœ¬ï¼Œå°±å¯åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ã€‚ æˆ‘ä»¬å°†åœ¨æ­¥éª¤9ä¸­å®Œæˆè¿™é¡¹å·¥ä½œï¼Œä½†æ˜¯ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨æ­¥éª¤08ä¸­ä½¿ç”¨ git éƒ¨ç½²æˆ‘ä»¬çš„ web ç«™ç‚¹ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="ansible" scheme="http://yoursite.com/tags/ansible/"/>
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘: ansible-tutoï¼ˆ04-05ï¼‰</title>
    <link href="http://yoursite.com/2020/05/13/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8804-05%EF%BC%89/"/>
    <id>http://yoursite.com/2020/05/13/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8804-05%EF%BC%89/</id>
    <published>2020-05-13T01:13:42.000Z</published>
    <updated>2020-05-13T03:38:40.917Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="step04-Ansible-playbooks"><a href="#step04-Ansible-playbooks" class="headerlink" title="step04 Ansible playbooks"></a>step04 Ansible playbooks</h1><p>Playbook çš„æ¦‚å¿µéå¸¸ç®€å•: å®ƒåªæ˜¯ä¸€ç³»åˆ—å¯æ¥å—çš„å‘½ä»¤(tasks) ï¼Œå°±åƒæˆ‘ä»¬ä½¿ç”¨ <code>ansible</code> CLI å·¥å…·æ—¶æ‰€ä½¿ç”¨çš„é‚£æ ·ã€‚ è¿™äº›ä»»åŠ¡é’ˆå¯¹ä¸€ç»„ç‰¹å®šçš„ä¸»æœº/ç»„ã€‚</p><p>è¿™ä¸ªæ­¥éª¤æ‰€éœ€çš„æ–‡ä»¶åº”è¯¥å·²ç»ç¥å¥‡åœ°å‡ºç°(è‡ªå¸¦æœ‰)ï¼Œç”šè‡³ä¸éœ€è¦è¾“å…¥å®ƒä»¬</p><h3 id="Apache-ç¤ºä¾‹-ä¹Ÿå°±æ˜¯-Ansible-çš„â€œ-Hello-World-â€"><a href="#Apache-ç¤ºä¾‹-ä¹Ÿå°±æ˜¯-Ansible-çš„â€œ-Hello-World-â€" class="headerlink" title="Apache ç¤ºä¾‹(ä¹Ÿå°±æ˜¯ Ansible çš„â€œ Hello World! â€)"></a>Apache ç¤ºä¾‹(ä¹Ÿå°±æ˜¯ Ansible çš„â€œ Hello World! â€)</h3><p>æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹åº“å­˜æ–‡ä»¶(è®©æˆ‘ä»¬æŠŠå®ƒå‘½åä¸º<code>hosts</code>) :<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[web]</span></span><br><span class="line">host1</span><br></pre></td></tr></table></figure></p><p>æ‰€æœ‰çš„ä¸»æœºéƒ½æ˜¯åŸºäº debian çš„</p><p><strong>æ³¨æ„</strong>: è¯·è®°ä½æ‚¨å¯ä»¥(åœ¨æˆ‘ä»¬çš„ç»ƒä¹ ä¸­æˆ‘ä»¬è¿™æ ·åš)ä½¿ç”¨ <code>ansible_host</code> æ¥è®¾ç½®ä¸»æœºçš„çœŸå® IPã€‚ æ‚¨è¿˜å¯ä»¥æ›´æ”¹åº“å­˜å¹¶ä½¿ç”¨çœŸæ­£çš„ä¸»æœºåã€‚ åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸€ä¸ªéå…³é”®çš„æœºå™¨æµ‹è¯•ï¼ åœ¨çœŸæ­£çš„ä¸»æœºæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬è¿˜æœ‰<code>ansible_user=root</code> æ¥å¤„ç†æ½œåœ¨çš„ä¸åŒçš„ansible é»˜è®¤é…ç½®(ansible.cfgçš„é»˜è®¤ç”¨æˆ·ä¸ºroot,ä½†å¯èƒ½è¢«ä¿®æ”¹è¿‡)</p><p>è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªå°†åœ¨ <code>web</code> ç»„ä¸­çš„æœºå™¨ä¸Šå®‰è£… apache çš„å‰§æœ¬ã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- hosts: web</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Installs apache web server</span><br><span class="line">      apt:</span><br><span class="line">        pkg: apache2</span><br><span class="line">        state: present</span><br><span class="line">        update_cache: <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ <code>apt</code> æ¨¡å—æ­£ç¡®è¯´å‡ºæˆ‘ä»¬æƒ³è¦åšä»€ä¹ˆã€‚ è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ <a href="https://docs.ansible.com/ansible/latest/modules/apt_module.html" target="_blank" rel="noopener">apt</a> æ¨¡å—æ¥å®‰è£… debian è½¯ä»¶åŒ…ã€‚ æˆ‘ä»¬è¿˜è¦æ±‚æ­¤æ¨¡å—æ›´æ–°åŒ…ç¼“å­˜ã€‚</p><p>æˆ‘ä»¬è¿˜ä¸ºè¿™ä¸ªä»»åŠ¡æ·»åŠ äº†ä¸€ä¸ªåç§°ã€‚ è™½ç„¶è¿™æ˜¯ä¸å¿…è¦çš„ï¼Œä½†æ˜¯åœ¨å‰§æœ¬è¿è¡Œæ—¶å®ƒæä¾›äº†å¾ˆå¤šä¿¡æ¯ï¼Œæ‰€ä»¥å¼ºçƒˆæ¨èä½¿ç”¨ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼Œè¿™æ˜¯ç›¸å½“å®¹æ˜“çš„ï¼</p><p>æ‚¨ç°åœ¨å¯ä»¥è¿è¡Œ playbook (è®©æˆ‘ä»¬ç§°ä¹‹ä¸º <code>apache.yml</code>) :<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -i step<span class="number">-04</span>/hosts -l host1 step<span class="number">-04</span>/apache.yml</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œï¼Œ<code>step-04/hosts</code> æ˜¯åº“å­˜æ–‡ä»¶,<code>-l</code> å°†é™åˆ¶åªåœ¨ä¸»æœº <code>host1</code>ä¸Šè¿è¡Œï¼Œ<code>apache.yml</code> æ˜¯æˆ‘ä»¬çš„å‰§æœ¬ã€‚</p><p>å½“ä½ è¿è¡Œä¸Šé¢çš„å‘½ä»¤æ—¶ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°è¿™æ ·çš„ä¸œè¥¿:<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PLAY [web] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line"></span><br><span class="line">GATHERING FACTS <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Installs apache web server] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">PLAY RECAP <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">host1              : ok=2    changed=1    unreachable=0    failed=0</span><br></pre></td></tr></table></figure></p><p>è®©æˆ‘ä»¬åˆ†æä¸€æ¬¡ä¸€è¡Œçš„è¾“å‡º<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PLAY [web] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br></pre></td></tr></table></figure></p><p>å‘Šè¯‰æˆ‘ä»¬å®ƒæ­£åœ¨ä¸»æœº<code>web</code>ä¸Šè¿è¡Œã€‚ <code>playbook</code>æ˜¯ä¸€å¥—ä¸<code>hosts</code>æœ‰å…³çš„å¯æ¥å—çš„æŒ‡ä»¤ã€‚ å¦‚æœæˆ‘ä»¬æœ‰å¦ä¸€ä¸ª<code>- host: blah</code>: åœ¨æˆ‘ä»¬çš„å‰§æœ¬ä¸­ï¼Œå®ƒä¹Ÿä¼šè¿è¡Œ(ä½†æ˜¯åªä¼šåœ¨ç¬¬ä¸€ä¸ªå‰§æœ¬ç»“æŸä¹‹åï¼Œä¸€ä¸ªå‰§æœ¬æ–‡ä»¶å¯ä»¥æœ‰åŒ…å«å¤šä¸ªå‰§æœ¬)</p><p>è¿˜è®°å¾—æˆ‘ä»¬ä½¿ç”¨ <code>setup</code> æ¨¡å—çš„æ—¶å€™å—ï¼Ÿ æ¯æ¬¡è¿è¡Œä¹‹å‰ï¼Œansible éƒ½åœ¨æŒ‡å®šçš„ä¸»æœºä¸Šè¿è¡Œå®ƒï¼Œä»¥æ”¶é›†äº‹å®ã€‚ å¦‚æœå› ä¸ºä¸éœ€è¦ä¸»æœºæä¾›ä»»ä½•ä¿¡æ¯è€Œä¸éœ€è¦è¿™æ ·åšï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥æ·»åŠ  <code>gather_facts: no</code> è¯­æ®µåœ¨ä¸»æœºæ¡ç›®çš„ä¸‹é¢(ä¸ <code>tasks:</code>ç›¸åŒç¼©è¿›é•¿åº¦)ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæ˜¯çœŸæ­£çš„ä»»åŠ¡: æˆ‘ä»¬çš„(ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€çš„)ä»»åŠ¡æ­£åœ¨è¿è¡Œï¼Œå› ä¸ºå®ƒè¡¨ç¤º<code>changed</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“å®ƒæ”¹å˜äº† host1ä¸Šçš„æŸäº›å†…å®¹ã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PLAY RECAP *********************</span><br><span class="line">host1              : <span class="attribute">ok</span>=2    <span class="attribute">changed</span>=1    <span class="attribute">unreachable</span>=0    <span class="attribute">failed</span>=0</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œansible è¾“å‡ºå‘ç”Ÿäº†ä»€ä¹ˆ: ä¸¤ä¸ªä»»åŠ¡å·²ç»è¿è¡Œï¼Œå…¶ä¸­ä¸€ä¸ªåœ¨ä¸»æœºä¸Šæ”¹å˜äº†ä¸€äº›ä¸œè¥¿(æˆ‘ä»¬çš„ apache ä»»åŠ¡ï¼Œsetup æ¨¡å—æ²¡æœ‰æ”¹å˜ä»»ä½•ä¸œè¥¿)ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬å†è¿è¡Œä¸€æ¬¡ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ:<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook -i step-04/hosts -l host1 step-04/apache.yml</span><br><span class="line"></span><br><span class="line">PLAY [web] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line"></span><br><span class="line">GATHERING FACTS <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Installs apache web server] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">PLAY RECAP <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">host1              : ok=2    changed=0    unreachable=0    failed=0</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨â€˜ changedâ€™æ˜¯â€˜0â€™ã€‚ è¿™æ˜¯ç»å¯¹æ­£å¸¸çš„ï¼Œä¹Ÿæ˜¯ <code>ansible</code> çš„æ ¸å¿ƒç‰¹å¾ä¹‹ä¸€: åªæœ‰åœ¨æœ‰äº‹æƒ…å¯åšçš„æ—¶å€™ï¼Œå‰§æœ¬æ‰ä¼šé‡‡å–è¡ŒåŠ¨ã€‚è¿™å°±æ˜¯æ‰€è°“çš„å¹‚ç­‰æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°è¿è¡Œä½ çš„å‰§æœ¬ï¼Œä½ æœ€ç»ˆæ€»æ˜¯ä¼šå¤„äºç›¸åŒçš„çŠ¶æ€(å½“ç„¶ï¼Œé™¤éä½ ç”¨ shell æ¨¡å—åšäº†ä¸€äº›ç–¯ç‹‚çš„äº‹æƒ…ï¼Œä½†è¿™è¶…å‡ºäº† ansible çš„æ§åˆ¶èŒƒå›´)</p><h3 id="å®Œå–„å‰§æœ¬"><a href="#å®Œå–„å‰§æœ¬" class="headerlink" title="å®Œå–„å‰§æœ¬"></a>å®Œå–„å‰§æœ¬</h3><p>å½“ç„¶ï¼Œæˆ‘ä»¬çš„å‰§æœ¬å¯ä»¥å®‰è£… apache æœåŠ¡å™¨ï¼Œä½†å®ƒå¯ä»¥æ›´å®Œæ•´ä¸€ç‚¹ã€‚å®ƒå¯ä»¥æ·»åŠ ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œç¡®ä¿é‡æ–°å¯åŠ¨ apacheã€‚å®ƒç”šè‡³å¯ä»¥ä» git ä»“åº“éƒ¨ç½²æˆ‘ä»¬çš„ç½‘ç«™</p><h1 id="step-05-å®Œå–„-apache-è®¾ç½®"><a href="#step-05-å®Œå–„-apache-è®¾ç½®" class="headerlink" title="step-05 å®Œå–„ apache è®¾ç½®"></a>step-05 å®Œå–„ apache è®¾ç½®</h1><p>æˆ‘ä»¬å·²ç»å®‰è£…äº† apacheï¼Œç°åœ¨è®©æˆ‘ä»¬è®¾ç½®è™šæ‹Ÿä¸»æœºã€‚</p><h3 id="å®Œå–„å‰§æœ¬-1"><a href="#å®Œå–„å‰§æœ¬-1" class="headerlink" title="å®Œå–„å‰§æœ¬"></a>å®Œå–„å‰§æœ¬</h3><p>æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šåªéœ€è¦ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œä½†æˆ‘ä»¬å¸Œæœ›ç”¨æ›´å…·ä½“çš„ä¸œè¥¿æ›¿æ¢é»˜è®¤ä¸»æœºã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»ç§»é™¤å½“å‰(å¯èƒ½æ˜¯é»˜è®¤çš„)è™šæ‹Ÿä¸»æœºï¼Œå‘é€è‡³è™šæ‹Ÿæœºï¼Œæ¿€æ´»å®ƒå¹¶é‡æ–°å¯åŠ¨ apacheã€‚</p><p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º <code>files</code> çš„ç›®å½•ï¼Œå¹¶ä¸º host1æ·»åŠ è™šæ‹Ÿä¸»æœºé…ç½®ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <code>awesome-app</code>:<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">  DocumentRoot /<span class="keyword">var</span>/www/awesome-<span class="keyword">app</span></span><br><span class="line"></span><br><span class="line">  Options -Indexes</span><br><span class="line"></span><br><span class="line">  ErrorLog /<span class="keyword">var</span>/<span class="keyword">log</span>/apache2/<span class="keyword">error</span>.<span class="built_in">log</span></span><br><span class="line">  TransferLog /<span class="keyword">var</span>/<span class="keyword">log</span>/apache2/access.<span class="built_in">log</span></span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨ï¼Œå¿«é€Ÿæ›´æ–°ä¸€ä¸‹æˆ‘ä»¬çš„ apache å‰§æœ¬ï¼Œæˆ‘ä»¬å‡†å¤‡å¥½äº†:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">- hosts: web</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Installs apache web server</span><br><span class="line">      apt:</span><br><span class="line">        pkg: apache2</span><br><span class="line">        state: present</span><br><span class="line">        update_cache: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    - name: Push<span class="built_in"> default </span>virtual host configuration</span><br><span class="line">      copy:</span><br><span class="line">        src: files/awesome-app</span><br><span class="line">        dest: /etc/apache2/sites-available/awesome-app</span><br><span class="line">        mode: 0640</span><br><span class="line"></span><br><span class="line">    - name: <span class="builtin-name">Disable</span> the<span class="built_in"> default </span>virtualhost</span><br><span class="line">      file:</span><br><span class="line">        dest: /etc/apache2/sites-enabled/default</span><br><span class="line">        state: absent</span><br><span class="line">      notify:</span><br><span class="line">        - restart apache</span><br><span class="line"></span><br><span class="line">    - name: <span class="builtin-name">Disable</span> the<span class="built_in"> default </span>ssl virtualhost</span><br><span class="line">      file:</span><br><span class="line">        dest: /etc/apache2/sites-enabled/default-ssl</span><br><span class="line">        state: absent</span><br><span class="line">      notify:</span><br><span class="line">        - restart apache</span><br><span class="line"></span><br><span class="line">    - name: Activates our virtualhost</span><br><span class="line">      file:</span><br><span class="line">        src: /etc/apache2/sites-available/awesome-app</span><br><span class="line">        dest: /etc/apache2/sites-enabled/awesome-app</span><br><span class="line">        state: link</span><br><span class="line">      notify:</span><br><span class="line">        - restart apache</span><br><span class="line"></span><br><span class="line">  handlers:</span><br><span class="line">    - name: restart apache</span><br><span class="line">      service:</span><br><span class="line">        name: apache2</span><br><span class="line">        state: restarted</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¼€å§‹å§:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook -i step-05/hosts -l host1 step-05/apache.yml</span><br><span class="line"></span><br><span class="line">PLAY [web] *********************</span><br><span class="line"></span><br><span class="line">GATHERING FACTS *********************</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Installs apache web server] *********************</span><br><span class="line">ok: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Push<span class="built_in"> default </span>virtual host configuration] *********************</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [<span class="builtin-name">Disable</span> the<span class="built_in"> default </span>virtualhost] *********************</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [<span class="builtin-name">Disable</span> the<span class="built_in"> default </span>ssl virtualhost] *********************</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">TASK: [Activates our virtualhost] *********************</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">NOTIFIED: [restart apache] *********************</span><br><span class="line">changed: [host1]</span><br><span class="line"></span><br><span class="line">PLAY RECAP *********************</span><br><span class="line">host1              : <span class="attribute">ok</span>=7    <span class="attribute">changed</span>=5    <span class="attribute">unreachable</span>=0    <span class="attribute">failed</span>=0</span><br></pre></td></tr></table></figure><p>å¤ªé…·äº†ï¼å¥½å§ï¼Œæƒ³æƒ³çœ‹ï¼Œæˆ‘ä»¬æœ‰ç‚¹æ“ä¹‹è¿‡æ€¥äº†ã€‚åœ¨é‡æ–°å¯åŠ¨ apache ä¹‹å‰ï¼Œæˆ‘ä»¬æ˜¯å¦åº”è¯¥æ£€æŸ¥ä¸€ä¸‹é…ç½®æ˜¯å¦æ­£å¸¸ï¼Ÿè¿™æ ·ï¼Œå¦‚æœé…ç½®æ–‡ä»¶ä¸æ­£ç¡®ï¼Œæˆ‘ä»¬å°±ä¸ä¼šä¸­æ–­æœåŠ¡ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="ansible" scheme="http://yoursite.com/tags/ansible/"/>
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘: ansible-tutoï¼ˆ02-03ï¼‰</title>
    <link href="http://yoursite.com/2020/05/10/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8802-03%EF%BC%89/"/>
    <id>http://yoursite.com/2020/05/10/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8802-03%EF%BC%89/</id>
    <published>2020-05-10T12:32:28.000Z</published>
    <updated>2020-05-11T02:43:05.923Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="step-02-talking-to-nodes"><a href="#step-02-talking-to-nodes" class="headerlink" title="step-02 talking to nodes"></a>step-02 talking to nodes</h1><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹äº†ã€‚ è®©æˆ‘ä»¬ç”¨ä¸Šä¸€ç« ä¸­çœ‹åˆ°çš„å‘½ä»¤: <code>anable</code> è¿™ä¸ªå‘½ä»¤æ˜¯ansibleæä¾›çš„ä¸èŠ‚ç‚¹äº¤äº’çš„ä¸‰ä¸ªå‘½ä»¤ä¸­çš„ä¸€ä¸ª</p><h3 id="åšäº›æœ‰ç”¨çš„äº‹æƒ…"><a href="#åšäº›æœ‰ç”¨çš„äº‹æƒ…" class="headerlink" title="åšäº›æœ‰ç”¨çš„äº‹æƒ…"></a>åšäº›æœ‰ç”¨çš„äº‹æƒ…</h3><p>åœ¨å‰é¢çš„å‘½ä»¤ä¸­,<code>-m ping</code> çš„æ„æ€æ˜¯â€œä½¿ç”¨ pingæ¨¡å—â€ï¼Œè¿™ä¸ªæ¨¡å—æ˜¯å¯ç”¨çš„è®¸å¤šæ¨¡å—ä¹‹ä¸€ã€‚ <code>Ping</code> æ¨¡å—éå¸¸ç®€å•ï¼Œä¸éœ€è¦ä»»ä½•å‚æ•°ã€‚ æ¥å—å‚æ•°çš„æ¨¡å—é€šè¿‡ <code>-a</code> æ¥ä¼ é€’å‚æ•°ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å…¶ä»–ä¸€äº›æ¨¡å—</p><h3 id="shellæ¨¡å—"><a href="#shellæ¨¡å—" class="headerlink" title="shellæ¨¡å—"></a>shellæ¨¡å—</h3><p>è¿™ä¸ªæ¨¡å—å…è®¸ä½ åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œä¸€ä¸ª shell å‘½ä»¤:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible -<span class="selector-tag">i</span> step-<span class="number">02</span>/hosts -m shell -<span class="selector-tag">a</span> <span class="string">'uname -a'</span> host0</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºåº”è¯¥æ˜¯è¿™æ ·çš„:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>cool!</p><h3 id="copyæ¨¡å—"><a href="#copyæ¨¡å—" class="headerlink" title="copyæ¨¡å—"></a>copyæ¨¡å—</h3><p>æ¯«æ— ç–‘é—®ï¼Œä½¿ç”¨è¿™ä¸ªæ¨¡å—ï¼Œæ‚¨å¯ä»¥å°†æ–‡ä»¶ä»æ§åˆ¶æœºå¤åˆ¶åˆ°èŠ‚ç‚¹ï¼Œå‡è®¾æˆ‘ä»¬è¦å°† <code>/etc/hosts</code> å¤åˆ¶åˆ°ç›®æ ‡èŠ‚ç‚¹çš„ <code>/tmp</code>:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible -<span class="selector-tag">i</span> step-<span class="number">02</span>/hosts -m copy -<span class="selector-tag">a</span> <span class="string">'src=/etc/hosts dest=/tmp/'</span> host0</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºåº”è¯¥ç±»ä¼¼äº:<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">host0 <span class="string">| success &gt;&gt; &#123;</span></span><br><span class="line">    <span class="string">"changed"</span>: true,</span><br><span class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/hosts"</span>,</span><br><span class="line">    <span class="string">"group"</span>: <span class="string">"root"</span>,</span><br><span class="line">    <span class="string">"md5sum"</span>: <span class="string">"d41d8cd98f00b204e9800998ecf8427e"</span>,</span><br><span class="line">    <span class="string">"mode"</span>: <span class="string">"0644"</span>,</span><br><span class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>,</span><br><span class="line">    <span class="string">"size"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"src"</span>: <span class="string">"/root/.ansible/tmp/ansible-1362910475.9-246937081757218/source"</span>,</span><br><span class="line">    <span class="string">"state"</span>: <span class="string">"file"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Ansible (æ›´å‡†ç¡®åœ°è¯´æ˜¯åœ¨èŠ‚ç‚¹ä¸Šæ‰§è¡Œçš„å¤åˆ¶æ¨¡å—)ä»¥ JSON æ ¼å¼å›å¤äº†å¤§é‡æœ‰ç”¨çš„ä¿¡æ¯,æˆ‘ä»¬ç¨åå°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨å®ƒã€‚</p><p>æˆ‘ä»¬å°†åœ¨ä¸‹é¢çœ‹åˆ°å…¶ä»–æœ‰ç”¨çš„æ¨¡å—,æœ‰ä¸€ä¸ªå·¨å¤§çš„<a href="https://docs.ansible.com/ansible/latest/modules/list_of_all_modules.htmlï¼‰ï¼Œå‡ ä¹æ¶µç›–äº†ä½ å¯ä»¥åœ¨ç³»ç»Ÿä¸Šåšçš„ä»»ä½•äº‹æƒ…ã€‚ å¦‚æœæ‚¨æ‰¾ä¸åˆ°åˆé€‚çš„æ¨¡å—ï¼Œé‚£ä¹ˆç¼–å†™ä¸€ä¸ªæ¨¡å—éå¸¸ç®€å•(ç”šè‡³ä¸å¿…æ˜¯ Pythonï¼Œåªéœ€è¦ä½¿ç”¨ JSON" target="_blank" rel="noopener">æ¨¡å—ä»“åº“</a></p><h3 id="å¯¹ä¸åŒçš„ä¸»æœºä½¿ç”¨ç›¸åŒçš„å‘½ä»¤"><a href="#å¯¹ä¸åŒçš„ä¸»æœºä½¿ç”¨ç›¸åŒçš„å‘½ä»¤" class="headerlink" title="å¯¹ä¸åŒçš„ä¸»æœºä½¿ç”¨ç›¸åŒçš„å‘½ä»¤"></a>å¯¹ä¸åŒçš„ä¸»æœºä½¿ç”¨ç›¸åŒçš„å‘½ä»¤</h3><p>å¥½çš„ï¼Œä¸Šé¢çš„å†…å®¹å¾ˆæœ‰è¶£ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰å¾ˆå¤šèŠ‚ç‚¹éœ€è¦ç®¡ç†ã€‚è®©æˆ‘ä»¬åœ¨å…¶ä»–ä¸»æœºä¸Šä¹Ÿå°è¯•ä¸€ä¸‹</p><p>è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æƒ³è¦å¾—åˆ°ä¸€äº›å…³äºèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œæƒ³çŸ¥é“æˆ‘ä»¬åœ¨èŠ‚ç‚¹ä¸Šéƒ¨ç½²äº†å“ªä¸ª Ubuntu ç‰ˆæœ¬ï¼Œè¿™å¾ˆç®€å•:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible -<span class="selector-tag">i</span> step-<span class="number">02</span>/hosts -m shell -<span class="selector-tag">a</span> <span class="string">'grep DISTRIB_RELEASE /etc/lsb-release'</span> all</span><br></pre></td></tr></table></figure></p><p>All æ˜¯ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œæ„æ€æ˜¯â€œåœ¨ç›®å½•æ–‡ä»¶ä¸­æ‰¾åˆ°çš„æ‰€æœ‰ä¸»æœºâ€ã€‚å®ƒä¼šè¿”å›:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">host1 | success | <span class="attribute">rc</span>=0 &gt;&gt;</span><br><span class="line"><span class="attribute">DISTRIB_RELEASE</span>=14.04</span><br><span class="line"></span><br><span class="line">host2 | success | <span class="attribute">rc</span>=0 &gt;&gt;</span><br><span class="line"><span class="attribute">DISTRIB_RELEASE</span>=14.04</span><br><span class="line"></span><br><span class="line">host0 | success | <span class="attribute">rc</span>=0 &gt;&gt;</span><br><span class="line"><span class="attribute">DISTRIB_RELEASE</span>=14.04</span><br></pre></td></tr></table></figure><h3 id="æ›´å¤šçš„factsï¼ˆä¿¡æ¯ï¼‰"><a href="#æ›´å¤šçš„factsï¼ˆä¿¡æ¯ï¼‰" class="headerlink" title="æ›´å¤šçš„factsï¼ˆä¿¡æ¯ï¼‰"></a>æ›´å¤šçš„factsï¼ˆä¿¡æ¯ï¼‰</h3><p>è¿™å¾ˆç®€å•ï¼Œç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ›´å¤šçš„ä¿¡æ¯(ip åœ°å€ï¼ŒRAM å¤§å°ç­‰ç­‰)ï¼Œå®ƒä¼šå¾ˆå¿«å˜å¾—å¾ˆéº»çƒ¦. è¿™ä¸ªè§£å†³æ–¹æ¡ˆæ¥è‡ªå¦ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„æ¨¡å—ï¼Œå«åš<code>setup</code>: å®ƒä¸“é—¨æ”¶é›†èŠ‚ç‚¹çš„factsï¼ˆä¿¡æ¯ï¼‰</p><p>å°è¯•ä¸€ä¸‹:<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible -i <span class="built_in">step</span><span class="number">-02</span>/hosts -m <span class="built_in">setup</span> host0</span><br></pre></td></tr></table></figure></p><p>æä¾›å¤§é‡ä¿¡æ¯:<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"ansible_facts"</span>: &#123;</span><br><span class="line">    <span class="string">"ansible_all_ipv4_addresses"</span>: [</span><br><span class="line">        <span class="string">"192.168.0.60"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"ansible_all_ipv6_addresses"</span>: [],</span><br><span class="line">    <span class="string">"ansible_architecture"</span>: <span class="string">"x86_64"</span>,</span><br><span class="line">    <span class="string">"ansible_bios_date"</span>: <span class="string">"01/01/2007"</span>,</span><br><span class="line">    <span class="string">"ansible_bios_version"</span>: <span class="string">"Bochs"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">---snip---</span></span><br><span class="line">    <span class="string">"ansible_virtualization_role"</span>: <span class="string">"guest"</span>,</span><br><span class="line">    <span class="string">"ansible_virtualization_type"</span>: <span class="string">"kvm"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"changed"</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">"verbose_override"</span>: <span class="literal">true</span></span><br></pre></td></tr></table></figure></p><p>ä¸ºäº†ç®€çŸ­èµ·è§ï¼Œå¯¹å®ƒè¿›è¡Œäº†æˆªæ–­ï¼Œä½†æ˜¯æ‚¨å¯ä»¥åœ¨è¿”å›çš„æ•°æ®ä¸­æ‰¾åˆ°è®¸å¤šæœ‰è¶£çš„,æ‚¨è¿˜å¯ä»¥è¿‡æ»¤è¿”å›çš„é”®ï¼Œä»¥é˜²æ‚¨æ­£åœ¨å¯»æ‰¾æŸäº›ç‰¹å®šçš„ä¸œè¥¿ã€‚</p><p>ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬å‡è®¾ä½ æƒ³çŸ¥é“ä½ åœ¨æ‰€æœ‰ä¸»æœºä¸Šæœ‰å¤šå°‘å†…å­˜ï¼Œç®€å•åœ°ä½¿ç”¨ <code>ansible -i step-02/hosts -m setup -a &quot;filter= ansible_memtotal_mb&quot; all:</code></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">host2 <span class="string">| success &gt;&gt; &#123;</span></span><br><span class="line">    <span class="string">"ansible_facts"</span>: &#123;</span><br><span class="line">        <span class="string">"ansible_memtotal_mb"</span>: <span class="number">187</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"changed"</span>: false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">host1 <span class="string">| success &gt;&gt; &#123;</span></span><br><span class="line">    <span class="string">"ansible_facts"</span>: &#123;</span><br><span class="line">        <span class="string">"ansible_memtotal_mb"</span>: <span class="number">187</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"changed"</span>: false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">host0 <span class="string">| success &gt;&gt; &#123;</span></span><br><span class="line">    <span class="string">"ansible_facts"</span>: &#123;</span><br><span class="line">        <span class="string">"ansible_memtotal_mb"</span>: <span class="number">187</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"changed"</span>: false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œä¸å‰é¢çš„è¾“å‡ºç›¸æ¯”ï¼Œä¸»æœºçš„å›å¤é¡ºåºä¸åŒï¼Œè¿™æ˜¯å› ä¸º ansible ä¸ä¸»æœºçš„é€šä¿¡æ˜¯å¹¶è¡ŒåŒ–çš„ï¼</p><p>é¡ºä¾¿è¯´ä¸€å¥ï¼Œåœ¨ä½¿ç”¨ <code>setup</code> æ¨¡å—æ—¶ï¼Œå¯ä»¥åœ¨ <code>filter=</code> è¡¨è¾¾å¼ä¸­ä½¿ç”¨ <code>*</code>ï¼Œå®ƒä¸<code>shell</code>ç›¸ä¼¼</p><h3 id="é€‰æ‹©ä¸»æœº"><a href="#é€‰æ‹©ä¸»æœº" class="headerlink" title="é€‰æ‹©ä¸»æœº"></a>é€‰æ‹©ä¸»æœº</h3><p>æˆ‘ä»¬çœ‹åˆ° <code>all</code> æ„å‘³ç€æ‰€æœ‰çš„ä¸»æœºï¼Œä½† ansible æä¾›äº†è®¸å¤šå…¶ä»–çš„æ–¹æ³•æ¥<a href="https://docs.ansible.com/ansible/latest/user_guide/intro_patterns.html" target="_blank" rel="noopener">é€‰æ‹©ä¸»æœº</a>:</p><ul><li><code>host0:host1</code>  å°†åœ¨ host0å’Œ host1ä¸Šè¿è¡Œ</li><li><code>host*</code> hostå¼€å¤´çš„ä¸»æœºéƒ½ä¼šè¿è¡Œ (å°±åƒ shellè¯­æ³•ä¸€æ ·)</li></ul><p>è¿˜æœ‰å…¶ä»–æ¶‰åŠä¸»æœºç»„çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°†åœ¨step-03ä¸­çœ‹åˆ°ã€‚</p><h1 id="step-03-ä¸»æœºç»„"><a href="#step-03-ä¸»æœºç»„" class="headerlink" title="step-03 ä¸»æœºç»„"></a>step-03 ä¸»æœºç»„</h1><p>åº“å­˜ä¸­çš„ä¸»æœºå¯ä»¥ä»»æ„åˆ†ç»„ï¼Œä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æœ‰ä¸€ä¸ª <code>debian</code> ç»„ã€ä¸€ä¸ª <code>web-server</code> ç»„ã€ä¸€ä¸ª <code>production</code> ç»„ç­‰ç­‰</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[debian]</span></span><br><span class="line">host0</span><br><span class="line">host1</span><br><span class="line">host2</span><br></pre></td></tr></table></figure><p>è¿™ç”šè‡³å¯ä»¥ç”¨æ›´ç®€çŸ­çš„æ–¹å¼æ¥è¡¨è¾¾:<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[debian]</span></span><br><span class="line">host<span class="string">[0:2]</span></span><br></pre></td></tr></table></figure></p><p>å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨å­ç»„ï¼Œåªéœ€å®šä¹‰ä¸€ä¸ª <code>[ groupname: children ]</code> å¹¶åœ¨å…¶ä¸­æ·»åŠ å­ç»„ï¼Œä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸åŒå‘è¡Œç‰ˆçš„ linux è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç»„ç»‡æˆ‘ä»¬çš„åº“å­˜:<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[ubuntu]</span></span><br><span class="line">host0</span><br><span class="line"></span><br><span class="line"><span class="string">[debian]</span></span><br><span class="line">host<span class="string">[1:2]</span></span><br><span class="line"></span><br><span class="line"><span class="string">[linux:children]</span></span><br><span class="line">ubuntu</span><br><span class="line">debian</span><br></pre></td></tr></table></figure></p><h3 id="è®¾ç½®å˜é‡"><a href="#è®¾ç½®å˜é‡" class="headerlink" title="è®¾ç½®å˜é‡"></a>è®¾ç½®å˜é‡</h3><p>æ‚¨å¯ä»¥åœ¨å‡ ä¸ªåœ°æ–¹ä¸ºä¸»æœºåˆ†é…å˜é‡: åº“å­˜æ–‡ä»¶ã€ä¸»æœºå˜é‡æ–‡ä»¶ã€ç»„ vå˜é‡æ–‡ä»¶ç­‰ç­‰</p><p>æˆ‘é€šå¸¸å°†å¤§éƒ¨åˆ†å˜é‡è®¾ç½®åœ¨ç»„å˜é‡æˆ–ä¸»æœºå˜é‡æ–‡ä»¶ä¸­(ç¨åå°†è¯¦ç»†ä»‹ç»)ã€‚ä½†æ˜¯ï¼Œæˆ‘ç»å¸¸ç›´æ¥åœ¨ç›®å½•æ–‡ä»¶ä¸­ä½¿ç”¨ä¸€äº›å˜é‡ï¼Œæ¯”å¦‚<code>ansible_host</code> å¯ä»¥ä¸ºä¸»æœºè®¾ç½® IP åœ°å€ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒAnsible ä¼šåœ¨é€šè¿‡ SSH è¿æ¥æ—¶å°è¯•è§£æä¸»æœºçš„åç§°ã€‚ å½“åœ¨ä½ å¯åŠ¨ä¸€ä¸ªä¸»æœºæ—¶ï¼Œå®ƒå¯èƒ½è¿˜æ²¡æœ‰ä¸€ä¸ªç¡®å®šçš„ IP åœ°å€ï¼Œ<code>ansible_host</code> ç”¨åœ¨è¿™é‡Œå¾ˆæ–¹ä¾¿</p><p>å½“ä½¿ç”¨ <code>ansible</code> æˆ– <code>ansible-playbook</code> å‘½ä»¤æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‚æ•° <code>--extra-vars</code> (æˆ–<code>-e</code>)æ¥è®¾ç½®å˜é‡ï¼Œä½œä¸ºç©ºæ ¼åˆ†éš”çš„<code>key=val</code> åˆ—è¡¨(å¯¹äºæ¯ä¸ªå˜é‡çš„åˆå§‹åŒ–ï¼Œå¯ä»¥å¤šæ¬¡ä½¿ç”¨è¯¥æ–¹æ³•)ã€‚ æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€æ­¥è®¨è®º<code>ansible-playbook</code></p><p>æ‚¨å¯ä»¥çŒœåˆ°ï¼Œ<code>ansible_port</code>æŒ‡å®šä¸€ä¸ª SSH ç«¯å£å°è¯•è¿æ¥<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ubuntu]</span><br><span class="line">host0 ansible_host=<span class="number">192.168</span><span class="number">.0</span><span class="number">.12</span> ansible_port=<span class="number">2222</span></span><br></pre></td></tr></table></figure></p><p>Ansible å°†åœ¨ç»„å’Œä¸»æœºå˜é‡æ–‡ä»¶ä¸­æŸ¥æ‰¾å…¶ä»–å˜é‡å®šä¹‰,è¿™äº›æ–‡ä»¶åœ¨ä¸»ç›®å½•æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä¸‹çš„ <code>group_vars</code> å’Œ <code>host_vars</code> çš„ç›®å½•ä¸­æœç´¢</p><p>æ–‡ä»¶å°†æŒ‰åç§°æœç´¢ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨å‰é¢æåˆ°çš„åº“å­˜æ–‡ä»¶ï¼Œ<code>host0</code>å˜é‡å°†åœ¨è¿™äº›æ–‡ä»¶ä¸­æœç´¢</p><ul><li><code>group_vars/linux</code></li><li><code>group_vars/ubuntu</code></li><li><code>host_vars/host0</code><br>~~~<br>è¿™äº›æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶ä¸é‡è¦ï¼Œä½†æ˜¯å¦‚æœå®ƒä»¬å­˜åœ¨ï¼Œansible å°†ä½¿ç”¨å®ƒä»¬</li></ul><p>ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†æ¨¡å—ã€åº“å­˜å’Œå˜é‡çš„åŸºæœ¬çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬é€šè¿‡å‰§æœ¬æ¥æ¢ç´¢ Ansible çš„çœŸæ­£åŠ›é‡</p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="ansible" scheme="http://yoursite.com/tags/ansible/"/>
    
  </entry>
  
  <entry>
    <title>LVSå­¦ä¹ </title>
    <link href="http://yoursite.com/2020/05/10/LVS%E5%AD%A6%E4%B9%A0/"/>
    <id>http://yoursite.com/2020/05/10/LVS%E5%AD%A6%E4%B9%A0/</id>
    <published>2020-05-10T03:52:49.000Z</published>
    <updated>2020-05-11T03:58:21.348Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><p>è®°å½•çš„éå¸¸è¯¦ç»†,å€¼å¾—å­¦ä¹ â€“&gt; <a href="http://superproxy.github.io/docs/lvs/index.html" target="_blank" rel="noopener">LVSä»‹ç»</a></p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="LVS" scheme="http://yoursite.com/tags/LVS/"/>
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>ç¿»è¯‘: ansible-tutoï¼ˆ00-01ï¼‰</title>
    <link href="http://yoursite.com/2020/05/08/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8800-01%EF%BC%89/"/>
    <id>http://yoursite.com/2020/05/08/%E7%BF%BB%E8%AF%91-ansible-tuto%EF%BC%8800-01%EF%BC%89/</id>
    <published>2020-05-08T13:29:00.000Z</published>
    <updated>2020-05-09T14:34:19.551Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å®˜æ–¹æ–‡æ¡£è™½å¥½ï¼Œæ ·æ ·ä¿±å…¨ï¼Œå¯å°±æ˜¯å¤ªç¢å¤ªç»†ï¼Œéš¾ä»¥æ‹¼æ¥æ¶ˆåŒ–ï¼Œé‚£ä¹ˆå°±å…ˆä»è·Ÿç€ä¸€ä»½å¥½çš„æ•™ç¨‹å…ˆæ…¢æ…¢å­¦èµ·å§</p><p>æºåœ°å€ï¼ˆåŒ…å«æ‰€æœ‰æ‰€éœ€æ–‡ä»¶ï¼‰â€“&gt;<a href="https://github.com/leucos/ansible-tuto" target="_blank" rel="noopener">ansible-tuto</a></p><h1 id="step-00-å®‰è£…"><a href="#step-00-å®‰è£…" class="headerlink" title="step-00 å®‰è£…"></a>step-00 å®‰è£…</h1><p>Vagrantçš„å‡ºç°è®©VirtualBoxéƒ¨ç½²è™šæ‹Ÿæœºå˜å¾—éå¸¸ç®€å•å®¹æ˜“ï¼Œä¸ºäº†è®©æœ¬æ•™ç¨‹æ›´åŠ <code>self-contained</code>ï¼Œå·²ç»æä¾›äº†æ‰€éœ€çš„Vagrantfile</p><h3 id="å®‰è£…vagrant"><a href="#å®‰è£…vagrant" class="headerlink" title="å®‰è£…vagrant"></a>å®‰è£…vagrant</h3><p>ä¸ºäº†è¿è¡ŒVagrantï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>å®‰è£…VirtualBox</li><li>å®‰è£…Ruby</li><li>å®‰è£…Vagrantï¼ˆ1.1ç‰ˆæœ¬ä»¥ä¸Šï¼‰<br>ä»¥ä¸Šå°±æ˜¯å®‰è£…Vagrantæ‰€éœ€çš„</li></ul><p>ç°åœ¨å°±å¯ä»¥æ ¹æ®ä»¥ä¸‹å‘½ä»¤å»å¯åŠ¨ä½ çš„è™šæ‹Ÿæœºäº†ã€‚è¯·æ³¨æ„ï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨ä¸‹è½½ä»»ä½•<code>box</code>ï¼Œæœ¬æ•™ç¨‹å·²ç»æä¾›äº†ä¸€ä¸ªæ‰€éœ€çš„Vagrantfileï¼Œå¦‚æœè¿˜éœ€è¦å…¶ä»–çš„ï¼Œé‚£ä¹ˆè¿˜ä¼šæä¾›å¦å¤–ä¸€ä¸ªçš„<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vagrant up</span></span><br></pre></td></tr></table></figure></p><p>ç„¶åå¯ä»¥æ”¾æ¾ä¸‹å»å–æ¯å’–å•¡(æ³¨æ„ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ vagrant-hostmasterï¼Œæ‚¨éœ€è¦è¾“å…¥å¯†ç ï¼Œå› ä¸ºsudo ææƒéœ€è¦å¯†ç )</p><p>å¦‚æœæœ‰ä»€ä¹ˆåœ°æ–¹å‡ºäº†é—®é¢˜ï¼Œè¯·å‚è€ƒ <a href="https://www.vagrantup.com/intro/getting-started/index.html" target="_blank" rel="noopener">Getting Started Guide</a></p><h3 id="å…³äºNetworkManagerçš„è­¦ç¤º"><a href="#å…³äºNetworkManagerçš„è­¦ç¤º" class="headerlink" title="å…³äºNetworkManagerçš„è­¦ç¤º"></a>å…³äºNetworkManagerçš„è­¦ç¤º</h3><p>åœ¨æŸäº›ç³»ç»Ÿä¸Šï¼Œ<code>NetworkManager</code> å°†æ¥ç®¡ <code>vboxnet</code> æ¥å£ï¼Œå¹¶æŠŠä¸€åˆ‡éƒ½æç ¸ã€‚ å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œåº”è¯¥é˜²æ­¢ <code>NetworkManager</code> å°è¯•è‡ªåŠ¨é…ç½®<code>vboxnet</code>æ¥å£ã€‚ åªéœ€ç¼–è¾‘ <code>/etc/networkmanager/networkmanager.conf</code> (æˆ–è€…ä½ ç³»ç»Ÿä¸­çš„ NetworkManager é…ç½®æ–‡ä»¶)å¹¶æ·»åŠ ä¸€èŠ‚[keyfile] :<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unmanaged-devices=<span class="string">mac:</span>MAC_OF_VBOXNET0_IF;<span class="string">mac:</span>MAC_OF_VBOXNET1_IF;...</span><br></pre></td></tr></table></figure></p><p>ç„¶åé”€æ¯ Vagrant è®¡ç®—æœºï¼Œé‡æ–°å¯åŠ¨ NetworkManagerï¼Œç„¶åå†è¯•ä¸€æ¬¡ã€‚</p><h3 id="ä¸ºè™šæ‹Ÿæœºæ·»åŠ SSHå¯†é’¥"><a href="#ä¸ºè™šæ‹Ÿæœºæ·»åŠ SSHå¯†é’¥" class="headerlink" title="ä¸ºè™šæ‹Ÿæœºæ·»åŠ SSHå¯†é’¥"></a>ä¸ºè™šæ‹Ÿæœºæ·»åŠ SSHå¯†é’¥</h3><p>æŒ‰ç…§è¯¥æ•™ç¨‹ï¼Œæ‚¨éœ€è¦å°†æ‚¨çš„å¯†é’¥æ”¾åœ¨è™šæ‹Ÿæœºä¸­<code>root</code>ç”¨æˆ·æ–‡ä»¶å¤¹ä¸­<code>authorized_keys</code>ä¸­ï¼Œè™½ç„¶è¿™æ˜¯ä¸æ˜¯ç»å¯¹å¿…è¦çš„(ansibleå¯ä»¥ä½¿ç”¨ sudoï¼Œå¯†ç èº«ä»½éªŒè¯ç­‰) ä½†è¿™æ ·äº‹æƒ…å°±ç®€å•å¤šäº†</p><p>ansibleéå¸¸æ“…é•¿è¿™ä¸ªï¼Œç„¶è€Œï¼Œæˆ‘ç°åœ¨ä¸ä¼šè§£é‡Šå‘ç”Ÿäº†ä»€ä¹ˆï¼Œç›¸ä¿¡æˆ‘<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -i <span class="built_in">step</span><span class="number">-00</span>/hosts <span class="built_in">step</span><span class="number">-00</span>/<span class="built_in">setup</span>.yml</span><br></pre></td></tr></table></figure></p><p>å¦‚æœå‡ºç°â€œè¶…æ—¶è¿æ¥â€é”™è¯¯ï¼Œè¯·æ£€æŸ¥æœºå™¨çš„é˜²ç«å¢™è®¾ç½®ã€‚</p><p>å¦‚æœå‡ºç°ä»¥ä¸‹é”™è¯¯:<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fatal: [<span class="number">192.168</span><span class="number">.33</span><span class="number">.10</span>]: UNREACHABLE! =&gt; &#123;<span class="string">"changed"</span>: <span class="keyword">false</span>, </span><br><span class="line"><span class="string">"msg"</span>: <span class="string">"host key mismatch for 192.168.33.10"</span>, <span class="string">"unreachable"</span>: <span class="keyword">true</span>&#125;</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆä½ å¯èƒ½å·²ç»åœ¨ä½ çš„ <code>~/.ssh/known_hosts</code> ä¸­æœ‰äº†é‚£äº› IP çš„SSHä¸»æœºå¯†é’¥, æ‚¨å¯ä»¥ä½¿ç”¨<code>ssh-keygen-r ip</code>åˆ é™¤å®ƒä»¬</p><p>ç„¶åï¼Œåªè¦åœ¨æç¤ºè®¿é—® ssh ä¸»æœºå¯†é’¥(å¦‚æœè¯·æ±‚)æ—¶è¾“å…¥ <code>yes</code> å³å¯ã€‚</p><p><strong>æ³¨æ„</strong>: æˆ‘ä»¬å‡è®¾æ‚¨æ­£åœ¨æœ¬åœ°æœºå™¨ä¸Šä½¿ç”¨ Ansible v2.5 + ç‰ˆæœ¬ã€‚ å¦‚æœæ²¡æœ‰ï¼Œæ‚¨åº”è¯¥åœ¨ä½¿ç”¨è¯¥å­˜å‚¨åº“ä¹‹å‰å°†å…¶å‡çº§åˆ° v2.5 + (æˆ–åœ¨ virtualenv ä¸‹è¿è¡Œ)ã€‚</p><h1 id="step-01-Inventory"><a href="#step-01-Inventory" class="headerlink" title="step-01 Inventory"></a>step-01 Inventory</h1><p>åœ¨ç»§ç»­ä¹‹å‰ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªåº“å­˜ï¼ˆinvertory)æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ–‡ä»¶çš„é»˜è®¤ä½ç½®æ˜¯ <code>/etc /anable/hosts</code>  ç„¶è€Œï¼Œä½ å¯ä»¥é€šè¿‡é…ç½® anable å»å°†å…¶å­˜å‚¨åœ¨å…¶ä»–åœ°æ–¹ï¼Œæˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆANSIBLE_INVENTORYï¼‰æŒ‡æ˜åº“å­˜è·¯å¾„ï¼Œæˆ–è€…ä½¿ç”¨ <code>ansible</code> å‘½ä»¤ä¸­çš„  <code>-i</code>æ ‡å¿—æŒ‡æ˜åº“å­˜è·¯å¾„ã€‚</p><p>æˆ‘ä»¬åœ¨ç›®å½•ä¸­ä¸ºæ‚¨åˆ›å»ºäº†ä¸€ä¸ªåº“å­˜æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">host0 <span class="attribute">ansible_host</span>=192.168.33.10 <span class="attribute">ansible_user</span>=root</span><br><span class="line">host1 <span class="attribute">ansible_host</span>=192.168.33.11 <span class="attribute">ansible_user</span>=root</span><br><span class="line">host2 <span class="attribute">ansible_host</span>=192.168.33.12 <span class="attribute">ansible_user</span>=root</span><br></pre></td></tr></table></figure></p><p><code>ansible_host</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å˜é‡ï¼Œå®ƒä»£è¡¨ç€ä¸»æœºè¿æ¥æ—¶ä½¿ç”¨çš„ IP åœ°å€ã€‚ å¦‚æœæ‚¨ä½¿ç”¨ <code>vagrant-hostmaster gem</code> ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œå°±æ²¡æœ‰å¿…è¦äº†ã€‚ æ­¤å¤–ï¼Œå¦‚æœæ‚¨å·²ç»ä½¿ç”¨ä¸åŒçš„ipåœ°å€è®¾ç½®äº†è‡ªå·±çš„è™šæ‹Ÿæœºï¼Œåˆ™å¿…é¡»æ›´æ”¹ ip</p><p><code>Ansible_user</code> æ˜¯å¦ä¸€ä¸ªç‰¹æ®Šçš„å˜é‡ï¼Œå®ƒå‘Šè¯‰ ansible åœ¨ä½¿ç”¨ ssh æ—¶ä»¥è¿™ä¸ªç”¨æˆ·çš„èº«ä»½è¿æ¥ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œansible å°†ä½¿ç”¨æ‚¨å½“å‰çš„ç”¨æˆ·åï¼Œæˆ–è€…ä½¿ç”¨ <code>~/.ansible.cfg</code> ä¸­æä¾›çš„å¦ä¸€ä¸ªé»˜è®¤ç”¨æˆ·å</p><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>ansible å®‰è£…å¥½äº†ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦ä¸€åˆ‡æ­£å¸¸<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible -m<span class="built_in"> ping </span>all -i step-01/hosts</span><br></pre></td></tr></table></figure></p><p>Ansible åœ¨è¿™é‡Œå°è¯•åšçš„åªæ˜¯åœ¨æ¯ä¸ªä¸»æœºä¸Šæ‰§è¡Œ <code>ping</code> æ¨¡å—(ç¨ååœ¨æ¨¡å—ä¸­è¿›ä¸€æ­¥ä»‹ç»)</p><p>è¾“å‡ºåº”è¯¥æ˜¯è¿™æ ·çš„:<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">host0 <span class="string">| success &gt;&gt; &#123;</span></span><br><span class="line">    <span class="string">"changed"</span>: false,</span><br><span class="line">    <span class="string">"ping"</span>: <span class="string">"pong"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">host1 <span class="string">| success &gt;&gt; &#123;</span></span><br><span class="line">    <span class="string">"changed"</span>: false,</span><br><span class="line">    <span class="string">"ping"</span>: <span class="string">"pong"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">host2 <span class="string">| success &gt;&gt; &#123;</span></span><br><span class="line">    <span class="string">"changed"</span>: false,</span><br><span class="line">    <span class="string">"ping"</span>: <span class="string">"pong"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h1 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h1><p>ä»¥ä¸‹ä¸ºå®‰è£…sshå¯†é’¥æ‰€ç”¨åˆ°çš„ <code>playbook</code><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">all</span></span><br><span class="line"><span class="attr">become:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">become_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">remote_user:</span> <span class="string">vagrant</span></span><br><span class="line"><span class="attr">gather_facts:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="comment"># This should work too / #2372</span></span><br><span class="line"><span class="comment"># - name: Pushes user key to root's on vagrant boxes</span></span><br><span class="line"><span class="comment">#   action: authorized_key key=$FILE($item) user=root</span></span><br><span class="line"><span class="comment">#   first_available_file:</span></span><br><span class="line"><span class="comment">#     - ~/.ssh/id_dsa.pub</span></span><br><span class="line"><span class="comment">#     - ~/.ssh/id_rsa.pub</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- name:</span> <span class="string">Wait</span> <span class="string">for</span> <span class="string">ssh</span> <span class="string">to</span> <span class="string">be</span> <span class="string">up</span></span><br><span class="line"><span class="attr">become:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">wait_for:</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">22</span></span><br><span class="line"><span class="attr">delay:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">connect_timeout:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">timeout:</span> <span class="number">360</span></span><br><span class="line"><span class="attr">host:</span> <span class="string">"<span class="template-variable">&#123;&#123; ansible_host &#125;&#125;</span>"</span></span><br><span class="line"><span class="attr">delegate_to:</span> <span class="string">localhost</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- name:</span> <span class="string">Installs</span> <span class="string">python</span></span><br><span class="line"><span class="attr">raw:</span> <span class="string">apt-get</span> <span class="string">update</span> <span class="string">&amp;&amp;</span> <span class="string">apt-get</span> <span class="string">install</span> <span class="bullet">-y</span> <span class="string">python</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- name:</span> <span class="string">Creates</span> <span class="string">destination</span> <span class="string">directory</span></span><br><span class="line"><span class="comment"># Workaround for #2372</span></span><br><span class="line"><span class="attr">file:</span></span><br><span class="line"><span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line"><span class="attr">mode:</span> <span class="number">0700</span></span><br><span class="line"><span class="attr">dest:</span> <span class="string">/root/.ssh/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- name:</span> <span class="string">Pushes</span> <span class="string">user's</span> <span class="string">rsa</span> <span class="string">key</span> <span class="string">to</span> <span class="string">root's</span> <span class="string">vagrant</span> <span class="string">box</span> <span class="string">(it's</span> <span class="string">ok</span> <span class="string">if</span> <span class="string">this</span> <span class="string">TASK</span> <span class="string">fails)</span></span><br><span class="line"><span class="comment"># action: authorized_key user=root key='$FILE(~/.ssh/id_rsa.pub)'</span></span><br><span class="line"><span class="comment"># Workaround for #2372</span></span><br><span class="line"><span class="attr">copy:</span></span><br><span class="line"><span class="attr">src:</span> <span class="string">~/.ssh/id_rsa.pub</span></span><br><span class="line"><span class="attr">dest:</span> <span class="string">/root/.ssh/authorized_keys</span></span><br><span class="line"><span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">mode:</span> <span class="number">0600</span></span><br><span class="line"><span class="attr">register:</span> <span class="string">rsa</span></span><br><span class="line"><span class="attr">ignore_errors:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- name:</span> <span class="string">Pushes</span> <span class="string">user's</span> <span class="string">dsa</span> <span class="string">key</span> <span class="string">to</span> <span class="string">root's</span> <span class="string">vagrant</span> <span class="string">box</span> <span class="string">(it's</span> <span class="string">NOT</span> <span class="string">ok</span> <span class="string">if</span> <span class="string">both</span> <span class="string">TASKs</span> <span class="string">fail)</span></span><br><span class="line"><span class="comment"># action: authorized_key user=root key='$FILE(~/.ssh/id_dsa.pub)'</span></span><br><span class="line"><span class="comment"># Workaround for #2372</span></span><br><span class="line"><span class="attr">copy:</span></span><br><span class="line"><span class="attr">src:</span> <span class="string">~/.ssh/id_dsa.pub</span></span><br><span class="line"><span class="attr">dest:</span> <span class="string">/root/.ssh/authorized_keys</span></span><br><span class="line"><span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">mode:</span> <span class="number">0600</span></span><br><span class="line"><span class="attr">when:</span> <span class="string">rsa</span> <span class="string">is</span> <span class="string">failed</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- name:</span> <span class="string">Checks</span> <span class="string">if</span> <span class="string">resolver</span> <span class="string">is</span> <span class="string">working</span> <span class="string">properly</span> <span class="string">(issues</span> <span class="string">with</span> <span class="string">some</span> <span class="string">VBox/Host</span> <span class="string">OS</span> <span class="string">combinations)</span></span><br><span class="line"><span class="attr">command:</span> <span class="string">host</span> <span class="bullet">-t</span> <span class="string">A</span> <span class="string">ansible.cc</span></span><br><span class="line"><span class="attr">register:</span> <span class="string">ns</span></span><br><span class="line"><span class="attr">ignore_errors:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- name:</span> <span class="string">Pushes</span> <span class="string">new</span> <span class="string">resolver</span> <span class="string">configuration</span> <span class="string">if</span> <span class="string">resolver</span> <span class="string">fails</span></span><br><span class="line"><span class="attr">lineinfile:</span></span><br><span class="line"><span class="attr">regexp:</span> <span class="string">"^nameserver "</span></span><br><span class="line"><span class="attr">line:</span> <span class="string">"nameserver 8.8.8.8"</span></span><br><span class="line"><span class="attr">dest:</span> <span class="string">/etc/resolv.conf</span></span><br><span class="line"><span class="attr">when:</span> <span class="string">ns</span> <span class="string">is</span> <span class="string">failed</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- name:</span> <span class="string">Checks</span> <span class="string">if</span> <span class="string">resolver</span> <span class="string">is</span> <span class="string">working</span> <span class="string">properly</span> <span class="string">with</span> <span class="string">new</span> <span class="string">nameserver</span></span><br><span class="line"><span class="attr">command:</span> <span class="string">host</span> <span class="bullet">-t</span> <span class="string">A</span> <span class="string">ansible.cc</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- name:</span> <span class="string">Final</span> <span class="string">greeting</span></span><br><span class="line"><span class="attr">pause:</span></span><br><span class="line"><span class="attr">seconds:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">echo:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">prompt:</span> <span class="string">"Don't worry about all the red above; if you made it here, your Vagrant VMs are probably fine !"</span></span><br></pre></td></tr></table></figure></p><ul><li>é¦–å…ˆï¼Œplaybookçš„æ–‡ä»¶æ ¼å¼ä¸º <code>yaml</code></li></ul><p>ä¸ºäº†æ–¹ä¾¿å°†å…¶åˆ†å¼€æ¥è¯´æ˜<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- hosts:</span> <span class="string">all</span></span><br><span class="line"><span class="attr">become:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">become_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">remote_user:</span> <span class="string">vagrant</span></span><br><span class="line"><span class="attr">gather_facts:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></p><ul><li>æ¯ä¸€ä¸ªå‰§æœ¬éƒ½åº”æŒ‡æ˜ç›¸åº”çš„hostä¹Ÿå°±æ˜¯inventoryï¼ˆåº“å­˜é‡Œçš„ä¸»æœºï¼‰ï¼Œé»˜è®¤çš„hostsæ–‡ä»¶åœ¨ <code>/etc/ansible/hosts</code> ,å½“ç„¶ä¹Ÿå¯ä»¥å°† <code>hosts</code> æ–‡ä»¶å­˜æ”¾åœ¨è‡ªå·±æŒ‡å®šçš„ä½ç½®ï¼Œæœ€ååœ¨æ‰§è¡Œ <code>ansible-play</code>æ—¶åŠ ä¸Š <code>-i</code>å‚æ•°æŒ‡æ˜è·¯å¾„ï¼Œè€Œ <code>all</code> å°±ä»£è¡¨ç€æ‰€æœ‰ä¸»æœº </li><li>è¿™é‡Œçš„ <code>become</code> ä»£è¡¨ç€ææƒï¼Œé»˜è®¤æ–¹å¼ä¸º <code>sudo</code>ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–æ–¹å¼ï¼Œå¦‚ <code>become_method: su</code></li><li><code>become_user</code> å°±å¥½ç†è§£äº†ï¼Œä¸ºææƒåçš„ç”¨æˆ·</li><li>è¦ç”¨åˆ°ææƒéš¾å…ä¼šè¾“å…¥å¯†ç ï¼Œæ­¤æ—¶è¿è¡Œè¯¥å‰§æœ¬æ—¶å°±åº”åŠ ä¸Š <code>-k</code> æˆ– <code>--ask-become-pass</code></li><li><code>remote_user</code> ä¸ºè¿œç¨‹ç™»å½•ç”¨æˆ·</li><li><code>gather_facts</code> ç”¨äºæ”¶é›†ç³»ç»Ÿä¿¡æ¯ï¼Œä¸éœ€è¦æ—¶å…³é—­å¯æé«˜è¿è¡Œé€Ÿåº¦</li></ul><p>æ¥ä¸‹æ¥å°±æ˜¯<code>tasks</code><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- name:</span> <span class="string">Creates</span> <span class="string">destination</span> <span class="string">directory</span></span><br><span class="line"><span class="comment"># Workaround for #2372</span></span><br><span class="line"><span class="attr">file:</span></span><br><span class="line"><span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line"><span class="attr">mode:</span> <span class="number">0700</span></span><br><span class="line"><span class="attr">dest:</span> <span class="string">/root/.ssh/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- name:</span> <span class="string">Pushes</span> <span class="string">user's</span> <span class="string">rsa</span> <span class="string">key</span> <span class="string">to</span> <span class="string">root's</span> <span class="string">vagrant</span> <span class="string">box</span> <span class="string">(it's</span> <span class="string">ok</span> <span class="string">if</span> <span class="string">this</span> <span class="string">TASK</span> <span class="string">fails)</span></span><br><span class="line"><span class="comment"># action: authorized_key user=root key='$FILE(~/.ssh/id_rsa.pub)'</span></span><br><span class="line"><span class="comment"># Workaround for #2372</span></span><br><span class="line"><span class="attr">copy:</span></span><br><span class="line"><span class="attr">src:</span> <span class="string">~/.ssh/id_rsa.pub</span></span><br><span class="line"><span class="attr">dest:</span> <span class="string">/root/.ssh/authorized_keys</span></span><br><span class="line"><span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">mode:</span> <span class="number">0600</span></span><br><span class="line"><span class="attr">register:</span> <span class="string">rsa</span></span><br><span class="line"><span class="attr">ignore_errors:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></p><ul><li>æ ¹æ® <code>yaml</code> è¯­æ³•ï¼Œ<code>-</code>è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåé¢çš„ <code>name</code> å¯æœ‰å¯æ— ï¼Œä¸ºäº†æœ‰æ›´å¥½çš„è¾¨æ˜åº¦ï¼Œæœ€å¥½åŠ ä¸Š</li><li>åé¢æœ€å…ˆæ¥çš„æ˜¯ä¸€ä¸ªæ¨¡å—åç§°ï¼Œå†åé¢å°±æ˜¯è¿›è¡Œçš„æ“ä½œï¼Œä¹‹åçš„æ•™ç¨‹ä¼šè¯´åˆ°</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å®˜æ–¹æ–‡æ¡£è™½å¥½ï¼Œæ ·æ ·ä¿±å…¨ï¼Œå¯å°±æ˜¯å¤ªç¢å¤ªç»†ï¼Œéš¾ä»¥æ‹¼æ¥æ¶ˆåŒ–ï¼Œé‚£ä¹ˆå°±å…ˆä»è·Ÿç€ä¸€ä»½å¥½çš„æ•™ç¨‹å…ˆæ…¢æ…¢å­¦èµ·å§&lt;/p&gt;
&lt;p&gt;æºåœ°å€ï¼ˆåŒ…å«æ‰€æœ‰æ‰€éœ€æ–‡ä»¶ï¼‰â€“&amp;g
      
    
    </summary>
    
    
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="ansible" scheme="http://yoursite.com/tags/ansible/"/>
    
  </entry>
  
  <entry>
    <title>vagrantå­¦ä¹ </title>
    <link href="http://yoursite.com/2020/05/06/vagrant%E5%AD%A6%E4%B9%A0/"/>
    <id>http://yoursite.com/2020/05/06/vagrant%E5%AD%A6%E4%B9%A0/</id>
    <published>2020-05-06T04:36:14.000Z</published>
    <updated>2020-05-06T14:02:27.285Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="ä»€ä¹ˆæ˜¯vagrant"><a href="#ä»€ä¹ˆæ˜¯vagrant" class="headerlink" title="ä»€ä¹ˆæ˜¯vagrant"></a>ä»€ä¹ˆæ˜¯vagrant</h1><blockquote><p>Vagrant is a tool for building and managing virtual machine environments in a single workflow. With an easy-to-use workflow and focus on automation, Vagrant lowers development environment setup time, increases production parity, and makes the â€œworks on my machineâ€ excuse a relic of the past.</p><ul><li>ç®€è€Œè¨€ä¹‹ï¼Œå³æ˜¯ä¸€æ¬¡æ‰“åŒ…ï¼Œéšå¤„ä½¿ç”¨</li></ul></blockquote><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>vagrant æ”¯æŒå¤šç§è™šæ‹ŸåŒ–è½¯ä»¶</p><ul><li>VirualBox</li><li>Vmware(ä»˜è´¹)</li><li>KVM</li><li>Hyper-v</li></ul><p>è¿™é‡Œç”¨åˆ°çš„æ˜¯ virtualboxï¼ˆé»˜è®¤æ”¯æŒï¼‰ï¼Œæ³¨æ„éœ€å…ˆå®‰è£… virtualboxï¼Œå†å®‰è£… vagrantï¼Œå¦åˆ™ä¼šå‡ºç°æ‰¾ä¸åˆ° virualbox çš„é”™è¯¯ï¼Œéœ€é‡æ–°å®‰è£…</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo pacman -S virualbox</span></span><br></pre></td></tr></table></figure><ul><li>å®‰è£…åè¿˜éœ€åŠ è½½ç›¸åº”å†…æ ¸æ¨¡å—<code>modprobe -a vboxdrv</code></li></ul><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo pacman -S vagrant</span></span><br></pre></td></tr></table></figure><h1 id="ä»€ä¹ˆæ˜¯box"><a href="#ä»€ä¹ˆæ˜¯box" class="headerlink" title="ä»€ä¹ˆæ˜¯box"></a>ä»€ä¹ˆæ˜¯box</h1><p>box æ˜¯vagrantç¯å¢ƒçš„ä¸€ç§æ‰“åŒ…æ ¼å¼ï¼Œåœ¨æ‰€æœ‰vagrantæ”¯æŒçš„æ“ä½œç³»ç»Ÿä¸Šæ˜¯é€šç”¨çš„ï¼Œè€Œåé¢æ‰€æœ‰è¿›è¡Œçš„æ“ä½œéƒ½ä¸boxæ¯æ¯ç›¸å…³ï¼ˆç±»ä¼¼äºdockerä¸­çš„é•œåƒï¼‰</p><p>è¿™æ˜¯boxå•†åº— â€”&gt; <a href="https://app.vagrantup.com/boxes/search" target="_blank" rel="noopener">door</a></p><ul><li>åœ¨è¿™é‡Œå¯ä»¥æ‰¾åˆ°å„ç§æƒ³è¦å‘è¡Œç‰ˆæˆ–æœåŠ¡</li></ul><p>æ¯ä¸ªboxä»¥ <code>ä½œè€…å/boxå</code>åŠ ä»¥åŒºåˆ†</p><p>æ·»åŠ ä¸€ä¸ªbox<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">vagrant</span> <span class="keyword">box </span><span class="keyword">add </span>ubuntu/trusty64</span><br></pre></td></tr></table></figure></p><ul><li><p>å¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªä¸‹è½½åœ°å€</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vagrant <span class="type">box</span> <span class="keyword">add</span> \</span><br><span class="line">https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/bionic/<span class="keyword">current</span>/bionic-<span class="keyword">server</span>-cloudimg-amd64-vagrant.box \</span><br><span class="line"><span class="comment">--name ubuntu/bionic</span></span><br></pre></td></tr></table></figure></li><li><p>å°±åƒè¿™æ ·</p></li></ul><p>æŸ¥çœ‹åˆšåˆšæ·»åŠ çš„box<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant box <span class="built_in">list</span></span><br></pre></td></tr></table></figure></p><p>åˆ é™¤<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant <span class="built_in">box</span> <span class="built_in">remove</span> name</span><br></pre></td></tr></table></figure></p><h1 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h1><p>äº†è§£äº†boxï¼Œå°±å¯ä»¥æ­£å¼å¼€å§‹äº†</p><p>å…ˆæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä½œä¸ºæœ¬æ¬¡çš„å¤§æœ¬è¥,åˆå§‹åŒ–<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mkdir</span> <span class="keyword">my</span>-vagrant</span><br><span class="line">cd <span class="keyword">my</span>-vagrant</span><br><span class="line"></span><br><span class="line">vagrant init ubuntu/trusty64</span><br></pre></td></tr></table></figure></p><ul><li>init æŒ‡å®šä¸€ä¸ªboxï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªurl</li></ul><p>è¿™æ ·åœ¨å½“å‰ç›®å½•å°±ç”Ÿæˆäº†ä¸€ä¸ªVagrantfileï¼Œä½œä¸ºæˆ‘ä»¬çš„åˆå§‹é…ç½®æ–‡ä»¶<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- mode: ruby -*-</span></span><br><span class="line"><span class="comment"># vi: set ft=ruby :</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># All Vagrant configuration is done below. The "2" in Vagrant.configure</span></span><br><span class="line"><span class="comment"># configures the configuration version (we support older styles for</span></span><br><span class="line"><span class="comment"># backwards compatibility). Please don't change it unless you know what</span></span><br><span class="line"><span class="comment"># you're doing.</span></span><br><span class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> |config|</span><br><span class="line">  <span class="comment"># The most common configuration options are documented and commented below.</span></span><br><span class="line">  <span class="comment"># For a complete reference, please see the online documentation at</span></span><br><span class="line">  <span class="comment"># https://docs.vagrantup.com.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Every Vagrant development environment requires a box. You can search for</span></span><br><span class="line">  <span class="comment"># boxes at https://vagrantcloud.com/search.</span></span><br><span class="line">  config.vm.box = <span class="string">"ubuntu/trusty64"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Disable automatic box update checking. If you disable this, then</span></span><br><span class="line">  <span class="comment"># boxes will only be checked for updates when the user runs</span></span><br><span class="line">  <span class="comment"># `vagrant box outdated`. This is not recommended.</span></span><br><span class="line">  <span class="comment"># config.vm.box_check_update = false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Create a forwarded port mapping which allows access to a specific port</span></span><br><span class="line">  <span class="comment"># within the machine from a port on the host machine. In the example below,</span></span><br><span class="line">  <span class="comment"># accessing "localhost:8080" will access port 80 on the guest machine.</span></span><br><span class="line">  <span class="comment"># <span class="doctag">NOTE:</span> This will enable public access to the opened port</span></span><br><span class="line">  <span class="comment"># config.vm.network "forwarded_port", guest: 80, host: 8080</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Create a forwarded port mapping which allows access to a specific port</span></span><br><span class="line">  <span class="comment"># within the machine from a port on the host machine and only allow access</span></span><br><span class="line">  <span class="comment"># via 127.0.0.1 to disable public access</span></span><br><span class="line">  <span class="comment"># config.vm.network "forwarded_port", guest: 80, host: 8080, host_ip: "127.0.0.1"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Create a private network, which allows host-only access to the machine</span></span><br><span class="line">  <span class="comment"># using a specific IP.</span></span><br><span class="line">  <span class="comment"># config.vm.network "private_network", ip: "192.168.33.10"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Create a public network, which generally matched to bridged network.</span></span><br><span class="line">  <span class="comment"># Bridged networks make the machine appear as another physical device on</span></span><br><span class="line">  <span class="comment"># your network.</span></span><br><span class="line">  <span class="comment"># config.vm.network "public_network"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Share an additional folder to the guest VM. The first argument is</span></span><br><span class="line">  <span class="comment"># the path on the host to the actual folder. The second argument is</span></span><br><span class="line">  <span class="comment"># the path on the guest to mount the folder. And the optional third</span></span><br><span class="line">  <span class="comment"># argument is a set of non-required options.</span></span><br><span class="line">  <span class="comment"># config.vm.synced_folder "../data", "/vagrant_data"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Provider-specific configuration so you can fine-tune various</span></span><br><span class="line">  <span class="comment"># backing providers for Vagrant. These expose provider-specific options.</span></span><br><span class="line">  <span class="comment"># Example for VirtualBox:</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># config.vm.provider "virtualbox" do |vb|</span></span><br><span class="line">  <span class="comment">#   # Display the VirtualBox GUI when booting the machine</span></span><br><span class="line">  <span class="comment">#   vb.gui = true</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment">#   # Customize the amount of memory on the VM:</span></span><br><span class="line">  <span class="comment">#   vb.memory = "1024"</span></span><br><span class="line">  <span class="comment"># end</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># View the documentation for the provider you are using for more</span></span><br><span class="line">  <span class="comment"># information on available options.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Enable provisioning with a shell script. Additional provisioners such as</span></span><br><span class="line">  <span class="comment"># Ansible, Chef, Docker, Puppet and Salt are also available. Please see the</span></span><br><span class="line">  <span class="comment"># documentation for more information about their specific syntax and use.</span></span><br><span class="line">  <span class="comment"># config.vm.provision "shell", inline: &lt;&lt;-SHELL</span></span><br><span class="line">  <span class="comment">#   apt-get update</span></span><br><span class="line">  <span class="comment">#   apt-get install -y apache2</span></span><br><span class="line">  <span class="comment"># SHELL</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p><ul><li>é…ç½®æ–‡ä»¶çš„è¯­æ³•æ ¼å¼ä¸ºruby</li></ul><p>ç›¸å…³é…ç½®å—å…±æœ‰5ç§ï¼š</p><ul><li>config.vm ä¸è™šæ‹Ÿæœºç›¸å…³é…ç½®</li><li>config.ssh ä¸sshç›¸å…³é…ç½®</li><li>config.vagrant ä¸vagrantè‡ªèº«ç›¸å…³é…ç½®</li><li>config.winrm ä¸Windowsè¿œç¨‹ç®¡ç†ç›¸å…³é…ç½®</li><li>config.winssh ä¸Windowså¹³å°ä¸Šsshç›¸å…³é…ç½®</li></ul><p>æœ€å¸¸ç”¨çš„è¿˜æ˜¯config.vm</p><table><thead><tr><th style="text-align:center">config.vm.box</th><th style="text-align:center">æŒ‡å®šä¸€ä¸ªboxï¼ˆåˆå§‹åŒ–æ—¶å°±å·²ç»è‡ªåŠ¨å¡«å¥½ï¼‰</th></tr></thead><tbody><tr><td style="text-align:center">config.vm.box_version</td><td style="text-align:center">æŒ‡å®šä¸€ä¸ªboxçš„ç‰ˆæœ¬</td></tr><tr><td style="text-align:center">comfig.vm.define</td><td style="text-align:center">ä¸ºè¿™ä¸ªè™šæ‹Ÿæœºå–ä¸ªåï¼ˆé»˜è®¤ä¸ºdefaultï¼‰</td></tr></tbody></table><p><a href="https://www.vagrantup.com/docs/vagrantfile/machine_settings.html" target="_blank" rel="noopener">æ›´å¤šè®¾ç½®</a></p><p>å¼€å§‹å¯åŠ¨<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vagrant up</span></span><br></pre></td></tr></table></figure></p><ul><li>è¿™æ ·è¿‡ä¸€ä¼šè™šæ‹Ÿæœºå°±ä¼šå¯åŠ¨å®Œæˆäº†</li></ul><p>å…³æœºã€é‡å¯<br><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vagrant</span> <span class="string">halt</span></span><br><span class="line"></span><br><span class="line"><span class="attr">vagrant</span> <span class="string">reload</span></span><br></pre></td></tr></table></figure></p><h1 id="sshç®¡ç†"><a href="#sshç®¡ç†" class="headerlink" title="sshç®¡ç†"></a>sshç®¡ç†</h1><p>åˆ›å»ºå®Œæˆåå·²ç»è‡ªåŠ¨è®¾ç½®å¥½äº†sshï¼ŒæŸ¥çœ‹é…ç½®<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vagrant ssh-config</span><br><span class="line"></span><br><span class="line">&gt;</span><br><span class="line">Host default</span><br><span class="line">HostName 127.0.0.1</span><br><span class="line">User vagrant</span><br><span class="line">Port 2222</span><br><span class="line">UserKnownHostsFile /dev/<span class="literal">null</span></span><br><span class="line">StrictHostKeyChecking <span class="literal">no</span></span><br><span class="line">PasswordAuthentication <span class="literal">no</span></span><br><span class="line">IdentityFile /home/test/my-vagrant/.vagrant/machines/default/virtualbox/private_key</span><br><span class="line">IdentitiesOnly <span class="literal">yes</span></span><br><span class="line">LogLevel FATAL</span><br></pre></td></tr></table></figure></p><ul><li>å¯ä»¥å¾—åˆ°å‡ ä¸ªé‡è¦ä¿¡æ¯ï¼šipã€ç«¯å£ã€ç”¨æˆ·åã€å¯†é’¥åœ°å€</li></ul><p>è¿æ¥è™šæ‹Ÿæœº<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vagrant ssh </span><br><span class="line"></span><br><span class="line"># ç­‰åŒäº ssh <span class="symbol">vagrant@</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -p <span class="number">2222</span> -i ~/myâ€”vagrant/.vagrant/machines/<span class="keyword">default</span>/virtualbox/private_key</span><br></pre></td></tr></table></figure></p><ul><li>è‹¥æœ‰å¤šä¸ªè™šæ‹Ÿæœºï¼Œåˆ™åœ¨ssh åæ¥åå­—å³å¯</li></ul><h1 id="Provisioning-é¢„é…ç½®"><a href="#Provisioning-é¢„é…ç½®" class="headerlink" title="Provisioning é¢„é…ç½®"></a>Provisioning é¢„é…ç½®</h1><p>è¦ä½¿ç”¨Preovision é¡»åœ¨Vagrantfileé‡Œé…ç½®ï¼Œè¿™æ ·åœ¨åœ¨è™šæ‹Ÿæœºå¼€å¯æ—¶ä¼šè‡ªåŠ¨è¿è¡Œè¿™äº›é¢„å…ˆé…ç½®</p><p>é…ç½®è¯­æ³•å…¶ä¸€ä¸ºå†…è”<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config<span class="selector-class">.vm</span><span class="selector-class">.provision</span> <span class="string">"shell"</span>, inline: <span class="string">"echo hello"</span></span><br></pre></td></tr></table></figure></p><ul><li><code>config.vm.provision</code> åæ¥çš„æ˜¯é¢„é…ç½®çš„æä¾›è€…ç±»å‹ </li></ul><p>å…¶äºŒä»¥é…ç½®å—çš„æ–¹å¼å‡ºç°<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">config.vm.provision <span class="string">"shell"</span> <span class="built_in">do</span> |<span class="type">s</span>|<span class="type"></span></span><br><span class="line"><span class="type">  s</span>.inline = <span class="string">"echo hello"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">æˆ–å…ˆä¸ºå…¶èµ·ä¸ªåå­—</span><br><span class="line"> config.vm.provision <span class="string">"ansibbbble"</span>,type: <span class="string">"ansible"</span>  <span class="built_in">do</span> |<span class="type">ansible</span>|<span class="type"></span></span><br><span class="line"><span class="type">  ansible</span>.playbook = <span class="string">"./playbook.yml"</span></span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure></p><ul><li>åè€…çš„â€ansibbbbleâ€ åˆ™ä¸ºé¢„é…ç½®çš„ä¸€ä¸ªåå­—ï¼Œè¿™æ ·çš„è¯è¾“å‡ºä¼šæ›´åŠ ç›´ç™½</li></ul><p>è‹¥æ˜¯åœ¨å¯åŠ¨åè¿˜æƒ³å†æ¬¡è¿è¡Œé¢„é…ç½®<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vagrant provision</span></span><br></pre></td></tr></table></figure></p><h1 id="åŒæ­¥æ–‡ä»¶"><a href="#åŒæ­¥æ–‡ä»¶" class="headerlink" title="åŒæ­¥æ–‡ä»¶"></a>åŒæ­¥æ–‡ä»¶</h1><p>åœ¨è™šæ‹Ÿæœºå¼€å¯æ—¶ï¼Œä¼šè‡ªåŠ¨å°†å½“å‰ç›®å½•ä¸è™šæ‹Ÿæœºä¸­çš„ <code>/vagrant</code> æ–‡ä»¶å¤¹è¿›è¡ŒåŒæ­¥ï¼Œå®åˆ™è‡ªåŠ¨å°†å½“å‰ç›®å½•æŒ‚è½½äº†</p><hr><p><a href="https://www.vagrantup.com/docs/" target="_blank" rel="noopener">æ›´å¤šæ–‡æ¡£</a></p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="vagrant" scheme="http://yoursite.com/tags/vagrant/"/>
    
  </entry>
  
  <entry>
    <title>å¤šè¿›ç¨‹shellçš„ä½¿ç”¨</title>
    <link href="http://yoursite.com/2020/05/01/%E5%A4%9A%E8%BF%9B%E7%A8%8Bshell%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://yoursite.com/2020/05/01/%E5%A4%9A%E8%BF%9B%E7%A8%8Bshell%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2020-05-01T10:55:28.000Z</published>
    <updated>2020-05-01T12:26:20.008Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><p>åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œshellæ‰§è¡Œä¸€ä¸ªå‘½ä»¤éƒ½æ˜¯forkä¸€ä¸ªå­è¿›ç¨‹å†execç›¸åº”å‘½ä»¤</p><p>shellä¹Ÿå¯ä»¥å®ç°å¤šè¿›ç¨‹å®ç°å¹¶å‘</p><p>å°†è¦ç”¨åˆ°å¤šè¿›ç¨‹çš„è¯­å¥ç”¨<code>{  }</code>æ‹¬èµ·æ¥ï¼Œåœ¨æœ€ååŠ ä¸Š<code>&amp;</code>ï¼Œå°±ä¼šåœ¨è¿è¡Œæ—¶è¿è¡Œå¤šä¸ªå­shellå®ç°å¤šè¿›ç¨‹</p><p>ä¸Šé¢å°±ç±»ä¼¼äºcè¯­è¨€ä¸­çš„<code>fork()</code>,é‚£ä¸å¾—ä¸è¯´ä¸ä¹‹æ­é…çš„<code>waitï¼ˆï¼‰</code>ï¼Œshellé‡Œå¯¹åº”çš„æ˜¯<code>wait</code></p><ul><li><code>wait</code> é»˜è®¤æ˜¯ç­‰å¾…å­è¿›ç¨‹å…¨éƒ¨é€€å‡ºï¼Œåæ¥pidåˆ™ä¸ºç­‰å¾…æŒ‡å®šè¿›ç¨‹é€€å‡º</li></ul><p>æ¥ä¸€ä¸ªæ‰¹é‡pingçš„è„šæœ¬<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> &#123;1..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    sleep 3</span><br><span class="line">    ping 192.168.1.<span class="variable">$ip</span> -c 3 &gt; /dev/null</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ];</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        hostname=`nslookup 192.168.1.<span class="variable">$ip</span> | awk <span class="string">'&#123;print $4&#125;'</span>`</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$hostname</span> != <span class="string">"find"</span> ]; <span class="comment">#å½“æ²¡æ‰¾åˆ°hostnameæ—¶ä¸ºâ€œfindâ€</span></span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"192.168.1.<span class="variable">$ip</span> <span class="variable">$hostname</span> is up"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"192.168.1.<span class="variable">$ip</span> is up"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">wait</span></span><br></pre></td></tr></table></figure></p><ul><li>ä½¿ç”¨<code>ps aux | grep ping | grep -v grep | wc -l</code>æ¥éªŒè¯ï¼Œç»“æœä¸º254ï¼Œä¹Ÿå°±æ˜¯å®å®åœ¨åœ¨æœ‰254ä¸ªè¿›ç¨‹åœ¨å¹¶å‘å®è¡Œ</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="shell" scheme="http://yoursite.com/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>manjaroè§£å†³xboxæ‰‹æŸ„è“ç‰™é—®é¢˜</title>
    <link href="http://yoursite.com/2020/05/01/manjaro%E4%B8%8B%E8%A7%A3%E5%86%B3%E8%93%9D%E7%89%99%E9%97%AE%E9%A2%98/"/>
    <id>http://yoursite.com/2020/05/01/manjaro%E4%B8%8B%E8%A7%A3%E5%86%B3%E8%93%9D%E7%89%99%E9%97%AE%E9%A2%98/</id>
    <published>2020-05-01T02:58:05.000Z</published>
    <updated>2020-05-01T03:52:07.558Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><p>å®‰è£…ä¾èµ–<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">sudo</span> pacman -S dkms linux-headers <span class="keyword">bluez </span><span class="keyword">bluez-utils</span></span><br></pre></td></tr></table></figure></p><p>æŸ¥çœ‹å†…æ ¸æ˜¯å¦åŠ è½½äº†è“ç‰™æ¨¡å—<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep btusb</span><br><span class="line"></span><br><span class="line">&gt;</span><br><span class="line">btusb                  <span class="number">65536</span>  <span class="number">0</span></span><br><span class="line">btrtl                  <span class="number">24576</span>  <span class="number">1</span> btusb</span><br><span class="line">btbcm                  <span class="number">16384</span>  <span class="number">1</span> btusb</span><br><span class="line">btintel                <span class="number">28672</span>  <span class="number">1</span> btusb</span><br><span class="line">bluetooth             <span class="number">671744</span>  <span class="number">39</span> btrtl,btintel,btbcm,bnep,btusb,rfcomm</span><br></pre></td></tr></table></figure></p><p>å®‰è£…é©±åŠ¨<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/tmp</span></span><br><span class="line">git clone https:<span class="string">//github.com/atar-axis/xpadneo.git</span></span><br><span class="line"><span class="keyword">cd</span> xpadneo </span><br><span class="line">sudo <span class="string">.install.sh</span></span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶è¿æ¥è“ç‰™<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bluetoothctl</span><br><span class="line"></span><br><span class="line">&gt;scan</span><br><span class="line"><span class="comment"># æ­¤æ—¶ä¼šå‡ºç°æ–°æ‰«æå‡ºæ¥çš„è®¾å¤‡ </span></span><br><span class="line">[NEW] Device C8:3F:2A:7A:FB:4A Xbox<span class="built_in"> Wireless </span>Controller</span><br><span class="line"></span><br><span class="line">&gt;pair macåœ°å€</span><br><span class="line">&gt;trust macåœ°å€</span><br><span class="line">&gt;connect macåœ°å€</span><br></pre></td></tr></table></figure></p><ul><li>å½“æ‰‹æŸ„éœ‡åŠ¨ä¸”è¥¿ç“œç¯å¸¸äº®å°±åº”ç»è¿æ¥æˆåŠŸäº†</li></ul><hr><p>å…³äºè“ç‰™è€³æœºè¿æ¥ä¸Šäº†ï¼Œä½†æ’­æ”¾æ²¡æœ‰å£°éŸ³ï¼Œé‡å¯ä¸€ä¸‹æœåŠ¡å¯ä»¥è§£å†³<code>systemctl restart bluetooth</code></p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="è“ç‰™" scheme="http://yoursite.com/tags/%E8%93%9D%E7%89%99/"/>
    
  </entry>
  
  <entry>
    <title>å‘¨å¹´äº‹è®°</title>
    <link href="http://yoursite.com/2020/04/25/%E5%91%A8%E5%B9%B4%E4%BA%8B%E8%AE%B0/"/>
    <id>http://yoursite.com/2020/04/25/%E5%91%A8%E5%B9%B4%E4%BA%8B%E8%AE%B0/</id>
    <published>2020-04-25T03:56:14.000Z</published>
    <updated>2020-05-06T14:04:13.014Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><blockquote><p>æœ¬æ¥è§‰å¾—æ‘†è„±æ ‡ç­¾æ´»å‡ºè‡ªå·±å°±å·²ç»æ˜¯å°½åŠ›äº†,å¯æ¸æ¸å´åœ¨è¿½æ±‚è‡ªæˆ‘çš„è·¯ä¸Šä¸æ–­ç»™è‡ªå·±åŠ ä¸Šæ ‡ç­¾,çœŸåƒä¸€å¤´çŒªå•Š</p></blockquote><p>å§‹ç»ˆå¿˜ä¸äº†ä¹‹å‰çœ‹è¿‡çš„ä¸€éƒ¨ç”µå½±,é•œå¤´å…ˆæ˜¯ä¸€ä¸ªå–§é—¹çš„é…’å§,äººä»¬åœ¨å¿«æ´»åœ°è·³ç€èˆ,éšç€æ˜¯ä¸€ä¸ªé»‘ç™½çš„ã€æ— å£°éŸ³çš„ã€äººä»¬åœ¨åœ°ä¸Šè¯¡å¼‚åœ°æ‰­åŠ¨çš„ä¸Šå¸è§†è§’é•¿é•œå¤´ã€‚é‚£å‡ åˆ†é’Ÿï¼Œä»¿ä½›æ˜¯ä¸€ä¸ªè‡ªæˆ‘çš„è§‰é†’</p><blockquote><p>ä¸€ä¸ªæ— é™é¥è¿œçš„ç›®æ ‡ä¸æ˜¯ç›®æ ‡,è€Œæ˜¯ä¸€ä¸ªæ¬ºéª—<br>  ä¸€ä¸ªæ— é™é¥è¿œçš„ç†ç”±ä¹Ÿä¸æ˜¯ç†ç”±,è€Œæ˜¯ä¸€ä¸ªå€Ÿå£</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>ä¸ºå¤šä¸ªä»£ç†è®¾ç½®åå‘ä»£ç†</title>
    <link href="http://yoursite.com/2020/04/19/%E4%B8%BA%E5%A4%9A%E4%B8%AA%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"/>
    <id>http://yoursite.com/2020/04/19/%E4%B8%BA%E5%A4%9A%E4%B8%AA%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/</id>
    <published>2020-04-19T14:06:57.000Z</published>
    <updated>2020-04-26T04:36:11.789Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="ä¸ºwebè®¾ç½®åå‘ä»£ç†"><a href="#ä¸ºwebè®¾ç½®åå‘ä»£ç†" class="headerlink" title="ä¸ºwebè®¾ç½®åå‘ä»£ç†"></a>ä¸ºwebè®¾ç½®åå‘ä»£ç†</h1><p>é¦–å…ˆåœ¨httpä¸‹åŠ ä¸Šupstreamå­—æ®µ<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">upstream webserver &#123;</span><br><span class="line">   <span class="built_in"> server </span>127.0.0.1:80;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å†åœ¨<code>server</code>åŠ ä¸Šlocation<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">/ &#123;</span></span><br><span class="line"><span class="title">    proxy_pass</span> http://webserver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è‡³æ­¤ç®€å•åå‘ä»£ç†å®Œæˆ<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span> mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">upstream</span> web &#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">127.0.0.1:80</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://web;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h1><p>ä¸ºçš„å°±æ˜¯å®ç°ä¼˜åŒ–èµ„æºåˆ©ç”¨ç‡,å¢å¤§ååé‡,å‡å°‘è®¿é—®å»¶è¿ŸåŠä¸€å®šçš„å®¹é”™ç­–ç•¥</p><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><ul><li>è½®è¯¢(round-robin) â€“ å¯¹åº”ç”¨ç¨‹åºæœåŠ¡å™¨çš„è¯·æ±‚ä»¥è½®è¯¢æ–¹å¼åˆ†å‘ï¼Œ</li><li>æœ€å°‘çš„è¿æ¥(least-connected) â€“ ä¸‹ä¸€ä¸ªè¯·æ±‚åˆ†é…ç»™è¿æ¥æœ€å°‘çš„æœåŠ¡å™¨</li><li>ip-hash â€“ æ ¹æ®ipæ¥å†³å®šç”±å“ªä¸€å°æœåŠ¡å™¨</li></ul><p>å°±ä¸Šä¸€èŠ‚æ¥è¯´,å½“<code>upstram</code>é‡Œå‡ºç°å¤šä¸ª<code>server</code>æ—¶,é»˜è®¤å°±ä¸ºè½®è¯¢<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨è¿™é‡ŒåŠ ä¸Šå…³é”®å­—`weight`å¯ä¸ºè½®è¯¢åŠ ä¸Šæƒé‡</span></span><br><span class="line">    upstream web &#123;</span><br><span class="line">       <span class="built_in"> server </span>127.0.0.1:80 weight = 1;</span><br><span class="line">       <span class="built_in"> server </span>127.0.0.1:81 weight = 10;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><ul><li>æ„æ€ä¸º11ä¸ªè¿æ¥ä¸­10ä¸ªåˆ†ç»™81ç«¯å£,å‰©ä¸‹1ä¸ªç»™80</li></ul><p>è®¾ç½®<code>least-connected</code>åŠ ä¸Š<code>minimum_conn</code>å³å¯</p><p>è®¾ç½®<code>ip-hash</code>å¯å®ç°ä¼šè¯çš„æŒä¹…æ€§,ä»¥é¿å…é‡å¤å»ºç«‹ä¸å¿…è¦çš„è¿æ¥,åŠ ä¸Š<code>ip_hash</code>å³å¯</p><p><code>upstream</code>çš„ä¸€äº›é«˜çº§å­—æ®µ:</p><ul><li>downï¼šè¡¨ç¤ºå•å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½.</li><li>max_failsï¼šå…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°é»˜è®¤ä¸º1.å½“è¶…è¿‡æœ€å¤§æ¬¡æ•°æ—¶ï¼Œè¿”å›proxy_next_upstream æ¨¡å—å®šä¹‰çš„é”™è¯¯.</li><li>fail_timeout : max_failsæ¬¡å¤±è´¥åï¼Œæš‚åœçš„æ—¶é—´ã€‚</li><li>backupï¼š å…¶å®ƒæ‰€æœ‰çš„ébackupæœºå™¨downæˆ–è€…å¿™çš„æ—¶å€™ï¼Œè¯·æ±‚backupæœºå™¨ã€‚</li></ul><p><a href="http://nginx.org/en/docs/http/load_balancing.html" target="_blank" rel="noopener">http://nginx.org/en/docs/http/load_balancing.html</a></p><h1 id="ä¸ºå¤šä¸ªä»£ç†è®¾ç½®åå‘ä»£ç†"><a href="#ä¸ºå¤šä¸ªä»£ç†è®¾ç½®åå‘ä»£ç†" class="headerlink" title="ä¸ºå¤šä¸ªä»£ç†è®¾ç½®åå‘ä»£ç†"></a>ä¸ºå¤šä¸ªä»£ç†è®¾ç½®åå‘ä»£ç†</h1><blockquote><p>ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ª?æ€»æœ‰äº›ä»£ç†ä¸å¤Ÿç¨³å®š,è¿™æ ·å°±éœ€è¦é¢‘ç¹æ›´æ”¹åº”ç”¨çš„ä»£ç†ç«¯å£,å¦‚æœèƒ½è®¾ç½®ä¸€ä¸ªåå‘ä»£ç†ä»£ç†å®ƒä»¬,å°±èƒ½ä»¥ä¸€ä¸ªå›ºå®šç«¯å£è®¿é—®äº†</p></blockquote><p>è¿™é‡Œç”¨åˆ°çš„æ˜¯<code>stream</code>æ¨¡å—è€Œä¸æ˜¯<code>http</code><br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">stream &#123;</span><br><span class="line">    upstream proxys &#123;</span><br><span class="line">       <span class="built_in"> server </span>127.0.0.1:1234 <span class="attribute">max_fails</span>=2 <span class="attribute">fail_timeout</span>=1s;</span><br><span class="line">       <span class="built_in"> server </span>127.0.0.1:12345 backup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> server </span>&#123;</span><br><span class="line">        listen 127.0.0.1:12666;</span><br><span class="line">        # ä¸èƒ½å‡ºç°server_nameå­—æ®µå’Œå…¶ä½™é»˜è®¤httpç›¸å…³å­—æ®µ</span><br><span class="line"></span><br><span class="line">        proxy_pass proxys;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>è¿™æ ·å°±okäº†,é»˜è®¤ä¼˜å…ˆæä¾›1234ç«¯å£æœåŠ¡,é™¤éæœåŠ¡ä¸å¯ç”¨è¶…æ—¶</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="nginx" scheme="http://yoursite.com/tags/nginx/"/>
    
      <category term="åå‘ä»£ç†" scheme="http://yoursite.com/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>docker-composeå­¦ä¹ </title>
    <link href="http://yoursite.com/2020/04/12/docker-compose%E5%AD%A6%E4%B9%A0/"/>
    <id>http://yoursite.com/2020/04/12/docker-compose%E5%AD%A6%E4%B9%A0/</id>
    <published>2020-04-12T13:13:55.000Z</published>
    <updated>2020-05-01T12:29:07.032Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="æ„å»ºè‡ªå·±çš„é•œåƒ"><a href="#æ„å»ºè‡ªå·±çš„é•œåƒ" class="headerlink" title="æ„å»ºè‡ªå·±çš„é•œåƒ"></a>æ„å»ºè‡ªå·±çš„é•œåƒ</h1><p>åˆ›å»ºè‡ªå·±çš„dockeré•œåƒå¯ä»¥æœ‰ä¸¤ç§æ–¹å¼</p><ol><li>åœ¨å·²æœ‰é•œåƒä¸Šåšä¿®æ”¹å†commit</li><li>åˆ©ç”¨dockerfileæ„å»º</li><li>æ‰‹åŠ¨å¯¼å…¥å¯¼å‡ºï¼ˆè¿‡æ—¶ï¼‰</li></ol><h4 id="docker-commit"><a href="#docker-commit" class="headerlink" title="docker commit"></a>docker commit</h4><p>é»˜è®¤å®¹å™¨å¯åŠ¨æ—¶æ˜¯åœ¨ä¸€ä¸ªå¯ä»¥ä¿®æ”¹çš„æœ€é¡¶å±‚é•œåƒå±‚ä¸Šä¿å­˜ç€æ‰€æœ‰ä¿®æ”¹çš„å†…å®¹ï¼Œç„¶åé‡å¯å¤±æ•ˆ</p><p>å¯ç”¨<code>docker commit -a &quot;ä½œè€…&quot; -m &quot;æè¿°ä¿¡æ¯&quot; id æ–°çš„é•œåƒå:tag</code> æ¥å°†ä¿®æ”¹çš„å†…å®¹ä¿å­˜å½¢æˆä¸€ä¸ªæ–°çš„é•œåƒ</p><p>ç”¨<code>docker histiry id</code> æŸ¥çœ‹å†å²è®°å½•</p><p>ç”¨<code>docker diff id</code> æŸ¥çœ‹æ–‡ä»¶å˜åŠ¨</p><p>æ¯æ¬¡è°ƒç”¨<code>commit</code>éƒ½ä¼šä½¿é•œåƒæ–°å¢ä¸€ä¸ªæ–°çš„å­˜å‚¨å±‚,å“ªæ€•æ˜¯æ·»åŠ æ–‡ä»¶ååˆåˆ é™¤,è€Œæ¯ä¸€æ¬¡æ“ä½œéƒ½æ˜¯é»‘ç®±å¼æ“ä½œ,ä¸åˆ©äºç»´æŠ¤,æ‰€ä»¥æ„å»ºé•œåƒåº”è¯¥ç”¨<code>dockerfile</code>æ¥æ„å»º</p><h4 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h4><p>dockerfileæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶,åŒ…å«äº†æ„å»ºdockeré•œåƒçš„æŒ‡ä»¤,æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šå½¢æˆä¸€ä¸ªæ–°çš„é•œåƒå±‚</p><p><strong>FROM</strong> ç”¨äºæŒ‡å®šåŸºç¡€é•œåƒ</p><ul><li>åŸºç¡€é•œåƒå¯ä»¥æ˜¯ä¸€ä¸ªæœåŠ¡(mysql)ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿ(alpine ä¸€ä¸ªéå¸¸è½»é‡çš„linuxå‘è¡Œç‰ˆ,ä»…å 5MBå·¦å³)</li><li>ä¹Ÿå¯ä»¥ä¸æŒ‡å®šåŸºç¡€é•œåƒ,ç›´æ¥ä»äºŒè¿›åˆ¶æ–‡ä»¶å¼€å§‹ä½œä¸ºç¬¬ä¸€å±‚é•œåƒ,éœ€ç”¨åˆ°<code>FROM scratch</code>ï¼Œä»£è¡¨çš„æ˜¯ä¸€ä¸ªç©ºé•œåƒï¼Œç„¶åæ‰§è¡Œå‘½ä»¤</li></ul><p><strong>COPY</strong> å¤åˆ¶æ–‡ä»¶</p><ul><li>æ ¼å¼ä¸º <code>COPY æºåœ°å€ ç›®çš„åœ°å€</code> ï¼Œå¤åˆ¶å®Œæˆåä¼šå½¢æˆä¸€å±‚æ–°çš„é•œåƒå±‚ï¼Œç›¸å¯¹äºä¸€æ¡æŒ‡ä»¤å½¢æˆä¸€å±‚é•œåƒå±‚</li><li>å¤åˆ¶æ—¶é»˜è®¤ä¿ç•™æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå³æƒé™ã€æ—¶é—´ç­‰ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šç”¨æˆ·å’Œç”¨æˆ·ç»„ <code>COPY --chown=userï¼šgroup 123 123</code></li></ul><p><strong>RUN</strong> æ‰§è¡Œå‘½ä»¤<br>ä¸€å…±æœ‰ä¸¤ç§æ‰§è¡Œæ ¼å¼ï¼š</p><ul><li>shellï¼š <code>RUN echo $SHELL</code> åæ¥ä¸€æ¡shellè¯­å¥æˆ–ç”¨ <code>&amp;&amp;</code> æ‹¼æ¥çš„å¤šæ¡è¯­å¥ï¼ˆè¿™æ˜¯å› ä¸ºå¤šæ¡æŒ‡ä»¤ä¼šå¤šå½¢æˆæ–°çš„å±‚ï¼Œé•œåƒå±‚æœ‰æœ€å¤§å±‚æ•°é™åˆ¶ä¸”ä¸åˆ©äºç»´æŠ¤ï¼Œä¸ç¾è§‚ï¼‰</li><li>execï¼š <code>RUN [&quot;echo&quot;,&quot;$SHELL&quot;]</code> å‰é¢ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œåé¢ä¸ºå¯é€‰çš„å‚æ•°</li></ul><p><strong>CMD</strong> å®¹å™¨å¯åŠ¨å‘½ä»¤</p><ul><li>æ ¼å¼ä¸<code>RUN</code> ç±»ä¼¼</li><li>shellæ ¼å¼çš„å‘½ä»¤ä¼šè¢«è§£æä¸º<code>sh -c command</code>æ ¼å¼ï¼Œå®é™…ä¸º`RUN [â€œshâ€,â€-câ€,â€commandâ€],æ‰€ä»¥åœ¨å‘½ä»¤ä¸­å¯ç”¨ç¯å¢ƒå˜é‡</li><li>åœ¨è¿è¡Œå®¹å™¨æ—¶å¯æ‰‹åŠ¨è¦†ç›–<code>CMD</code>ï¼Œå¦‚<code>docker run -it test /bin/bsah</code>ï¼Œé•œåƒååæ¥çš„å‘½ä»¤å³æ˜¯è¦†ç›–åçš„å‘½ä»¤</li><li>éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå®¹å™¨æä¾›æœåŠ¡çš„åªæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œå®¹å™¨çš„1å·è¿›ç¨‹ä¸ºè‡ªå·±æŒ‡å®šçš„ç¨‹åºï¼Œæ‰€ä»¥å½“è¿›ç¨‹é€€å‡ºäº†å®¹å™¨éšå³æ¶ˆäº¡ï¼Œå®¹å™¨æ²¡æœ‰åå°æœåŠ¡çš„æ¦‚å¿µï¼Œå¦‚æœå°†<code>CMD</code>è®¾ç½®ä¸ºä¸€ä¸ªshellå‘½ä»¤ï¼Œé‚£ä¹ˆå°±æ˜¯æ‰§è¡Œå®Œå‘½ä»¤å®¹å™¨å°±é€€å‡ºäº†ï¼Œè¦è®©å®¹å™¨æŒç»­æä¾›æœåŠ¡ï¼Œ<code>CMD</code>åº”ä¸ºä¸€ä¸ªé•¿ä¹…çš„å‰å°å‘½ä»¤ï¼Œå¦‚<code>CMD [&quot;nginx&quot;,&quot;-g&quot;,&quot;daemon off&quot;]</code></li></ul><p><strong>ENTRYPOINT</strong> å…¥å£ç‚¹</p><ul><li>æ ¼å¼ä¸<code>CMD</code>ç›¸ä¼¼ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¯åŠ¨å‘½ä»¤</li><li>å½“<code>CMD</code>å’Œ<code>ENTRYPOINT</code>åŒæ—¶å‡ºç°æ—¶ï¼ˆä¸Šé¢è¯´é“ï¼Œï¼‰ï¼Œ<code>CMD</code>çš„æ„ä¹‰å°±å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸å†æ˜¯å®¹å™¨å¯åŠ¨å‘½ä»¤ï¼Œè€Œè¢«å½“ä½œ<code>ENTRYPOINT</code>æ‰€æŒ‡å®šçš„å‘½ä»¤çš„å‚æ•°</li><li>å’Œ<code>CMD</code>ä¸€æ ·å¯ä»¥è¢«è¦†ç›–ï¼Œ<code>docker run</code>ä½¿ç”¨<code>--entrypoint command</code> </li><li>[æœ‰ç‚¹ç»•&gt;&gt;&gt;&gt;ä¾‹å­]ï¼ˆ<a href="https://vuepress.mirror.docker-practice.com/image/dockerfile/entrypoint.htmlï¼‰" target="_blank" rel="noopener">https://vuepress.mirror.docker-practice.com/image/dockerfile/entrypoint.htmlï¼‰</a></li></ul><p><strong>ENV</strong> ç¯å¢ƒå˜é‡</p><ul><li><code>ENV key value</code> æˆ–è€… <code>ENV key=value</code></li><li>è®¾ç½®å®Œçš„å˜é‡åœ¨å…¶ä»–æŒ‡ä»¤é‡Œä¹Ÿå¯ä»¥ç”¨</li><li>åŒæ ·ä¹Ÿå¯ä»¥è¢«è¦†ç›–ï¼Œ<code>docker run</code> + <code>-e key=value</code></li></ul><p><strong>VOLUME</strong> å®šä¹‰åŒ¿åå·</p><ul><li>æ ¼å¼ä¸<code>CMD</code>ç±»ä¼¼ï¼Œ<code>VOLUME /PATH</code>æˆ–<code>VOLUME [&quot;PATH&quot;,&quot;PATH2&quot;]</code> </li><li>è¿™é‡Œçš„åŒ¿åå·å¯ä»¥å°†æ•°æ®åº“çš„æ•°æ®å­˜å‚¨ä¸‹æ¥ä¸è‡³äºä¸¢å¤±ï¼Œä½†ä¸ºäº†æ–¹ä¾¿ç®¡ç†è¿˜æ˜¯æ‰‹åŠ¨åˆ›å»ºå‘½åè‰¯å¥½çš„å·å†æŒ‚è½½ï¼Œ<code>docker run</code> + <code>-v volumenameï¼š/path</code></li></ul><p><strong>EXPOSE</strong> å£°æ˜ç«¯å£</p><ul><li>æ ¼å¼ç±»ä¼¼ä¸ä¸Šé¢</li><li>è¯¥æŒ‡ä»¤åªæ˜¯å£°æ˜ç«¯å£ï¼Œä¸ä¼šå®é™…å¼€å¯è¿™ä¸ªç«¯å£æä¾›æœåŠ¡ï¼Œä¸º<code>docker run</code>å‘½ä»¤ä¸­æŒ‡å®šäº†<code>-P</code> çš„å®¹å™¨ç«¯å£ï¼Œç„¶åæ˜ å°„ä¸ºéšæœºä¸»æœºç«¯å£</li></ul><p><strong>WORKDIR</strong> æŒ‡æ˜å·¥ä½œç›®å½•</p><ul><li>æ ¼å¼ <code>WORKDIR /PATH</code>ï¼Œè‹¥ç›®å½•ä¼šå­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</li><li>æ¯ä¸€å±‚é•œåƒå±‚éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹ç¯å¢ƒï¼Œä¸Šä¸€ä¸ªåˆ‡æ¢ç›®å½•çš„æŒ‡ä»¤ä¸ä¼šå½±å“åˆ°ä¸‹æ¡æŒ‡ä»¤ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šå·¥ä½œç›®å½•</li></ul><p><strong>USER</strong> æŒ‡å®šå½“å‰ç”¨æˆ·</p><ul><li>åŒä¸Š</li></ul><h1 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h1><p><del>å’•å’•å’•,å¾…æ›´æ–°</del></p><h3 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h3><p><a href="https://www.runoob.com/w3cnote/yaml-intro.html" target="_blank" rel="noopener">yamlå…¥é—¨</a></p><blockquote><p>åŸºæœ¬è¯­æ³•</p><ul><li>å¤§å°å†™æ•æ„Ÿ</li><li>ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</li><li>ç¼©è¿›ä¸å…è®¸ä½¿ç”¨tabï¼Œåªå…è®¸ç©ºæ ¼</li><li>ç¼©è¿›çš„ç©ºæ ¼æ•°ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦å¯¹é½å³å¯</li><li>â€˜#â€™è¡¨ç¤ºæ³¨é‡Š</li></ul></blockquote><p>YAML æ”¯æŒä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š</p><ul><li>å¯¹è±¡ï¼šé”®å€¼å¯¹çš„é›†åˆï¼Œåˆç§°ä¸ºæ˜ å°„ï¼ˆmappingï¼‰/ å“ˆå¸Œï¼ˆhashesï¼‰ / å­—å…¸ï¼ˆdictionaryï¼‰</li><li>æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ï¼Œåˆç§°ä¸ºåºåˆ—ï¼ˆsequenceï¼‰ / åˆ—è¡¨ï¼ˆlistï¼‰</li><li>æ ‡é‡ï¼ˆscalarsï¼‰ï¼šå•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼</li></ul><p>&amp; ç”¨æ¥å»ºç«‹é”šç‚¹ï¼ˆdefaultsï¼‰ï¼Œ&lt;&lt; è¡¨ç¤ºåˆå¹¶åˆ°å½“å‰æ•°æ®ï¼Œ* ç”¨æ¥å¼•ç”¨é”šç‚¹<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">defaults</span>: &amp;defaults</span><br><span class="line">  <span class="attribute">adapter</span>:  postgres</span><br><span class="line">  <span class="attribute">host</span>:     localhost</span><br><span class="line"></span><br><span class="line"><span class="attribute">development:</span></span><br><span class="line">  database: myapp_development</span><br><span class="line">  &lt;&lt;: *defaults</span><br><span class="line"></span><br><span class="line"><span class="attribute">test:</span></span><br><span class="line">  database: myapp_test</span><br><span class="line">  &lt;&lt;: *defaults</span><br></pre></td></tr></table></figure></p><ul><li><code>&lt;&lt;: *defaults</code> == <code>adapter: postgres \n host: localhost</code></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="docker" scheme="http://yoursite.com/tags/docker/"/>
    
      <category term="å®¹å™¨" scheme="http://yoursite.com/tags/%E5%AE%B9%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ufwé…ç½®é˜²ç«å¢™</title>
    <link href="http://yoursite.com/2020/04/06/%E4%BD%BF%E7%94%A8ufw%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99/"/>
    <id>http://yoursite.com/2020/04/06/%E4%BD%BF%E7%94%A8ufw%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99/</id>
    <published>2020-04-06T12:33:04.000Z</published>
    <updated>2020-04-25T02:22:04.664Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><blockquote><p>iptables æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå®ç”¨å·¥å…·ï¼Œç”¨äºé…ç½® Netfilter é¡¹ç›®ä¸­å®ç°çš„ Linux å†…æ ¸é˜²ç«å¢™ã€‚ æœ¯è¯­ iptables ä¹Ÿé€šå¸¸ç”¨æ¥æŒ‡è¿™ç§å†…æ ¸çº§åˆ«çš„é˜²ç«å¢™ã€‚ å®ƒå¯ä»¥ç›´æ¥ç”¨ iptables è¿›è¡Œé…ç½®ï¼Œæˆ–è€…ä½¿ç”¨è®¸å¤šæ§åˆ¶å°å’Œå›¾å½¢å‰ç«¯ä¹‹ä¸€è¿›è¡Œé…ç½®ã€‚</p></blockquote><p>è¿™æ¬¡è¦è®²åˆ°çš„ufwæ˜¯ Uncomplicated Firewall çš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªç®¡ç† netfilter é˜²ç«å¢™çš„ç¨‹åºã€‚ å®ƒæä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼Œç›®çš„æ˜¯ç®€å•æ˜“ç”¨</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>ä¸ºå‘½ä»¤è¡Œæ¨¡å¼<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pacman -S ufw</span></span><br></pre></td></tr></table></figure></p><p>ä¹Ÿæœ‰å›¾å½¢çš„<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pacman -S gufw</span></span><br></pre></td></tr></table></figure></p><h1 id="çŠ¶æ€æŸ¥è¯¢"><a href="#çŠ¶æ€æŸ¥è¯¢" class="headerlink" title="çŠ¶æ€æŸ¥è¯¢"></a>çŠ¶æ€æŸ¥è¯¢</h1><p>å¯ç”¨å®ƒ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw <span class="built_in">enable</span></span><br></pre></td></tr></table></figure></p><ul><li>è¿™æ ·å°±ä¼šå¼€æœºå¯åŠ¨äº†</li><li>æ³¨æ„ä¸èƒ½å’Œ<code>iptables.service</code>åŒæ—¶å¯ç”¨</li></ul><p>å…³é—­    <code>ufw disable</code></p><p>æŸ¥çœ‹çŠ¶æ€    <code>ufw status</code></p><p>æŸ¥çœ‹çŠ¶æ€ï¼Œè§„åˆ™ä»¥æ•°å­—æ ‡å·    <code>ufw status numbered</code></p><ul><li>åé¢åˆ é™¤è§„åˆ™å°±ä¼šç”¨åˆ°è§„åˆ™å·ç </li></ul><h1 id="è§„åˆ™è¯­æ³•"><a href="#è§„åˆ™è¯­æ³•" class="headerlink" title="è§„åˆ™è¯­æ³•"></a>è§„åˆ™è¯­æ³•</h1><h3 id="å…·ä½“çš„åœ°å€ç«¯å£"><a href="#å…·ä½“çš„åœ°å€ç«¯å£" class="headerlink" title="å…·ä½“çš„åœ°å€ç«¯å£"></a>å…·ä½“çš„åœ°å€ç«¯å£</h3><p>å…è®¸ä»»æ„æ¥æºä»»æ„åè®®æ”¾å¼€53ç«¯å£  <code>ufw allow 53</code></p><ul><li>ä¼šå¢åŠ ä¸¤æ¡è§„åˆ™ï¼Œåˆ†åˆ«å¯¹åº”v4ã€v6</li><li>åœ¨ç«¯å£å·åå¯æŒ‡å®šåè®®ï¼Œå¦‚<code>53/tcp</code></li></ul><p>è€Œå¯¹åº”å®Œæ•´ç‰ˆåº”ä¸º<code>æ¥æº/ç›®çš„+ç«¯å£</code>    </p><ul><li><code>ufw allow proto tcp from any to any port 53</code></li><li><code>ufw allow proto udp from any to any port 53</code></li></ul><p>å‰é¢çš„è¯­å¥é»˜è®¤æ˜¯æ”¾å¼€ã€æ‹’ç»åŒå‘è¿æ¥ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå•å‘</p><ul><li><code>ufw allow in 53</code></li><li><code>ufw allow out 53</code></li></ul><p>å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªç«¯å£    <code>ufw allow proto tcp from any to any port 80,443,8080:8090</code></p><ul><li>ä¸èƒ½å•ç‹¬åˆ é™¤ä¸€ä¸ªç«¯å£</li><li>ç«¯å£é—´ä¸èƒ½æ¥ç©ºæ ¼</li></ul><p>anyæŒ‡å¸¦çš„å³æ˜¯ç½‘ç»œå·ï¼Œä¹Ÿå¯ä»¥æ˜¯è®¾å¤‡</p><ul><li>å¦‚<code>ufw deny proto tcp from 10.0.0.0/8 to 192.168.0.1 port 53</code></li><li>æ‹’ç»æ¥è‡ª10.0.0.0/8åŸŸçš„tcpåè®®æŒ‡å‘192.168.0.1ç«¯å£53çš„æ•°æ®è¿›å…¥æœ¬æœº</li><li><code>ufw route allow in on eth1 out on eth2</code></li><li>å…è®¸ç»eth1è¿›å…¥ï¼Œeth2å‘å‡ºçš„æ•°æ®ç»æœ¬æœºè·¯ç”±</li></ul><p>åˆ é™¤è§„åˆ™    <code>ufw delete allow 53</code></p><ul><li>æˆ–è€…é€šè¿‡è§„åˆ™åºå·åˆ é™¤  <code>ufw delete num</code></li></ul><h3 id="app-profiles"><a href="#app-profiles" class="headerlink" title="app profiles"></a>app profiles</h3><p>é»˜è®¤è‡ªå¸¦appé…ç½®åœ¨<code>/etc/ufw/applications.d/</code></p><ul><li>æˆ–é€šè¿‡<code>ufw app list</code>æŸ¥çœ‹åå­—ï¼Œå†<code>ufw app info name</code><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ufw app <span class="builtin-name">info</span> WWW</span><br><span class="line"></span><br><span class="line">&gt;</span><br><span class="line">Profile: WWW</span><br><span class="line">Title: Web Server</span><br><span class="line">Description: Web server</span><br><span class="line"></span><br><span class="line">Port:</span><br><span class="line">80/tcp</span><br></pre></td></tr></table></figure></li></ul><p>æ·»åŠ åˆ é™¤è§„åˆ™ç›´æ¥ç”¨appåå­—æ¥è¿›è¡Œ</p><ul><li>æ·»åŠ   <code>ufw allow WWW</code></li><li>åˆ é™¤  <code>ufw delete allow WWW</code></li></ul><p>æ·»åŠ ä¸€ä¸ªæ–°çš„appé…ç½®<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ufw/applications.d/ufw-kde-connect</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é”®å­—å…¨éƒ¨åŠ ä¸Šç¼ºä¸€ä¸å¯</span></span><br><span class="line">[kde-connect]   <span class="comment">#appé…ç½®å</span></span><br><span class="line">title=kde-connect</span><br><span class="line">description=kde-connect</span><br><span class="line">ports=1716  <span class="comment">#è§„åˆ™</span></span><br></pre></td></tr></table></figure></p><ul><li>æ›´æ–°ä½¿å…¶ç”Ÿæ•ˆ  <code>ufw app update kde-connect</code></li><li>è¿™æ ·é€šè¿‡appåç®¡ç†æ›´åŠ ç›´è§‚</li></ul><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><p>åœ¨æµ‹è¯•æ—¶å‘ç°é€šè¿‡dockeræš´éœ²å‡ºæ¥çš„ç«¯å£ä¸å—ufwæ§åˆ¶</p><ul><li><a href="https://blog.csdn.net/sinat_33384251/article/details/94409846" target="_blank" rel="noopener">è§£å†³æ–¹æ¡ˆ</a></li></ul><hr><p>ref:<br><a href="https://wiki.manjaro.org/index.php?title=Firewalls" target="_blank" rel="noopener">https://wiki.manjaro.org/index.php?title=Firewalls</a><br><a href="https://wiki.ubuntu.org.cn/Ufw%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97" target="_blank" rel="noopener">https://wiki.ubuntu.org.cn/Ufw%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97</a></p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="ufw" scheme="http://yoursite.com/tags/ufw/"/>
    
      <category term="iptables" scheme="http://yoursite.com/tags/iptables/"/>
    
  </entry>
  
  <entry>
    <title>linux å‘½ä»¤æ‚è®°</title>
    <link href="http://yoursite.com/2020/04/01/linux-%E5%91%BD%E4%BB%A4%E6%9D%82%E8%AE%B0/"/>
    <id>http://yoursite.com/2020/04/01/linux-%E5%91%BD%E4%BB%A4%E6%9D%82%E8%AE%B0/</id>
    <published>2020-04-01T14:48:57.000Z</published>
    <updated>2020-04-25T02:22:04.664Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h1><p>æ ¹æ®æŸä¸ªå­—ç¬¦ä¸²ï¼ŒæŸ¥è¯¢è¯¥å­—ç¬¦ä¸²å‰åæ–‡æœ¬ä¿¡æ¯å‘½ä»¤ï¼šgrep-A|B nâ€keyâ€file</p><p>å…¶ä¸­ï¼š<br>    Aï¼šè¡¨ç¤ºåœ¨å­—ç¬¦ä¸²ä¹‹å after  context<br>    Bï¼šè¡¨ç¤ºåœ¨å­—ç¬¦ä¸²ä¹‹å‰ before context<br>    nï¼šè¦è·å–å¤šå°‘è¡Œæ–‡æœ¬ line number</p><p>å®ä¾‹ï¼šgrep -A 100 -B 100 -i â€˜111â€™ catalina.out</p><ul><li>-iè¡¨ç¤ºå¿½ç•¥å¤§å°å†™ã€‚</li></ul><p>å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è·å–å¼‚å¸¸æ—¥å¿—çš„å‰10è¡Œå’Œå10è¡Œï¼Œä¸ç”¨åŠ -Aå’Œ-Bï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°±å¯ä»¥äº†ï¼š</p><ul><li>å®ä¾‹ï¼šgrep -10 -i â€˜111â€™ catalina.out</li></ul><h1 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h1><p>mke2fs -t ext4 /dev/name</p><p>mkfs<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkfs           mkfs<span class="selector-class">.cramfs</span>    mkfs<span class="selector-class">.ext3</span>      mkfs<span class="selector-class">.hfs</span>       mkfs<span class="selector-class">.minix</span>     mkfs.reiserfs</span><br><span class="line">mkfs<span class="selector-class">.bfs</span>       mkfs<span class="selector-class">.exfat</span>     mkfs<span class="selector-class">.ext4</span>      mkfs<span class="selector-class">.hfsplus</span>   mkfs<span class="selector-class">.msdos</span>     mkfs<span class="selector-class">.vfat</span>    </span><br><span class="line">mkfs<span class="selector-class">.btrfs</span>     mkfs<span class="selector-class">.ext2</span>      mkfs<span class="selector-class">.fat</span>       mkfs<span class="selector-class">.jfs</span>       mkfs<span class="selector-class">.ntfs</span>      mkfs.xfs</span><br></pre></td></tr></table></figure></p><h3 id="å¤‡ä»½æ•°æ®"><a href="#å¤‡ä»½æ•°æ®" class="headerlink" title="å¤‡ä»½æ•°æ®"></a>å¤‡ä»½æ•°æ®</h3><p>rsync </p><blockquote><p>  Transfer files either to or from a remote host (not between two remote hosts).<br>  Can transfer single files, or multiple files matching a pattern.</p><ul><li>å¯ç”¨æ¥è½¬ç§»æ•°æ®,ä¼ è¾“æ–‡ä»¶</li></ul></blockquote><p><code>rsync -av</code>åŸåœ°å€ ç›®çš„åœ°å€</p><ul><li>aåŒ…å«æ–‡ä»¶æ‰€æœ‰ä¿¡æ¯(This is equivalent to -rlptgoD),å¦‚åŸæœ¬æƒé™,ä¿®æ”¹æ—¶é—´,å­ç›®å½•ç­‰ç­‰</li><li>vä¸ºæ˜¾ç¤ºä¼ è¾“è¿‡ç¨‹,Pä¸ºæ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯è¾“å‡º</li></ul><p>æ—¢å¯ä»¥æ‹‰å–æ•°æ®,ä¹Ÿå¯ä»¥å‘é€æ•°æ®<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Pull</span>: <span class="selector-tag">rsync</span> <span class="selector-attr">[OPTION...]</span> <span class="selector-attr">[USER@]</span><span class="selector-tag">HOST</span><span class="selector-pseudo">:SRC...</span> <span class="selector-attr">[DEST]</span></span><br><span class="line"><span class="selector-tag">Push</span>: <span class="selector-tag">rsync</span> <span class="selector-attr">[OPTION...]</span> <span class="selector-tag">SRC</span>... <span class="selector-attr">[USER@]</span><span class="selector-tag">HOST</span><span class="selector-pseudo">:DEST</span></span><br></pre></td></tr></table></figure></p><h3 id="åˆ†åŒº"><a href="#åˆ†åŒº" class="headerlink" title="åˆ†åŒº"></a>åˆ†åŒº</h3><p>æŸ¥çœ‹åˆ†åŒºä¿¡æ¯<br><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">fdisk</span> <span class="string">-l</span></span><br><span class="line"></span><br><span class="line"><span class="attr">df</span> <span class="string">-h</span></span><br></pre></td></tr></table></figure></p><p>å…·ä½“åˆ†åŒºæ“ä½œ<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/è®¾å¤‡å</span><br><span class="line"></span><br><span class="line"><span class="symbol">:p</span>  æŸ¥çœ‹è®¾å¤‡åˆ†åŒºæƒ…å†µ</span><br><span class="line"><span class="symbol">:F</span>  æŸ¥çœ‹è®¾å¤‡æœªåˆ†åŒºçš„å—</span><br><span class="line"><span class="symbol">:d</span>  åˆ é™¤ä¸€ä¸ªåˆ†åŒº</span><br><span class="line"><span class="symbol">:n</span>  å»ºç«‹ä¸€ä¸ªåˆ†åŒº</span><br></pre></td></tr></table></figure></p><ul><li>åˆ›å»ºå®Œåˆ†åŒºè®°å¾—åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ</li></ul><h3 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h3><p>resize2fs   /dev/mapper/cl00-root  </p><h3 id="swap"><a href="#swap" class="headerlink" title="swap"></a>swap</h3><p><a href="https://www.cnblogs.com/FengGeBlog/p/10239067.html" target="_blank" rel="noopener">https://www.cnblogs.com/FengGeBlog/p/10239067.html</a></p><h3 id="æŒ‚è½½"><a href="#æŒ‚è½½" class="headerlink" title="æŒ‚è½½"></a>æŒ‚è½½</h3><p>å¼€æœºè‡ªåŠ¨æŒ‚è½½éœ€ä¿®æ”¹<code>/etc/fstab</code></p><h3 id="uuid"><a href="#uuid" class="headerlink" title="uuid"></a>uuid</h3><p>blkid /dev/name</p><h1 id="grub"><a href="#grub" class="headerlink" title="grub"></a>grub</h1><p>quit ä¸ºç®€å•è¾“å‡º<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GRUB_CMDLINE_LINUX_DEFAULT</span>=<span class="string">"quiet splash"</span></span><br></pre></td></tr></table></figure></p><ul><li>ä¸ºé»˜è®¤å¯åŠ¨å†…æ ¸å‚æ•°,ä¸€ç›´æœ‰æ•ˆ(åŒ…æ‹¬æ•‘æ´æ¨¡å¼)</li><li>splash ä¸ºæ˜¾ç¤ºlinuxå‘è¡Œç‰ˆlogo</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GRUB_CMDLINE_LINUX</span>=</span><br></pre></td></tr></table></figure><ul><li>ä¸ºæ•‘æ´æ¨¡å¼çš„å¯åŠ¨å‚æ•°</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/etc/</span><span class="keyword">default</span>/grub</span><br><span class="line">update-grub</span><br></pre></td></tr></table></figure><p>æˆ–åœ¨å¼€æœºå‡ºç°logoå‰æŒ‰ESCå†æŒ‰eå¯ä¿®æ”¹å¯åŠ¨å‚æ•°(æœ¬æ¬¡å¯åŠ¨æœ‰æ•ˆ)</p><h1 id="brightness"><a href="#brightness" class="headerlink" title="brightness"></a>brightness</h1><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo </span><span class="string">systemctl </span><span class="built_in">list-units</span> | <span class="string">grep </span><span class="string">backlight</span></span><br></pre></td></tr></table></figure><ul><li>å‘ç°ä¸€ä¸ªå¯åŠ¨å¤±è´¥,å¯èƒ½æ˜¯å‘ç”Ÿäº†å†²çª</li></ul><p>ç¦ç”¨å…¶ä¸€<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl mask systemd-backlight<span class="meta">@backlight</span>:acpi_video0.service </span><br><span class="line">Created symlink <span class="regexp">/etc/</span>systemd<span class="regexp">/system/</span>systemd-backlight<span class="meta">@backlight</span>:acpi_video0.service â†’ <span class="regexp">/dev/</span></span><br><span class="line"><span class="literal">null</span>.</span><br></pre></td></tr></table></figure></p><p>é‡å¯å¦å¤–ä¸€ä¸ª<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart systemd-backlight<span class="variable">@backlight</span><span class="symbol">:nvidia_0</span>.service</span><br></pre></td></tr></table></figure></p><ul><li>é‡å¯æœºå™¨å‘ç°äº®åº¦å·²ç»å¯ä»¥æ­£å¸¸æ¢å¤</li></ul><h1 id="å¯åŠ¨æ—¶é—´"><a href="#å¯åŠ¨æ—¶é—´" class="headerlink" title="å¯åŠ¨æ—¶é—´"></a>å¯åŠ¨æ—¶é—´</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemd-<span class="keyword">analyze</span>  </span><br><span class="line"></span><br><span class="line">systemd-<span class="keyword">analyze</span> blame</span><br><span class="line"></span><br><span class="line">systemd-<span class="keyword">analyze</span> <span class="keyword">critical</span>-<span class="keyword">chain</span></span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥æ ¹æ®ä»¥ä¸Šå‘½ä»¤è¾“å‡ºå…³é—­ä¸€äº›ä¸å¸¸ç”¨æœåŠ¡ä»¥åŠ é€Ÿå¼€æœº `systemctl mask(disable)</li><li>æœ‰äº›æœåŠ¡éœ€è¦ç”¨ä½†å°±æ˜¯æ…¢å¯ä»¥å°è¯•æ‰‹åŠ¨ä¿®æ”¹ <code>æœåŠ¡å.service</code>æ–‡ä»¶,å°†å…¶åŠ ä¸Š<code>After = graphical.target</code>,ä¹Ÿå°±æ˜¯åœ¨å…ˆç­‰æ¡Œé¢åŠ è½½ç©å†åŠ è½½æœåŠ¡</li></ul><h1 id="zabbix"><a href="#zabbix" class="headerlink" title="zabbix"></a>zabbix</h1><h3 id="NATè½¬æ¢"><a href="#NATè½¬æ¢" class="headerlink" title="NATè½¬æ¢"></a>NATè½¬æ¢</h3><p>åœ¨è™šæ‹Ÿæœºä¸Šéƒ¨ç½²zabbixæ—¶,è™šæ‹Ÿæœºä½¿ç”¨äº†NATç½‘æ¡¥,<code>telnet</code>èƒ½é€š,å½“serverä¸€ç›´è¿ä¸ä¸Š</p><ul><li>æœ€ååœ¨agenté…ç½®æ–‡ä»¶ä¸Šserverçš„åœ°å€åŠ ä¸Šç½‘å…³åœ°å€<br><a href="https://sysadmin.xyz/main/2018/01/08/zabbix-nat-problem/" target="_blank" rel="noopener">https://sysadmin.xyz/main/2018/01/08/zabbix-nat-problem/</a></li></ul><h3 id="snmp"><a href="#snmp" class="headerlink" title="snmp"></a>snmp</h3><p>å®‰è£…ä½¿ç”¨</p><ul><li><a href="http://www.net-snmp.org/wiki/index.php/Tutorials" target="_blank" rel="noopener">http://www.net-snmp.org/wiki/index.php/Tutorials</a></li><li><a href="https://blog.csdn.net/bbwangj/article/details/80981098" target="_blank" rel="noopener">https://blog.csdn.net/bbwangj/article/details/80981098</a></li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.1.1 161<span class="built_in"> Connection </span>refused</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç”¨udpæ‰«æç«¯å£161</span></span><br><span class="line">nmap -sU 192.168.1.1 -p161</span><br></pre></td></tr></table></figure><h1 id="lolå®‰è£…"><a href="#lolå®‰è£…" class="headerlink" title="lolå®‰è£…"></a>lolå®‰è£…</h1><p><a href="https://www.reddit.com/r/leagueoflinux/comments/alfbep/league_on_linux_mint_19/" target="_blank" rel="noopener">https://www.reddit.com/r/leagueoflinux/comments/alfbep/league_on_linux_mint_19/</a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt <span class="keyword">install</span> snapd</span><br><span class="line"></span><br><span class="line">snap <span class="keyword">install</span> leagueoflegends <span class="comment">--edge --devmode</span></span><br></pre></td></tr></table></figure><ul><li><p>å¾ˆç®€å•ç²—æš´,æ²¡æœ‰å›½æœ</p></li><li><p>Please consider using the Nouveau driver instead.<br><a href="https://askubuntu.com/questions/267936/how-do-i-get-rid-of-broken-nvidia-randr-detected-falling-back-to-randr-1-0" target="_blank" rel="noopener">https://askubuntu.com/questions/267936/how-do-i-get-rid-of-broken-nvidia-randr-detected-falling-back-to-randr-1-0</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="linxu" scheme="http://yoursite.com/tags/linxu/"/>
    
  </entry>
  
  <entry>
    <title>zabbixæŠ˜è…¾è®°-å®‰è£…ç¯‡</title>
    <link href="http://yoursite.com/2020/03/26/zabbix%E6%8A%98%E8%85%BE%E8%AE%B0/"/>
    <id>http://yoursite.com/2020/03/26/zabbix%E6%8A%98%E8%85%BE%E8%AE%B0/</id>
    <published>2020-03-26T12:51:08.000Z</published>
    <updated>2020-04-25T02:22:04.664Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="æºç å®‰è£…"><a href="#æºç å®‰è£…" class="headerlink" title="æºç å®‰è£…"></a>æºç å®‰è£…</h1><p>è¦æƒ³æœåŠ¡è·‘èµ·æ¥çœ‹å¾—è§,å°±å¾—å®‰è£…è‡ªèº«æœåŠ¡ç«¯,MySQL,å‰ç«¯</p><h3 id="æœåŠ¡ç«¯å®‰è£…"><a href="#æœåŠ¡ç«¯å®‰è£…" class="headerlink" title="æœåŠ¡ç«¯å®‰è£…"></a>æœåŠ¡ç«¯å®‰è£…</h3><p><a href="https://www.zabbix.com/documentation/current/manual/installation/install" target="_blank" rel="noopener">æ·»åŠ ç”¨æˆ·ç»„</a><br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">addgroup --system --quiet zabbix</span><br><span class="line">adduser --quiet --system --disabled-login --ingroup zabbix --home /var/<span class="class"><span class="keyword">lib</span>/<span class="title">zabbix</span> --<span class="title">no</span>-<span class="title">create</span>-<span class="title">home</span> <span class="title">zabbix</span></span></span><br></pre></td></tr></table></figure></p><p><a href="https://www.zabbix.com/cn/download_sources#tab:40LTS" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a><br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ç¼–è¯‘çš„ä¸€äº›åŠŸèƒ½é€‰é¡¹</span></span><br><span class="line"><span class="string">./configure</span> <span class="params">--help</span></span><br><span class="line"></span><br><span class="line"><span class="string">./configure</span> <span class="params">--prefix=/usr/local/zabbix</span> <span class="params">--enable-server</span> <span class="params">--enable-agent</span> <span class="params">--enable-java</span> </span><br><span class="line"><span class="params">--with-mysql</span> <span class="params">--with-libxml2</span> <span class="params">--with-unixodbc</span> <span class="params">--with-net-snmp</span> <span class="params">--with-ssh2</span>  <span class="params">--with-libcurl</span> <span class="params">--with-iconv</span></span><br><span class="line"></span><br><span class="line">make install</span><br></pre></td></tr></table></figure></p><h5 id="ä¾èµ–é—®é¢˜"><a href="#ä¾èµ–é—®é¢˜" class="headerlink" title="ä¾èµ–é—®é¢˜"></a>ä¾èµ–é—®é¢˜</h5><ul><li>MySQL library not found <code>sudo apt install libmysqlclient-dev</code></li><li>unixODBC <code>sudo apt install unixodbc-dev</code></li><li>configure error: Invalid Net-SNMP directory - unable to find net-snmp-config <code>sudo apt install libsnmp-dev</code></li><li>error: SSH2 library not found  <code>sudo apt install libssh2-1-dev</code></li><li>Unable to find â€œjavacâ€ executable in path <code>sudo apt install openjdk-11-jdk</code></li></ul><p>ç»è¿‡å¤§é‡æœç´¢è²Œä¼¼æ‰¾åˆ°äº†è§£å†³ä¾èµ–çš„ä¸€ä¸ªå¥½åŠæ³•</p><ul><li><code>apt search &#39;*è½¯ä»¶å*&#39;</code></li><li>ä¸€èˆ¬å®‰è£…é‚£ä¸ªå¸¦<code>-dev</code>çš„å°±OKäº† </li></ul><h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆè‡ªå¸¦è½¯ä»¶æºå®‰è£…çš„mysqlã€httpdã€nginxéƒ½ç”¨ä¸äº†ï¼Œå¯èƒ½æ˜¯å› ä¸ºç”¨ç€ubuntuçš„æºï¼Œè€Œissueé‡Œå†™çš„æ˜¯mintæ²¡ç›´æ¥å†™ä¸ŠåŸºäºubuntuäº† â”‘(ï¿£Ğ” ï¿£)â”</p><p>è¿™é‡Œè¿˜æ˜¯ç›´æ¥ç”¨äº†docker<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> -id -name mysql -p3306:3306 -e  <span class="attribute">MYSQL_ROOT_PASSWORD</span>=111111 mysql</span><br></pre></td></tr></table></figure></p><ul><li>ä¸åŠ MYSQL_ROOT_PASSWORD=111111 çš„è¯å®¹å™¨éƒ½ä¸ä¼šå¼€å¯</li></ul><p><a href="https://www.zabbix.com/documentation/current/manual/appendix/install/db_scripts" target="_blank" rel="noopener">åˆ›å»ºæ•°æ®åº“</a><br><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql -uroot -p&lt;<span class="keyword">password</span>&gt;</span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">database</span> zabbix <span class="type">character</span> <span class="keyword">set</span> utf8 <span class="keyword">collate</span> utf8_bin;</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">user</span> <span class="string">'zabbix'</span>@<span class="string">'%'</span> identified <span class="keyword">by</span> <span class="string">'&lt;password&gt;'</span>;</span><br><span class="line">mysql&gt; <span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> <span class="string">'zabbix'</span>@<span class="string">'%'</span>;#éœ€è¦åŠ ä¸Šè¿™æ¡æˆæƒå‚è€ƒä¸‹é¢ç¬¬ä¸€ä¸ªé”™è¯¯</span><br><span class="line"></span><br><span class="line">shell&gt; cd <span class="keyword">database</span>/mysql</span><br><span class="line">shell&gt; mysql -uzabbix -p&lt;<span class="keyword">password</span>&gt; zabbix &lt; <span class="keyword">schema</span>.<span class="keyword">sql</span></span><br><span class="line"># stop here <span class="keyword">if</span> you are creating <span class="keyword">database</span> <span class="keyword">for</span> Zabbix proxy</span><br><span class="line">shell&gt; mysql -uzabbix -p&lt;<span class="keyword">password</span>&gt; zabbix &lt; images.<span class="keyword">sql</span></span><br><span class="line">shell&gt; mysql -uzabbix -p&lt;<span class="keyword">password</span>&gt; zabbix &lt; data.<span class="keyword">sql</span></span><br></pre></td></tr></table></figure></p><ul><li><a href="https://www.cnblogs.com/B1ackWall/p/11643136.html" target="_blank" rel="noopener">ERROR 1410 (42000): You are not allowed to create a user with GRANT</a></li></ul><ul><li><a href="https://stackoverflow.com/questions/10299148/mysql-error-1045-28000-access-denied-for-user-billlocalhost-using-passw" target="_blank" rel="noopener">MySQL ERROR 1045 (28000): Access denied for user â€˜billâ€˜@â€™localhostâ€™ (using password: YES)</a></li></ul><ul><li>[Error connecting to database: The server requested authentication method unknow]<br>(<a href="https://learnku.com/articles/10736/some-craters-in-mysql-8011" target="_blank" rel="noopener">https://learnku.com/articles/10736/some-craters-in-mysql-8011</a>)</li></ul><h2 id="php"><a href="#php" class="headerlink" title="php"></a>php</h2><p>å‰ç«¯æ‹¿phpå†™çš„,æ•…éœ€è¦å®‰è£…php<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install php7<span class="number">.2</span>-fpm</span><br></pre></td></tr></table></figure></p><p>éœ€è¦ä¿®æ”¹é»˜è®¤é…ç½®æ–‡ä»¶ä»¥æ»¡è¶³zabbixéœ€æ±‚<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/php/7.2/fpm/php.ini </span><br><span class="line"></span><br><span class="line">max_execution_time = 300 <span class="comment">##368è¡Œï¼ˆæ‰§è¡Œæ—¶é—´ï¼‰</span></span><br><span class="line">max_input_time = 300 <span class="comment">##378è¡Œï¼ˆæ¥æ”¶æ•°æ®ç­‰å¾…æ—¶é—´ï¼‰</span></span><br><span class="line">memory_limit = 128M <span class="comment">##389è¡Œï¼ˆæ¯ä¸ªè„šæœ¬å ç”¨å†…å­˜ï¼‰</span></span><br><span class="line">post_max_size = 16M <span class="comment">##656è¡Œï¼ˆPOSTæ•°æ®å¤§å°ï¼‰</span></span><br><span class="line">upload_max_filesize = 2M <span class="comment">##799è¡Œï¼ˆä¸‹è½½æ–‡ä»¶å¤§å°ï¼‰</span></span><br><span class="line">always_populate_raw_post_data = -1 <span class="comment">##800è¡Œ</span></span><br><span class="line">date.timezone = Asia/Shanghai <span class="comment">##877è¡Œï¼ˆæ—¶åŒº</span></span><br></pre></td></tr></table></figure></p><ul><li>ä¸æ”¹çš„è¯,åé¢ä¹Ÿä¸ä¼šæˆåŠŸ</li></ul><h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><p><a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">ä¸‹è½½</a></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">make <span class="keyword">install</span></span><br></pre></td></tr></table></figure><ul><li><del>é…ç½®ä¸å¤ªç†Ÿè¿˜éœ€ä»”ç»†ç ”ç©¶</del></li></ul><p>é‡åˆ°çš„ä¸€ä¸ªé”™è¯¯<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[error]</span> <span class="number">16119</span>#<span class="number">0</span>: *<span class="number">75</span> FastCGI sent in stderr: <span class="string">"Primary script unknown"</span> </span><br><span class="line">while reading response header from upstream, client: <span class="number">127.0.0.1</span>, server: localhost, request:</span><br><span class="line"> <span class="string">"<span class="keyword">GET</span> / HTTP/1.1"</span>, upstream: <span class="string">"fastcgi://unix:/run/php/php7.2-fpm.sock:"</span>, host: <span class="string">"127.0.0.1"</span></span><br></pre></td></tr></table></figure></p><ul><li>å‚è€ƒ<a href="https://serverfault.com/questions/517190/nginx-1-fastcgi-sent-in-stderr-primary-script-unknown" target="_blank" rel="noopener">è¿™é‡Œ</a> . çŠ¯äº†ä¸¤ä¸ªé”™è¯¯ :</li></ul><ol><li><code>/etc/php/7.2/fpm/pool.d/www.conf</code>   é‡Œè®¾ç½®çš„ç”¨æˆ·åå’Œç”¨æˆ·ç»„ä¸ngnixè¿è¡Œçš„ä¸ä¸€è‡´</li><li>å¤åˆ¶phpå‰ç«¯æ–‡ä»¶æ—¶ç”¨çš„æ˜¯root</li></ol><p>é™„ä¸Šç®€å•ä¸‘é™‹çš„é…ç½®<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">     listen       80;</span><br><span class="line">     server_name  localhost;</span><br><span class="line">     index index.php;</span><br><span class="line">     root /<span class="keyword">var</span>/www/php/;</span><br><span class="line"></span><br><span class="line">     location ~* \.php$ &#123;</span><br><span class="line">         <span class="keyword">include</span> fastcgi_params;</span><br><span class="line">         fastcgi_index  index.php;</span><br><span class="line">                     <span class="keyword">include</span>      fastcgi_params;</span><br><span class="line">         <span class="keyword">set</span> <span class="variable">$path_info</span> <span class="string">""</span>; </span><br><span class="line">         <span class="keyword">set</span> <span class="variable">$real_script_name</span> <span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">         <span class="keyword">if</span> (<span class="variable">$fastcgi_script_name</span> ~ <span class="string">"^(.+?\.php)(/.+)$"</span>) &#123;</span><br><span class="line">                 <span class="keyword">set</span> <span class="variable">$real_script_name</span> <span class="variable">$1</span>; </span><br><span class="line">                 <span class="keyword">set</span> <span class="variable">$path_info</span> <span class="variable">$2</span>; </span><br><span class="line">         &#125;</span><br><span class="line">         fastcgi_param SCRIPT_FILENAME /<span class="keyword">var</span>/www/php/<span class="variable">$real_script_name</span>;</span><br><span class="line">         fastcgi_param SCRIPT_NAME <span class="variable">$real_script_name</span>;</span><br><span class="line">         fastcgi_param PATH_INFO <span class="variable">$path_info</span>;</span><br><span class="line"></span><br><span class="line">         <span class="comment">//è¿™é‡Œé»˜è®¤æ˜¯127.0.0.1:9000;</span></span><br><span class="line">         <span class="comment">//éœ€è¦åˆ°/etc/php/7.2/fpm/pool.d/www.confæŸ¥çœ‹ç›‘å¬çš„åœ°å€</span></span><br><span class="line">         fastcgi_pass unix:/<span class="keyword">run</span>/php/php7.2-fpm.sock;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>æŸ¥çœ‹erroræ—¥å¿—å¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜</li></ul><h1 id="docker-install"><a href="#docker-install" class="headerlink" title="docker install"></a>docker install</h1><p><a href="https://www.zabbix.com/documentation/current/manual/installation/containers" target="_blank" rel="noopener">æºè‡ªè¿™é‡Œ</a><br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># docker run --name zabbix-appliance -t \</span><br><span class="line">      -<span class="ruby">p <span class="number">10051</span><span class="symbol">:</span><span class="number">10051</span> \</span></span><br><span class="line"><span class="ruby">      -p <span class="number">80</span><span class="symbol">:</span><span class="number">80</span> \</span></span><br><span class="line"><span class="ruby">      --restart <span class="keyword">unless</span>-stopped \</span></span><br><span class="line"><span class="ruby">      -d zabbix/zabbix-<span class="symbol">appliance:</span>latest</span></span><br></pre></td></tr></table></figure></p><ul><li>å¼€ç®±å¯ç”¨,ååˆ†æ–¹ä¾¿</li></ul><h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>éƒ½å®‰è£…å¥½ä¹‹å,éœ€è¦æ£€æŸ¥/etc/zabbix/zabbix_server.confé‡Œçš„æ•°æ®åº“è´¦å·åå¯†ç åœ°å€æ˜¯å¦æ­£ç¡®</p><p>éœ€è¦æ£€æŸ¥/etc/zabbix/zabbix_agent.confé‡Œserveråå­—åœ°å€æ˜¯å¦æ­£ç¡®</p><p>çœŸé¦™<img src="/images/20200326=0.png" alt></p><p>å¤ªé¦™äº†<img src="/images/20200326=1.png" alt></p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="å·¥å…·" scheme="http://yoursite.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="zabbix" scheme="http://yoursite.com/tags/zabbix/"/>
    
      <category term="ç›‘æ§" scheme="http://yoursite.com/tags/%E7%9B%91%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title>flatpakå…¥é—¨æŒ‡å—</title>
    <link href="http://yoursite.com/2020/03/10/flatpak%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/"/>
    <id>http://yoursite.com/2020/03/10/flatpak%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/</id>
    <published>2020-03-10T13:48:18.000Z</published>
    <updated>2020-04-25T02:22:04.661Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><p>ä¹‹æ‰€ä»¥ä¼šç”¨åˆ°<code>flatpak</code>ä¸»è¦æ˜¯çªç„¶æƒ³å­¦å­¦GTK,åˆšå¥½æœ‰ä¸ªäº²ç”Ÿçš„IDE<code>gnome-builder</code>,å®‰è£…æœ‰ç‚¹å°å‘</p><h1 id="flatpak"><a href="#flatpak" class="headerlink" title="flatpak"></a>flatpak</h1><blockquote><p><a href="https://docs.flatpak.org/en/latest/introduction.html" target="_blank" rel="noopener">Flatpak</a> is a framework for distributing desktop applications on Linux. It has been created by developers who have a long history of working on the Linux desktop, and is run as an independent open source project.</p></blockquote><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>å‡ ä¸ªæ¦‚å¿µéœ€è¦äº†è§£ä¸€ä¸‹<br><img src="/images/20200310=0.png" alt></p><ul><li>æœ€åº•å±‚çš„æ˜¯æˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿ,å¾€ä¸Šæ˜¯ç”±ä¸åŒçš„ä»“åº“æ‰€æä¾›çš„runtime,ä¹Ÿå°±æ˜¯æ‰“åŒ…å¥½çš„ä¾èµ–é¡¹åŠ ä¸Šè½¯ä»¶,è¿™æ ·å°±èƒ½åšåˆ°å®‰è£…å³ä½¿ç”¨,ä¸ä¾èµ–å…·ä½“çš„å‘è¡Œç‰ˆ,è¿™ä¸ªæ¦‚å¿µç±»ä¼¼ä¸<code>snap</code>å’Œ<code>.appimage</code>äº†</li><li>ä»“åº“å°±ç±»ä¼¼ä¸gité‡Œçš„è¿œç¨‹ä»“åº“,è‡ªå¸¦ç‰ˆæœ¬æ§åˆ¶,å¯è‡ªç”±å‡çº§é™çº§</li><li>å¯¹äºå®‰è£…çš„åº”ç”¨æœ¬èº«æ˜¯è¿è¡Œåœ¨åº”ç”¨ç‹¬å çš„æ²™ç›’é‡Œçš„,å¾ˆå¥½çš„åšåˆ°äº†æƒé™çš„åˆ†ç¦»,ä¹Ÿç”¨ä¸ç€<code>sudo apt *</code>ä¸€æŠŠå—¦äº†</li></ul><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>åœ¨mint19.2 ä¸Šå·²ç»è‡ªå¸¦å®‰è£…äº†ï¼Œä½†é»˜è®¤æ˜¯ä¸å¯ç”¨çš„<a href="https://flatpak.org/setup/" target="_blank" rel="noopener">setup</a></p><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><p>æŸ¥çœ‹å½“å‰ä»“åº“æƒ…å†µ<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flatpak remotes</span></span><br></pre></td></tr></table></figure></p><p>æ·»åŠ ä¸€ä¸ªæ–°çš„ä»“åº“<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flatpak remote-<span class="built_in">add</span> --<span class="keyword">if</span>-not-<span class="built_in">exists</span> flathub http<span class="variable">s:</span>//<span class="keyword">dl</span>.flathub.org/repo/flathub.flatpakrepo</span><br></pre></td></tr></table></figure></p><ul><li>è¯­æ³•ä¹Ÿä¸gitç›¸ä¼¼,<code>flathub</code>ä¸ºç»™ä»“åº“å–çš„åˆ«å,åé¢æ¥çš„æ˜¯ç›¸åº”url</li><li><code>--if-not-exists</code>é˜²æ­¢é‡å¤æ·»åŠ ç›¸åŒçš„ä»“åº“</li></ul><p>åˆ é™¤ä¸€ä¸ªä»“åº“<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flatpak remote-<span class="keyword">delete</span> flathub</span><br></pre></td></tr></table></figure></p><p>æœç´¢æ–°çš„è½¯ä»¶<br><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flatpak <span class="keyword">search</span> <span class="type">name</span></span><br></pre></td></tr></table></figure></p><ul><li>å°†ä¼šè¿”å›<code>Application ID</code>,<code>Version Branch</code>, <code>Remotes</code>, <code>Description</code>,ä¾æ¬¡æ˜¯åº”ç”¨çš„id(åé¢å®‰è£…çš„æ—¶å€™ä¼šç”¨åˆ°),ç‰ˆæœ¬,ä»“åº“åˆ«å,æè¿°</li></ul><p>å®‰è£…å¸è½½æ–°çš„è½¯ä»¶<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flatpak <span class="keyword">install</span> flathub(ä»“åº“åˆ«å) Application <span class="keyword">ID</span></span><br><span class="line"></span><br><span class="line">flatpak <span class="keyword">uninstall</span> Application <span class="keyword">ID</span></span><br></pre></td></tr></table></figure></p><p>æŸ¥çœ‹å·²å®‰è£…è½¯ä»¶<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flatpak lists</span></span><br></pre></td></tr></table></figure></p><p>æ›´æ–°è½¯ä»¶<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flatpak update</span></span><br></pre></td></tr></table></figure></p><p>è‡³æ­¤å·²ç»å¯ä»¥æ„‰å¿«çš„ç©è€äº†</p><h1 id="gnome-builder"><a href="#gnome-builder" class="headerlink" title="gnome-builder"></a>gnome-builder</h1><p>æŠ±ç€å¤šå­¦çŸ¥è¯†<del>çæŠ˜è…¾</del>çš„å¿ƒæ€ä¸€å¼€å§‹é€‰æ‹©äº†ç¼–è¯‘æºç </p><p>ç„¶åæˆåŠŸè§è¯†åˆ°mesonå’Œninjaè¿™å¥—è·¨å¹³å°ç¼–è¯‘å·¥å…·<del>ä¸‹ç¯‡è§</del>,æŠ˜è…¾äº†ä¸€æ™šä¸Šåæœ€ç»ˆå€’åœ¨ä¸çŸ¥åé”™è¯¯ä¸Š</p><p>å°è¯•è‡ªå¸¦è½¯ä»¶æºçš„gnome-builderåˆæ˜¯ä¸ªåŠæ®‹åºŸ,æœ€åä½¿ç”¨flatpakå®‰è£…æˆåŠŸ</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flatpak install flathub org<span class="selector-class">.gnome</span><span class="selector-class">.Builder</span></span><br></pre></td></tr></table></figure><h3 id="è§£å†³ä¸èƒ½ä½¿ç”¨æš—é—´æ¨¡å¼çš„é—®é¢˜"><a href="#è§£å†³ä¸èƒ½ä½¿ç”¨æš—é—´æ¨¡å¼çš„é—®é¢˜" class="headerlink" title="è§£å†³ä¸èƒ½ä½¿ç”¨æš—é—´æ¨¡å¼çš„é—®é¢˜"></a>è§£å†³ä¸èƒ½ä½¿ç”¨æš—é—´æ¨¡å¼çš„é—®é¢˜</h3><p>ç”±äºæ˜¯åŸºäºæ²™ç®±è¿è¡Œçš„ç¨‹åº,å¯¼è‡´ä¸èƒ½æ­£ç¡®è¯†åˆ«åˆ°è‡ªèº«ä¸»é¢˜æ§ä»¶,éœ€è¦å•ç‹¬å®‰è£…ç›¸åº”é»‘æš—ä¸»é¢˜</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ä¸»é¢˜</span></span><br><span class="line"><span class="attr">neofetch</span> <span class="string">| grep Theme</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢ä¸»é¢˜</span></span><br><span class="line"><span class="attr">flatpak</span> <span class="string">search name</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line"><span class="attr">flatpak</span> <span class="string">install * *</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶é»‘æš—ä¸»é¢˜å¯ç”¨</p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="å·¥å…·" scheme="http://yoursite.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="flatpak" scheme="http://yoursite.com/tags/flatpak/"/>
    
      <category term="gnome-builder" scheme="http://yoursite.com/tags/gnome-builder/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºcè¯­è¨€ä¸­ä¸€äº›ç–‘éš¾ç‚¹çš„å¤ä¹ </title>
    <link href="http://yoursite.com/2020/03/07/%E5%85%B3%E4%BA%8Ec%E8%AF%AD%E8%A8%80%E4%B8%AD%E4%B8%80%E4%BA%9B%E7%96%91%E9%9A%BE%E7%82%B9%E7%9A%84%E5%A4%8D%E4%B9%A0/"/>
    <id>http://yoursite.com/2020/03/07/%E5%85%B3%E4%BA%8Ec%E8%AF%AD%E8%A8%80%E4%B8%AD%E4%B8%80%E4%BA%9B%E7%96%91%E9%9A%BE%E7%82%B9%E7%9A%84%E5%A4%8D%E4%B9%A0/</id>
    <published>2020-03-07T12:38:48.000Z</published>
    <updated>2020-04-25T02:22:04.664Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="å£°æ˜å’Œå®šä¹‰"><a href="#å£°æ˜å’Œå®šä¹‰" class="headerlink" title="å£°æ˜å’Œå®šä¹‰"></a>å£°æ˜å’Œå®šä¹‰</h1><table><thead><tr><th style="text-align:center">å£°æ˜</th><th style="text-align:center">æè¿°å¯¹è±¡çš„ç±»å‹,ç”¨äºæŒ‡ä»£å…¶ä»–åœ°æ–¹å®šä¹‰çš„å¯¹è±¡,å¦‚<code>extern int i;</code></th></tr></thead><tbody><tr><td style="text-align:center">å®šä¹‰</td><td style="text-align:center">ç¡®å®šå¯¹è±¡çš„ç±»å‹å¹¶åˆ†é…ç±»å‹,ç”¨äºåˆ›å»ºæ–°çš„å¯¹è±¡,å¦‚<code>int i ;</code></td></tr></tbody></table><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> i = <span class="number">0</span>;  <span class="comment">// æ—¢æ˜¯å£°æ˜ä¹Ÿæ˜¯å®šä¹‰</span></span><br><span class="line">extern <span class="built_in">int</span> i; <span class="comment">// ä¸ºå£°æ˜,è¡¨ç¤ºåœ¨å…¶ä»–åœ°æ–¹æœ‰å®šä¹‰</span></span><br><span class="line">extern <span class="built_in">int</span> i = <span class="number">0</span>; <span class="comment">// æ—¢æ˜¯å£°æ˜ä¹Ÿæ˜¯å®šä¹‰</span></span><br></pre></td></tr></table></figure><ul><li>å¯¹äºå‡½æ•°,ç»“æ„ä½“åŒæ ·é€‚ç”¨</li></ul><hr><h1 id="æŒ‡é’ˆå’Œæ•°ç»„åä¸€æ ·ä¹ˆ"><a href="#æŒ‡é’ˆå’Œæ•°ç»„åä¸€æ ·ä¹ˆ" class="headerlink" title="æŒ‡é’ˆå’Œæ•°ç»„åä¸€æ ·ä¹ˆ"></a>æŒ‡é’ˆå’Œæ•°ç»„åä¸€æ ·ä¹ˆ</h1><p>é¦–å…ˆçœ‹ä¸€ä¸ªä¾‹å­<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> pp[]= &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="built_in">int</span> * p = pp ;</span><br><span class="line"></span><br><span class="line">printf(<span class="string">"%d %d"</span>,pp[<span class="number">0</span>],p[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">&gt; <span class="number">1</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></p><ul><li>æ¯«æ— ç–‘é—®,è¿™æ˜¯æ²¡æœ‰é—®é¢˜çš„</li></ul><p>ä½†æ˜¯å¦‚æœæ˜¯è¿™æ ·çš„å‘¢<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">extern <span class="built_in">int</span> pp[<span class="number">3</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;  <span class="comment">//å‡è®¾åœ¨æ–‡ä»¶A</span></span><br><span class="line">extern <span class="built_in">int</span> *pp;  <span class="comment">//å‡è®¾åœ¨æ–‡ä»¶B</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨æ–‡ä»¶Bä¸­</span></span><br><span class="line">printf(<span class="string">"%d"</span>,pp[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure></p><ul><li>èƒ½æ­£ç¡®è¾“å‡º<code>1</code>å—,ç­”æ¡ˆæ˜¯<strong>ä¸èƒ½</strong></li><li><code>int pp[]</code>æ˜¯ä¸€ä¸ªæ•°ç»„,<code>int *pp</code>æ˜¯ä¸€ä¸ªæŒ‡é’ˆ,ä¸èƒ½å› ä¸ºå˜é‡åä¸€æ ·è€Œå°†æŒ‡é’ˆå’Œæ•°ç»„åæ··ä¸ºä¸€è°ˆ</li><li>åœ¨<code>int pp[]</code>ä¸­,ppä»£è¡¨çš„æ˜¯ppè¿™ä¸ªæ•°ç»„çš„çœŸå®åœ°å€,ä½†åœ¨<code>int *pp</code>ä¸­,ppåªæ˜¯ä¸ªæŒ‡é’ˆå˜é‡,å˜é‡çš„å€¼æ‰ä¸ºçœŸæ­£æ‰€éœ€è¦è®¿é—®çš„åœ°å€,åœ¨è¿™é‡ŒçŠ¯äº†ç±»å‹ä¸åŒ¹é…çš„é”™è¯¯</li></ul><p>è‹¥è¦æ­£ç¡®ä½¿ç”¨,åœ¨æ–‡ä»¶Bä¸­åº”è¯¥æ”¹ä¸º<code>extern int pp[]</code></p><p>ä»€ä¹ˆæ—¶å€™æ•°ç»„ç­‰åŒäºæŒ‡é’ˆ</p><ul><li>å‡ºç°è¡¨è¾¾å¼ä¸­æ—¶,æ•°ç»„åä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ªæŒ‡é’ˆ,å¦‚<code>int pp[3] = {0};  *(pp+1) ;</code></li><li>æŠŠæ•°ç»„ä¸‹æ ‡ä½œä¸ºæŒ‡é’ˆçš„åç§»é‡,<code>int *p =pp ; *(ç¯‡+1);</code></li><li>ä½œä¸ºå‡½æ•°çš„å‚æ•°</li></ul><hr><h1 id="å¦‚ä½•åœ¨-main-æ‰§è¡Œä¹‹å‰å…ˆè¿è¡Œå…¶å®ƒå‡½æ•°"><a href="#å¦‚ä½•åœ¨-main-æ‰§è¡Œä¹‹å‰å…ˆè¿è¡Œå…¶å®ƒå‡½æ•°" class="headerlink" title="å¦‚ä½•åœ¨ main() æ‰§è¡Œä¹‹å‰å…ˆè¿è¡Œå…¶å®ƒå‡½æ•°"></a>å¦‚ä½•åœ¨ main() æ‰§è¡Œä¹‹å‰å…ˆè¿è¡Œå…¶å®ƒå‡½æ•°</h1><p>åˆšå­¦cè¯­è¨€çš„æ—¶å€™,ç›¸ä¿¡å¯¹main()å‡½æ•°çš„å°è±¡éƒ½æ˜¯å®ƒæ˜¯ç¨‹åºè¿è¡Œæ—¶ç¬¬ä¸€ä¸ªè¿è¡Œçš„å‡½æ•°,å…¶å®ä¸ç„¶</p><p>å…ˆå†™ä¸ªç®€å•å°ç¨‹åº<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> agrc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Hello world!"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>è¿è¡Œç¼–è¯‘æ¯«æ— ç–‘é—®æ˜¯<code>Hello world!</code></li></ul><p>å…ˆäº†è§£ä¸€ä¸‹å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼<br><img src="/images/20200307=0.png" alt></p><p>å…¶ä¸­çš„<code>.text</code> <code>.data</code> <code>.bss</code> æ˜¯ä¸æ˜¯åƒæäº†cè¯­è¨€ç¨‹åºè¿è¡Œæ—¶å­˜å‚¨ç©ºé—´å¸ƒå±€ä¸­æ‰€å¯¹åº”çš„</p><ul><li><code>text</code> ä¿å­˜çš„æ˜¯ç¼–è¯‘åå¾—åˆ°çš„æœºå™¨ç </li><li><code>.rodata</code> ä¿å­˜æ˜¯åªè¯»æ•°æ®,å¦‚<code>char *buf = &quot;hi&quot;</code>è¿™é‡Œçš„<code>hi</code>ä¸ºåªè¯»çš„å­—ç¬¦ä¸²å¸¸é‡</li><li><code>data</code> ä¿å­˜çš„æ˜¯è¢«åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡</li><li><code>bss</code> ä¿å­˜çš„æ˜¯æœªåˆå§‹åŒ–çš„ä¿å­˜çš„æ˜¯æœªè¢«åˆå§‹åŒ–é¢å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼ŒåŠè¢«åˆå§‹åŒ–ä¸º0çš„åˆå§‹å˜é‡</li></ul><p>è€Œè¿™é‡Œæƒ³çœ‹æ˜¯<code>.systab</code>ä¿å­˜çš„æ˜¯åœ¨ç¨‹åºä¸­å®šä¹‰æˆ–è€…å¼•ç”¨çš„å‡½æ•°ã€å…¨å±€å˜é‡<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># readelf - Displays information about ELF files.</span></span><br><span class="line"></span><br><span class="line">readelf -s a.out</span><br><span class="line"></span><br><span class="line"> &gt;    2: 0000000000000000     0 FUNC    GLOBAL<span class="built_in"> DEFAULT </span> UND puts@GLIBC_2.2.5 (2)</span><br><span class="line">     3: 0000000000000000     0 FUNC    GLOBAL<span class="built_in"> DEFAULT </span> UND __libc_start_main@GLIBC_2.2.5 (2)</span><br><span class="line">     6: 0000000000000000     0 FUNC    WEAK  <span class="built_in"> DEFAULT </span> UND __cxa_finalize@GLIBC_2.2.5 (2)</span><br><span class="line">    27: 0000000000000560     0 FUNC    LOCAL <span class="built_in"> DEFAULT </span>  14 deregister_tm_clones</span><br><span class="line">    28: 00000000000005a0     0 FUNC    LOCAL <span class="built_in"> DEFAULT </span>  14 register_tm_clones</span><br><span class="line">    29: 00000000000005f0     0 FUNC    LOCAL <span class="built_in"> DEFAULT </span>  14 __do_global_dtors_aux</span><br><span class="line">    32: 0000000000000630     0 FUNC    LOCAL <span class="built_in"> DEFAULT </span>  14 frame_dummy</span><br><span class="line">    43: 00000000000006d0     2 FUNC    GLOBAL<span class="built_in"> DEFAULT </span>  14 __libc_csu_fini</span><br><span class="line">    46: 0000000000000000     0 FUNC    GLOBAL<span class="built_in"> DEFAULT </span> UND puts@@GLIBC_2.2.5</span><br><span class="line">    48: 00000000000006d4     0 FUNC    GLOBAL<span class="built_in"> DEFAULT </span>  15 _fini</span><br><span class="line">    49: 0000000000000000     0 FUNC    GLOBAL<span class="built_in"> DEFAULT </span> UND __libc_start_main@@GLIBC_</span><br><span class="line">    54: 0000000000000660   101 FUNC    GLOBAL<span class="built_in"> DEFAULT </span>  14 __libc_csu_init</span><br><span class="line">    56: 0000000000000530    43 FUNC    GLOBAL<span class="built_in"> DEFAULT </span>  14 _start</span><br><span class="line">    58: 000000000000063a    34 FUNC    GLOBAL<span class="built_in"> DEFAULT </span>  14 main</span><br><span class="line">    61: 0000000000000000     0 FUNC    WEAK  <span class="built_in"> DEFAULT </span> UND __cxa_finalize@@GLIBC_2.2</span><br><span class="line">    62: 00000000000004e8     0 FUNC    GLOBAL<span class="built_in"> DEFAULT </span>  11 _init</span><br></pre></td></tr></table></figure></p><ul><li>ä»è¿™é‡Œçœ‹æˆ‘ä»¬æ‰€å†™çš„mainå‡½æ•°æ’åœ¨äº†58ä½,å¯è§å®é™…åœ¨mian()è¿è¡Œå‰ç¡®å®è¿è¡Œäº†å¾ˆå¤šå‡½æ•°</li><li>åœ¨ç¼–è¯‘é“¾æ¥æ—¶,ç¬¬ä¸€ä¸ªå…¥å£å‡½æ•°åœ°å€æ˜¯<code>_start</code></li></ul><p>å€Ÿæ­¤æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªè‡ªå·±çš„<code>_start</code>å‡½æ•°<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt; </span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="regexp">//m</span>ain()æ”¾å‰é¢æ˜¯å› ä¸ºå…¥å£å‡½æ•°ä¸ºè‡ªå·±å®šä¹‰çš„_start,è¿™é‡Œçš„main()ç›¸å½“äºä¸€ä¸ªå­å‡½æ•°</span><br><span class="line">int main(void )</span><br><span class="line">&#123;</span><br><span class="line">printf(<span class="string">"hello world 1 !\n"</span>);</span><br><span class="line"></span><br><span class="line">return <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> è¿™é‡Œå¿…é¡»è°ƒç”¨<span class="keyword">exit</span>()æ¥å–„å,å¦åˆ™ä¼šcore dump</span><br><span class="line">int _start(void) </span><br><span class="line">&#123; </span><br><span class="line">    printf(<span class="string">"hello world 2 !\n"</span>);</span><br><span class="line">main();</span><br><span class="line"><span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¼–è¯‘é“¾æ¥æ—¶ä¸ä½¿ç”¨æ ‡å‡†å¼€å§‹æ–‡ä»¶,è€Œæ˜¯ä½¿ç”¨è‡ªå·±å†™çš„<code>_start</code><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*gcc        -nostartfiles</span></span><br><span class="line"><span class="comment">                    Do not use the standard system startup files when linking.  The standard system</span></span><br><span class="line"><span class="comment">                    libraries are used normally, unless -nostdlib or -nodefaultlibs is used.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">gcc test<span class="selector-class">.c</span> -nostartfiles  &amp;&amp; ./<span class="selector-tag">a</span>.out</span><br><span class="line"></span><br><span class="line">&gt;   hello world <span class="number">2</span> !</span><br><span class="line">     hello world <span class="number">1</span> !</span><br></pre></td></tr></table></figure></p><p>å†æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">readelf -s a.out | grep FUNC</span><br><span class="line">   </span><br><span class="line">&gt;   1: 0000000000000000     0 FUNC    GLOBAL<span class="built_in"> DEFAULT </span> UND puts@GLIBC_2.2.5 (2)</span><br><span class="line">     2: 0000000000000000     0 FUNC    GLOBAL<span class="built_in"> DEFAULT </span> UND exit@GLIBC_2.2.5 (2)</span><br><span class="line">    22: 0000000000000000     0 FUNC    GLOBAL<span class="built_in"> DEFAULT </span> UND puts@@GLIBC_2.2.5</span><br><span class="line">    25: 00000000000003a7    31 FUNC    GLOBAL<span class="built_in"> DEFAULT </span>  10 _start</span><br><span class="line">    27: 0000000000000390    23 FUNC    GLOBAL<span class="built_in"> DEFAULT </span>  10 main</span><br><span class="line">    28: 0000000000000000     0 FUNC    GLOBAL<span class="built_in"> DEFAULT </span> UND exit@@GLIBC_2.2.5</span><br></pre></td></tr></table></figure></p><ul><li>ç›¸å¯¹æ¯”ä½¿ç”¨æ ‡å‡†å¼€å§‹æ–‡ä»¶è¿™é‡Œå°‘äº†å¾ˆå¤šå‡½æ•°</li><li>ç”±äºé“¾æ¥æ—¶è¿˜æ˜¯ä½¿ç”¨äº†ç³»ç»Ÿåº“,æ‰€ä»¥ç¨‹åºè¿˜æ˜¯èƒ½è·‘èµ·æ¥çš„</li></ul><p>å¦å¤–ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨GNUç‰¹è‰²ä¹‹gccå…³é”®å­—</p><blockquote><p>å…³é”®å­—<code>__attribute__</code>å¯ä»¥ä¸ºå‡½æ•°ï¼ˆFunction Attributesï¼‰ï¼Œå˜é‡ï¼ˆVariable Attributesï¼‰å’Œç»“æ„æˆå‘˜ï¼ˆType Attributesï¼‰èµ‹å±æ€§ã€‚å…·ä½“å¯ä»¥æŸ¥çœ‹gccæ‰‹å†Œï¼ˆ<a href="http://gcc.gnu.org/onlinedocs/ï¼‰" target="_blank" rel="noopener">http://gcc.gnu.org/onlinedocs/ï¼‰</a></p></blockquote><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…³é”®å­—éœ€è¦åœ¨å®šä¹‰ä¹‹å‰</span></span><br><span class="line"></span><br><span class="line"> __attribute__((<span class="function"><span class="keyword">constructor</span>))<span class="title">void</span> <span class="title">before</span><span class="params">()</span>;</span></span><br><span class="line"></span><br><span class="line">__attribute__((<span class="function"><span class="keyword">destructor</span>))<span class="title">void</span> <span class="title">after</span><span class="params">()</span>;</span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">m</span><span class="params">()</span>__<span class="title">attribute__</span><span class="params">((constructor))</span> </span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span> )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"hello world  !\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*int _start(void) </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">void m()</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">printf("%d ",666);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&gt; 666 hello world  !</span></span><br></pre></td></tr></table></figure><p><a href="https://www.jianshu.com/p/4912a1dc8a50" target="_blank" rel="noopener">å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼è¯´æ˜</a><br><a href="https://www.jianshu.com/p/dda61084f9b5" target="_blank" rel="noopener">cè¯­è¨€ä¸­<strong>attribute</strong>çš„æ„ä¹‰</a><br><a href="https://www.jb51.net/article/62360.htm" target="_blank" rel="noopener">Cè¯­è¨€ä¹‹æ²¡æœ‰mainå‡½æ•°çš„helloworldç¤ºä¾‹</a><br><a href="https://bbs.csdn.net/topics/300103318#r_78088969" target="_blank" rel="noopener">ä¸€ä¸ªcç¨‹åºåœ¨æ‰§è¡Œmainå‡½æ•°ä¹‹å‰å’Œmainä¹‹åéƒ½åšäº†é‚£äº›äº‹æƒ…å•Šï¼Ÿ</a></p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
    
    
      <category term="c" scheme="http://yoursite.com/tags/c/"/>
    
  </entry>
  
</feed>
